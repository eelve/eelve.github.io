{"name":"Elastic-Stack","postlist":[{"title":"Elastic Stack实战之Beats家族介绍","slug":"Elastic-Stack实战之Beats家族介绍","date":"2020-03-05T12:30:10.000Z","updated":"2023-09-30T08:39:39.667Z","comments":true,"path":"api/articles/Elastic-Stack实战之Beats家族介绍.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/illustration-beats-header-overflow-1ba7ff649dbf41598d71ed24d1ade8da.png","content":"<p>【<strong>前面的话</strong>】前面我们已经体验过了Elasticsearch、Logstash和Kibanan，也是就是ELK三大剑客。记得在前文<a href=\"https://eelve.com/posts/e05eadb0.html\">Elastic Stack实战之Logstash初体验</a>中提到过Elastic Stack大家族中增加了一个新的高效率的采集组件，那就是Beats家族，那今天就来了解一下。</p>\n<hr>\n<h1 id=\"壹、什么是Beats\"><a href=\"#壹、什么是Beats\" class=\"headerlink\" title=\"壹、什么是Beats\"></a>壹、什么是Beats</h1><p><img src=\"https://image.eelve.com/eblog/illustration-beats-header-overflow-1ba7ff649dbf41598d71ed24d1ade8da.png\" alt=\"illustration-beats-header-overflow\"></p>\n<p><strong>Beats</strong>是轻量型数据采集器。</p>\n<p><strong>Beats</strong>平台集合了多种单一用途数据采集器。它们从成百上千或成千上万台机器和系统向 Logstash 或 Elasticsearch 发送数据。 </p>\n<h1 id=\"贰、Beats系列简介\"><a href=\"#贰、Beats系列简介\" class=\"headerlink\" title=\"贰、Beats系列简介\"></a>贰、Beats系列简介</h1><p>全品类采集器，搞定所有数据类型。</p>\n<ul>\n<li><p><a href=\"https://www.elastic.co/beats/filebeat\">Filebeat</a>：用于采集日志文件</p>\n</li>\n<li><p><a href=\"https://www.elastic.co/beats/metricbeat\">Metricbeat</a>: 用于采集指标数据</p>\n</li>\n<li><p><a href=\"https://www.elastic.co/beats/packetbeat\">Packetbeat</a>: 用于采集网络数据</p>\n</li>\n<li><p><a href=\"https://www.elastic.co/beats/winlogbeat\">Winlogbeat</a>: 用于采集Windows事件</p>\n</li>\n<li><p><a href=\"https://www.elastic.co/beats/auditbeat\">Auditbeat</a>: 用于采集审计数据</p>\n</li>\n<li><p><a href=\"https://www.elastic.co/beats/heartbeat\">Heartbeat</a>: 用于采集运行时间监控</p>\n</li>\n<li><p><a href=\"https://www.elastic.co/beats/functionbeat\">Functionbeat</a>: 是一个无需服务器的采集器</p>\n</li>\n</ul>\n<h1 id=\"叁、Beats特点\"><a href=\"#叁、Beats特点\" class=\"headerlink\" title=\"叁、Beats特点\"></a>叁、Beats特点</h1><ul>\n<li>轻量型：Beats 是数据采集的得力工具。将Beats和您的容器一起置于服务器上，或者将Beats作为功能加以部署，然后便可在 Elasticsearch中集中处理数据。Beats能够采集符合 Elastic Common Schema(ECS)要求的数据，如果您希望拥有更加强大的处理能力，Beats能够将数据转发至Logstash进行转换和解析。 </li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/illustration-beats-lightweight-d6ee1493b6a64579a71fb63e2e95b4ac.svg\" alt=\"illustration-beats-lightweight\"></p>\n<ul>\n<li>即插即用：借助模块加速数据可视化体验。Filebeat 和 Metricbeat 中包含的一些模块能够简化从关键数据源（例如云平台、容器和系统，以及网络技术）采集、解析和可视化信息的过程。只需运行一行命令，即可开始探索。 </li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-beats-modules-8dec132b351e4c6a9835d806e24e520e.jpg\" alt=\"screenshot-beats-modules\"></p>\n<ul>\n<li>从环境中获得洞见：Beats 从您的专属环境中收集日志和指标，然后通过来自主机、诸如 Docker 和 Kubernetes 等容器平台以及云服务提供商的必要元数据对这些内容进行记录，然后再传输到 Elastic Stack 中。从监测容器到从无需服务器的架构传输数据，我们确保您拥有所需的上下文。 </li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-infrastructure-ui-368a637d105b42a4b87d0df2b2158275.png\" alt=\"screenshot-infrastructure-ui\"></p>\n<ul>\n<li>可扩展：缺少某种采集器？别着急。您可以自行构建并分享。每款开源 Beat 都以 libbeat（转发数据时所用的通用库）为基石。需要监控某个专用协议？自行构建。我们将为您提供所需的构建基块。</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/illustration-beats-exstensible-555-white-bg-1767d533ca824a5290360eb027eed811.svg\" alt=\"illustration-beats-exstensible-555-white-bg\"></p>\n<ul>\n<li>托管式：Beats 同样能向 Elastic Cloud 输送数据</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/illustration-beats-elasticsearch-service-e783d59f07bc406c95c0942484f91c22.svg\" alt=\"illustration-beats-elasticsearch-service\"></p>\n<hr>\n<p>【<strong>后面的话</strong>】本文只是Beats家族的一个介绍，后面还有相关文章进行体验。Beats采集数据之后可以直接给Elasticsearch，也可以经过Logstash过滤处理之后再由Logstash存入Elasticsearch。在后面的文章会做相应的演示的。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Beats","path":"api/tags/Beats.json"}]},{"title":"Elastic Stack实战之Elasticsearch初体验(一)","slug":"Elastic-Stack实战之Elasticsearch初体验(一)","date":"2020-03-01T04:34:22.000Z","updated":"2021-04-19T06:52:48.628Z","comments":true,"path":"api/articles/Elastic-Stack实战之Elasticsearch初体验(一).json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/2020010301-5b565f99650d4acbb3ba464408dca641.png","content":"<p>【<strong>前面的话</strong>】前面已经准备好了服务器环境，今天就来开始安装<a href=\"https://www.elastic.co/cn/elasticsearch\">Elasticsearch</a>然后体验。</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br></pre></td></tr></table></figure>\n<p>这里说一下，Elasticsearch是依赖Java环境的，elasticsearch-7.6.0要求至少为1.8，官方建议为11.如果你的机器上还没有Java环境的话，记得要先准备环境。当然安装也是非常简单：</p>\n<p>1.下载linux版本的jdk</p>\n<p>2.解压然后配置环境变量</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">java environment</span></span><br><span class=\"line\">export JAVA_HOME=/usr/jdk</span><br><span class=\"line\">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/jre/lib/rt.jar:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar</span><br><span class=\"line\">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin</span><br></pre></td></tr></table></figure>\n<p>3.刷新环境变量，检查结果</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# source /etc/profile</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# java -version</span><br><span class=\"line\">java version &quot;1.8.0_211&quot;</span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、Elasticsearch安装\"><a href=\"#贰、Elasticsearch安装\" class=\"headerlink\" title=\"贰、Elasticsearch安装\"></a>贰、Elasticsearch安装</h1><h2 id=\"2-1-下载地址\"><a href=\"#2-1-下载地址\" class=\"headerlink\" title=\"2.1 下载地址\"></a>2.1 下载地址</h2><h2 id=\"elasticsearch-7-6-0-linux-x86-64-tar-gz\"><a href=\"#elasticsearch-7-6-0-linux-x86-64-tar-gz\" class=\"headerlink\" title=\"elasticsearch-7.6.0-linux-x86_64.tar.gz\"></a><a href=\"https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.6.0-linux-x86_64.tar.gz\">elasticsearch-7.6.0-linux-x86_64.tar.gz</a></h2><h2 id=\"2-2-解压elasticsearch-7-6-0-linux-x86-64-tar-gz\"><a href=\"#2-2-解压elasticsearch-7-6-0-linux-x86-64-tar-gz\" class=\"headerlink\" title=\"2.2 解压elasticsearch-7.6.0-linux-x86_64.tar.gz\"></a>2.2 解压elasticsearch-7.6.0-linux-x86_64.tar.gz</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zvxf elasticsearch-7.6.0-linux-x86_64.tar.gz -C /usr/elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-修改elasticsearch配置\"><a href=\"#2-3-修改elasticsearch配置\" class=\"headerlink\" title=\"2.3 修改elasticsearch配置\"></a>2.3 修改elasticsearch配置</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 elastic]# cd /usr/elastic/elasticsearch/config/</span><br><span class=\"line\">[root@192 config]# vi elasticsearch.yml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下面给出单机版安装最小配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">node.name:</span> <span class=\"string\">node-1</span> <span class=\"comment\">#节点名字</span></span><br><span class=\"line\"><span class=\"attr\">network.host:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span> <span class=\"comment\">#生产配置为127.0.0.1，测试可以为其他地址</span></span><br><span class=\"line\"><span class=\"attr\">http.port:</span> <span class=\"number\">9200</span> <span class=\"comment\">#端口</span></span><br><span class=\"line\"><span class=\"attr\">cluster.initial_master_nodes:</span> [<span class=\"string\">&quot;node-1&quot;</span>] <span class=\"comment\">#初始化master节点</span></span><br><span class=\"line\"><span class=\"attr\">http.cors.enabled:</span> <span class=\"literal\">true</span>  <span class=\"comment\">#开启跨域</span></span><br><span class=\"line\"><span class=\"attr\">http.cors.allow-origin:</span> <span class=\"string\">&quot;*&quot;</span> <span class=\"comment\">#开启跨域</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"2-4-后台启动\"><a href=\"#2-4-后台启动\" class=\"headerlink\" title=\"2.4 后台启动\"></a>2.4 后台启动</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# ./elasticsearch</span><br><span class=\"line\">[1] 1620</span><br><span class=\"line\">[root@192 bin]# future versions of Elasticsearch will require Java 11; your Java version from [/usr/jdk/jre] does not meet this requirement</span><br><span class=\"line\">[2020-03-01T11:55:38,871][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-1] uncaught exception in thread [main]</span><br><span class=\"line\">org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:174) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:161) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125) ~[elasticsearch-cli-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:126) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">Caused by: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:105) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:172) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:349) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:170) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\t... 6 more</span><br><span class=\"line\">uncaught exception in thread [main]</span><br><span class=\"line\">java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:105)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:172)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:349)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:170)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:161)</span><br><span class=\"line\">\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.main(Command.java:90)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:126)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92)</span><br><span class=\"line\">For complete error details, refer to the log at /usr/elastic/elasticsearch/logs/eelve.log</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这里说的是elasticsearch不能用root用户启动，这里就需要添加一个用户，然后重新启动</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# adduser iio</span><br><span class=\"line\">[root@192 bin]# passwd iio</span><br><span class=\"line\">Changing password for user iio.</span><br><span class=\"line\">New password: </span><br><span class=\"line\">Retype new password: </span><br><span class=\"line\">passwd: all authentication tokens updated successfully.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>然后更改elasticsearch用户组</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# chown -R iio:iio /usr/elastic/elasticsearch/</span><br></pre></td></tr></table></figure>\n<p>然后就可以启动成功了</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# su iio</span><br><span class=\"line\">[iio@192 bin]$ ./elasticsearch</span><br><span class=\"line\">future versions of Elasticsearch will require Java 11; your Java version from [/usr/jdk/jre] does not meet this requirement</span><br><span class=\"line\">[2020-03-01T12:03:32,970][INFO ][o.e.e.NodeEnvironment    ] [node-1] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [20.9gb], net total_space [25.9gb], types [rootfs]</span><br><span class=\"line\">[2020-03-01T12:03:32,972][INFO ][o.e.e.NodeEnvironment    ] [node-1] heap size [990.7mb], compressed ordinary object pointers [true]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] node name [node-1], node ID [2IBvVjP0QbeA-FDLFoLFFg], cluster name [eelve]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] version[7.6.0], pid[1952], build[default/tar/7f634e9f44834fbc12724506cc1da681b0c3b1e3/2020-02-06T00:09:00.449973Z], OS[Linux/3.10.0-1062.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_211/25.211-b12]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] JVM home [/usr/jdk/jre]</span><br><span class=\"line\">[2020-03-01T12:03:33,104][INFO ][o.e.n.Node               ] [node-1] JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dio.netty.allocator.numDirectArenas=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.locale.providers=COMPAT, -Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Djava.io.tmpdir=/tmp/elasticsearch-5828849950285366888, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -XX:MaxDirectMemorySize=536870912, -Des.path.home=/usr/elastic/elasticsearch, -Des.path.conf=/usr/elastic/elasticsearch/config, -Des.distribution.flavor=default, -Des.distribution.type=tar, -Des.bundled_jdk=true]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [aggs-matrix-stats]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [analysis-common]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [flattened]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [frozen-indices]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-common]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-geoip]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-user-agent]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-expression]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-mustache]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-painless]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [mapper-extras]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [parent-join]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [percolator]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [rank-eval]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [reindex]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [repository-url]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [search-business-rules]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [spatial]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [transform]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [transport-netty4]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [vectors]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-analytics]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ccr]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-core]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-deprecation]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-enrich]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-graph]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ilm]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-logstash]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ml]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-monitoring]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-rollup]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-security]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-sql]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-voting-only-node]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-watcher]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] no plugins loaded</span><br><span class=\"line\">[2020-03-01T12:03:37,968][INFO ][o.e.x.s.a.s.FileRolesStore] [node-1] parsed [0] roles from file [/usr/elastic/elasticsearch/config/roles.yml]</span><br><span class=\"line\">[2020-03-01T12:03:38,382][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [node-1] [controller/2044] [Main.cc@110] controller (64 bit): Version 7.6.0 (Build 1c8cca13fa9631) Copyright (c) 2020 Elasticsearch BV</span><br><span class=\"line\">[2020-03-01T12:03:38,870][DEBUG][o.e.a.ActionModule       ] [node-1] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security</span><br><span class=\"line\">[2020-03-01T12:03:38,999][INFO ][o.e.d.DiscoveryModule    ] [node-1] using discovery type [zen] and seed hosts providers [settings]</span><br><span class=\"line\">[2020-03-01T12:03:39,805][INFO ][o.e.n.Node               ] [node-1] initialized</span><br><span class=\"line\">[2020-03-01T12:03:39,805][INFO ][o.e.n.Node               ] [node-1] starting ...</span><br><span class=\"line\">[2020-03-01T12:03:39,954][INFO ][o.e.t.TransportService   ] [node-1] publish_address &#123;192.168.237.11:9300&#125;, bound_addresses &#123;[::]:9300&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,352][INFO ][o.e.b.BootstrapChecks    ] [node-1] bound or publishing to a non-loopback address, enforcing bootstrap checks</span><br><span class=\"line\">[2020-03-01T12:03:40,380][INFO ][o.e.c.c.Coordinator      ] [node-1] cluster UUID [PKv57dWOS5OAazrBgqoLcQ]</span><br><span class=\"line\">[2020-03-01T12:03:40,565][INFO ][o.e.c.s.MasterService    ] [node-1] elected-as-master ([1] nodes joined)[&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125; elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 9, version: 279, delta: master node changed &#123;previous [], current [&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125;]&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,674][INFO ][o.e.c.s.ClusterApplierService] [node-1] master node changed &#123;previous [], current [&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125;]&#125;, term: 9, version: 279, reason: Publication&#123;term=9, version=279&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,741][INFO ][o.e.h.AbstractHttpServerTransport] [node-1] publish_address &#123;192.168.237.11:9200&#125;, bound_addresses &#123;[::]:9200&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,741][INFO ][o.e.n.Node               ] [node-1] started</span><br><span class=\"line\">[2020-03-01T12:03:41,213][INFO ][o.e.l.LicenseService     ] [node-1] license [b7ab8f1c-3e13-45f0-a4d2-6f5f31a554a1] mode [basic] - valid</span><br><span class=\"line\">[2020-03-01T12:03:41,214][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [node-1] Active license is now [BASIC]; Security is disabled</span><br><span class=\"line\">[2020-03-01T12:03:41,220][INFO ][o.e.g.GatewayService     ] [node-1] recovered [9] indices into cluster_state</span><br><span class=\"line\">[2020-03-01T12:03:42,116][INFO ][o.e.c.r.a.AllocationService] [node-1] Cluster health status changed from [RED] to [YELLOW] (reason: [shards started [[metricbeat-7.6.0][0]]]).</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这里说明一下，有可能会碰到内存不足，因为elasticsearch的<strong>jvm.options</strong>中配置的内存参数为1g，如果你的虚拟机给的内存不够就会出问题<br>修改<strong>jvm.options</strong>中的虚拟机参数为合适的参数，然后就可以启动成功了</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">-Xms1g</span></span><br><span class=\"line\"><span class=\"string\">-Xmx1g</span></span><br></pre></td></tr></table></figure>\n<p>这里还需要修改liunx的环境配置参数，避免重新启动的时候报错：<br>vi 编辑 /etc/security/limits.conf，在末尾加上：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">nofile</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">nofile</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">nproc</span> <span class=\"number\">32000</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">nproc</span> <span class=\"number\">32000</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">memlock</span> <span class=\"string\">unlimited</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">memlock</span> <span class=\"string\">unlimited</span></span><br></pre></td></tr></table></figure>\n<p>vi 编辑 /etc/sysctl.conf，在末尾加上：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">vm.max_map_count=655360</span></span><br></pre></td></tr></table></figure>\n<p>然后刷新配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">bin</span>]<span class=\"comment\"># sysctl -p</span></span><br><span class=\"line\"><span class=\"string\">kernel.printk</span> <span class=\"string\">=</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"string\">vm.max_map_count</span> <span class=\"string\">=</span> <span class=\"number\">655360</span></span><br><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">bin</span>]<span class=\"comment\">#</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>再次启动，然后检查</p>\n<p><img src=\"https://image.eelve.com/eblog/2020010301-5b565f99650d4acbb3ba464408dca641.png\" alt=\"2020010301\"><br><img src=\"https://image.eelve.com/eblog/2020030102-ff4ef388edeb4bb1b88ddf45df96543f.png\" alt=\"2020030102\"></p>\n<hr>\n<p>【<strong>后面的话</strong>】<br>后台启动</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./elasticsearch -d</span><br></pre></td></tr></table></figure>\n<p>查看进程,这里的常用的命令可能不好使，我们可以使用下面的命令查找进程</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ jps</span><br><span class=\"line\">2294 Jps</span><br><span class=\"line\">2135 Elasticsearch</span><br><span class=\"line\">[iio@192 bin]$ kill -9 2135</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Elasticsearch","path":"api/tags/Elasticsearch.json"}]},{"title":"Elastic Stack实战之Elasticsearch初体验(二)","slug":"Elastic-Stack实战之Elasticsearch初体验(二)","date":"2020-03-01T11:49:22.000Z","updated":"2021-04-19T06:52:48.642Z","comments":true,"path":"api/articles/Elastic-Stack实战之Elasticsearch初体验(二).json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/2020010303-6acab887ee4441b488ee408c30359ab5.png","content":"<p>【<strong>前面的话</strong>】前面我们已经安装好了Elasticsearch，现在我们就来尝试简单的使用。</p>\n<hr>\n<h1 id=\"壹、Elasticsearch介绍\"><a href=\"#壹、Elasticsearch介绍\" class=\"headerlink\" title=\"壹、Elasticsearch介绍\"></a>壹、Elasticsearch介绍</h1><p><img src=\"https://image.eelve.com/eblog/2020010303-6acab887ee4441b488ee408c30359ab5.png\" alt=\"2020010303\"></p>\n<p>Elasticsearch是整个<strong>Elastic Stack</strong>的核心。</p>\n<p>Elasticsearch 是一个分布式、RESTful 风格的搜索和数据分析引擎，能够解决不断涌现出的各种用例。 作为 Elastic Stack 的核心，它集中存储您的数据，帮助您发现意料之中以及意料之外的情况。</p>\n<p>通过 Elasticsearch，您能够执行及合并多种类型的搜索（结构化数据、非结构化数据、地理位置、指标），搜索方式随心而变。先从一个简单的问题出发，试试看能够从中发现些什么。找到与查询最匹配的 10 个文档是一回事。但如果面对的是十亿行日志，又该如何解读呢？Elasticsearch 聚合让您能够从大处着眼，探索数据的趋势和模式。</p>\n<h1 id=\"贰、插件安装\"><a href=\"#贰、插件安装\" class=\"headerlink\" title=\"贰、插件安装\"></a>贰、插件安装</h1><p>由于ES官方并没有为ES提供界面管理工具，仅仅是提供了后台的服务。elasticsearch-head是一个为ES开发的一个页面客户端工具，其源码托管于GitHub，地址为：<br><a href=\"https://github.com/mobz/elasticsearch-head\">https://github.com/mobz/elasticsearch-head</a>。<br>安装方法也比较多：</p>\n<pre><code>1.源码安装，通过npm run start启动\n2.通过docker安装\n3.通过chrome插件安装\n4.通过ES的plugin方式安装\n</code></pre>\n<p>我这边就通过chrome插件的方式安装，在应用商店中搜索，然后安装即可，安装成功之后打开你会得到下面的页面</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030106-e64fe73ddd004fb1bd87885b30563d48.png\" alt=\"2020030106\"></p>\n<p>然后连接集群，就可以进行操作了</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030107-079a29b224d14779999957304c279291.png\" alt=\"2020030107\"></p>\n<pre><code>集群健康值\n1.绿色：代表集群所有分片和副本都可用\n2.黄色：代表集群中不是所有副本都可用，但是分片都可以用\n3.红色： 代表集群中不是所有分片都可用\n</code></pre>\n<p>另外我的集群中出现了<strong>Unassigned</strong>，是因为我搭建的是单机版，而Elasticsearch默认会创建1个副本。</p>\n<h1 id=\"叁、简单使用\"><a href=\"#叁、简单使用\" class=\"headerlink\" title=\"叁、简单使用\"></a>叁、简单使用</h1><h2 id=\"3-1-基本概念\"><a href=\"#3-1-基本概念\" class=\"headerlink\" title=\"3.1 基本概念\"></a>3.1 基本概念</h2><p><strong>索引</strong></p>\n<pre><code>索引（index）是Elasticsearch对逻辑数据的逻辑存储，所以它可以分为更小的部分。\n\n可以把索引看成关系型数据库的表，索引的结构是为快速有效的全文索引准备的，特别是它不存储原始值。\n\nElasticsearch可以把索引存放在一台机器或者分散在多台服务器上，每个索引有一或多个分片（shard），每个\n分片可以有多个副本（replica）。\n</code></pre>\n<p><strong>文档</strong></p>\n<pre><code>存储在Elasticsearch中的主要实体叫文档（document）。用关系型数据库来类比的话，一个文档相当于数据库\n表中的一行记录。\n\nElasticsearch和MongoDB中的文档类似，都可以有不同的结构，但Elasticsearch的文档中，相同字段必须有相\n同类型。\n\n文档由多个字段组成，每个字段可能多次出现在一个文档里，这样的字段叫多值字段（multivalued）。\n每个字段的类型，可以是文本、数值、日期等。字段类型也可以是复杂类型，一个字段包含其他子文档或者数\n组。\n</code></pre>\n<p><strong>映射</strong></p>\n<pre><code>所有文档写进索引之前都会先进行分析，如何将输入的文本分割为词条、哪些词条又会被过滤，这种行为叫做\n映射（mapping）。一般由用户自己定义规则。\n</code></pre>\n<p><strong>文档类型</strong></p>\n<pre><code>在Elasticsearch中，一个索引对象可以存储很多不同用途的对象。例如，一个博客应用程序可以保存文章和评\n论。\n\n每个文档可以有不同的结构。\n\n不同的文档类型不能为相同的属性设置不同的类型。例如，在同一索引中的所有文档类型中，一个叫title的字段\n必须具有相同的类型。\n</code></pre>\n<h2 id=\"3-2-RESTful-API\"><a href=\"#3-2-RESTful-API\" class=\"headerlink\" title=\"3.2 RESTful API\"></a>3.2 RESTful API</h2><pre><code>在Elasticsearch中，提供了功能丰富的RESTful API的操作，包括基本的CRUD、创建索引、删除索引等操作。\n</code></pre>\n<p>下面我就通过Postman来演示一遍</p>\n<h3 id=\"3-2-1-创建非结构化索引\"><a href=\"#3-2-1-创建非结构化索引\" class=\"headerlink\" title=\"3.2.1 创建非结构化索引\"></a>3.2.1 创建非结构化索引</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#创建索引</span><br><span class=\"line\">PUT &#x2F;eelve</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;settings&quot;: &#123;</span><br><span class=\"line\">        &quot;index&quot;: &#123;</span><br><span class=\"line\">        &quot;number_of_shards&quot;: &quot;2&quot;, #分片数</span><br><span class=\"line\">        &quot;number_of_replicas&quot;: &quot;0&quot; #副本数</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://image.eelve.com/eblog/2020030108-491386349bf145df999db01f96dca5b7.png\" alt=\"2020030108\"><br><img src=\"https://image.eelve.com/eblog/2020030109-e2e0dbf0610e4c9e815507b3e08824e6.png\" alt=\"2020030109\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#删除索引</span><br><span class=\"line\">DELETE &#x2F;eelve</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://image.eelve.com/eblog/2020030110-0d0eae2e25ec4788b038d3066e0a34df.png\" alt=\"2020030110\"></p>\n<h3 id=\"3-2-2-插入数据\"><a href=\"#3-2-2-插入数据\" class=\"headerlink\" title=\"3.2.2 插入数据\"></a>3.2.2 插入数据</h3><pre><code>URL规则：\nPOST /&#123;索引&#125;/&#123;类型&#125;/&#123;id&#125;\n</code></pre>\n<p>1、带id</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST &#x2F;eelve&#x2F;user&#x2F;1001</span><br><span class=\"line\">#数据</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;id&quot;:1001,</span><br><span class=\"line\">\t&quot;name&quot;:&quot;leo&quot;,</span><br><span class=\"line\">\t&quot;age&quot;:26,</span><br><span class=\"line\">\t&quot;sex&quot;:&quot;男&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://image.eelve.com/eblog/2020030111-8901ba31e0c841ea9f19b3b3fbf47745.png\" alt=\"2020030111\"><br><img src=\"https://image.eelve.com/eblog/2020030112-3b009a1840754659a01ff665fe545de8.png\" alt=\"2020030112\"></p>\n<p>2、不带id </p>\n<p><img src=\"https://image.eelve.com/eblog/2020030113-48589935a2ce456491006d43f0001194.png\" alt=\"2020030113\"><br><img src=\"https://image.eelve.com/eblog/2020030114-b2119fc6b17f46b998b9b1aed9be3481.png\" alt=\"2020030114\"></p>\n<h3 id=\"3-2-3-更新数据\"><a href=\"#3-2-3-更新数据\" class=\"headerlink\" title=\"3.2.3 更新数据\"></a>3.2.3 更新数据</h3><pre><code>在Elasticsearch中，文档数据是不为修改的，但是可以通过覆盖的方式进行更新。\n</code></pre>\n<p>1、全部修改</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030115-40f1443a848f42d7bf0b1e4a7895315b.png\" alt=\"2020030115\"><br><img src=\"https://image.eelve.com/eblog/2020030116-a6d802f5b1d040088d02bcd97ed58840.png\" alt=\"2020030116\"></p>\n<p>2、部分修改</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030117-7f32be33ca2b4f2796884f595f31c118.png\" alt=\"2020030117\"><br><img src=\"https://image.eelve.com/eblog/2020030118-69d2588cf500407c87744222d1b9f58a.png\" alt=\"2020030118\"></p>\n<p>可以看到局部更新成功</p>\n<h3 id=\"3-2-4-删除数据\"><a href=\"#3-2-4-删除数据\" class=\"headerlink\" title=\"3.2.4 删除数据\"></a>3.2.4 删除数据</h3><p><img src=\"https://image.eelve.com/eblog/2020030120-cf3c2d9526e94c559da3122114a23bea.png\" alt=\"2020030120\"><br><img src=\"https://image.eelve.com/eblog/2020030121-e5026bfd578247b585b0d1aa9f4f43e9.png\" alt=\"2020030121\"></p>\n<p>数据删除成功之后不会马上删除，只是会打上那个删除标识，Elasticsearch将会在你之后添加更多索引的时候才会在后台进行删除内容的清理。</p>\n<h3 id=\"3-2-5-搜索数据\"><a href=\"#3-2-5-搜索数据\" class=\"headerlink\" title=\"3.2.5 搜索数据\"></a>3.2.5 搜索数据</h3><p>1、根据id搜索</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030123-d35bcdb8e1a34c599da2c6af06b5999c.png\" alt=\"2020030123\"></p>\n<p>2、全部搜索</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030124-6dd8f7b0b6f64d43b78f007096a0266e.png\" alt=\"2020030124\"></p>\n<p>3、关键词搜索</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030125-6496d651790a4eeaaf6ef01d89007434.png\" alt=\"2020030125\"></p>\n<p>4、查询部分字段</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030128-39b83bc7128041ada8913de3d60d7f94.png\" alt=\"2020030128\"></p>\n<p>5、分页查询</p>\n<pre><code>和SQL使用 LIMIT 关键字返回只有一页的结果一样，Elasticsearch接受 from 和 size 参数：\n\nsize: 结果数，默认10\nfrom: 跳过开始的结果数，默认0\n</code></pre>\n<p><img src=\"https://image.eelve.com/eblog/2020030129-6cfe8b9d5e3e4eabb08e850336caa524.png\" alt=\"2020030129\"></p>\n<pre><code>应该当心分页太深或者一次请求太多的结果。结果在返回前会被排序。但是记住一个搜索请求常常涉及多个分片。每个分片生成自己排好序的结果，它们接着需要集中起来排序以确保整体排序正确。\n\n在集群系统中深度分页\n为了理解为什么深度分页是有问题的，让我们假设在一个有5个主分片的索引中搜索。当我们请求结果的第一页（结果1到10）时，每个分片产生自己最顶端10个结果然后返回它们给请求节点(requesting node)，\n它再排序这所有的50个结果以选出顶端的10个结果。现在假设我们请求第1000页——结果10001到10010。工作方式都相同，不同的是每个分片都必须产生顶端的10010个结果。\n然后请求节点排序这50050个结果并丢弃50040个！可以看到在分布式系统中，排序结果的花费随着分页的深入而成倍增长。这也是为什么网络搜索引擎中任何语句不能返回多于1000个结果的原因。\n</code></pre>\n<h3 id=\"3-2-6-DSL搜索\"><a href=\"#3-2-6-DSL搜索\" class=\"headerlink\" title=\"3.2.6 DSL搜索\"></a>3.2.6 DSL搜索</h3><pre><code>Elasticsearch提供丰富且灵活的查询语言叫做DSL查询(Query DSL),它允许你构建更加复杂、强大的查询。\nDSL(Domain Specific Language特定领域语言)以JSON请求体的形式出现\n</code></pre>\n<p><img src=\"https://image.eelve.com/eblog/2020030126-fdc18d55a95b49608130225d3aa15d67.png\" alt=\"2020030126\"></p>\n<p>如图我们查询了一个年龄大于10岁，性别为男性的数据</p>\n<h3 id=\"3-2-7-聚合\"><a href=\"#3-2-7-聚合\" class=\"headerlink\" title=\"3.2.7 聚合\"></a>3.2.7 聚合</h3><pre><code>在Elasticsearch中，支持聚合操作，类似SQL中的group by操作。\n</code></pre>\n<p><img src=\"https://image.eelve.com/eblog/2020030127-dbc8906ff8e540c58e7cb598aabd35e9.png\" alt=\"2020030127\"></p>\n<h3 id=\"3-2-8-bulk操作\"><a href=\"#3-2-8-bulk操作\" class=\"headerlink\" title=\"3.2.8 _bulk操作\"></a>3.2.8 _bulk操作</h3><pre><code>在Elasticsearch中，支持批量的插入、修改、删除操作，都是通过_bulk的api完成的。\n</code></pre>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; action: &#123; metadata &#125;&#125;\\n</span><br><span class=\"line\">&#123; request body &#125;\\n</span><br><span class=\"line\">&#123; action: &#123; metadata &#125;&#125;\\n</span><br><span class=\"line\">&#123; request body &#125;\\n</span><br><span class=\"line\">...</span><br><span class=\"line\"># 注意每行最后必须有 \\n</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>1、批量插入</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030130-c69ed9ae775445ef90e13bfcf726efd5.png\" alt=\"2020030130\"><br><img src=\"https://image.eelve.com/eblog/2020030131-d32f2761eb464fb085b671a34b08ac0d.png\" alt=\"2020030131\"></p>\n<p>2、批量删除</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030132-b483295fa7054414a91efcdfbdf689e0.png\" alt=\"2020030132\"><br><img src=\"https://image.eelve.com/eblog/2020030134-3433028e01d941e38d143f0f4f2a7bea.png\" alt=\"2020030134\"></p>\n<p>3、批量删除</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030135-13028e1a58e64b82a3f4a8f1316160fb.png\" alt=\"2020030135\"><br><img src=\"https://image.eelve.com/eblog/2020030136-deeff4eb87f143ee95b33468a59a7883.png\" alt=\"2020030136\"></p>\n<p>4、混合操作</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030137-486103db9fab4f16bb639e9ee13c0961.png\" alt=\"2020030137\"><br><img src=\"https://image.eelve.com/eblog/2020030138-dc89cd6f155c48b1a917072b6805c15e.png\" alt=\"2020030138\"></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;took&quot;</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;errors&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;items&quot;</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">&quot;update&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">&quot;_index&quot;</span>: <span class=\"string\">&quot;eelve&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_type&quot;</span>: <span class=\"string\">&quot;user&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;2002&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_version&quot;</span>: <span class=\"number\">2</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;result&quot;</span>: <span class=\"string\">&quot;updated&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;total&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;successful&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;failed&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_seq_no&quot;</span>: <span class=\"number\">7</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_primary_term&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">200</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">&quot;delete&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">&quot;_index&quot;</span>: <span class=\"string\">&quot;eelve&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_type&quot;</span>: <span class=\"string\">&quot;user&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_id&quot;</span>: <span class=\"string\">&quot;2003&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_version&quot;</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;result&quot;</span>: <span class=\"string\">&quot;deleted&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_shards&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;total&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;successful&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;failed&quot;</span>: <span class=\"number\">0</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_seq_no&quot;</span>: <span class=\"number\">8</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;_primary_term&quot;</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;status&quot;</span>: <span class=\"number\">200</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<pre><code>整个批量请求需要被加载到接受我们请求节点的内存里，所以请求越大，给其它请求可用的内存就越小。有一个最佳的bulk请求大小。\n超过这个大小，性能不再提升而且可能降低。\n\n最佳大小，当然并不是一个固定的数字。它完全取决于你的硬件、你文档的大小和复杂度以及索引和搜索的负载。\n幸运的是，这个最佳点(sweetspot)还是容易找到的：试着批量索引标准的文档，随着大小的增长，当性能开始降低，\n说明你每个批次的大小太大了。开始的数量可以在1000~5000个文档之间，如果你的文档非常大，可以使用较小的批次。\n通常着眼于你请求批次的物理大小是非常有用的。一千个1kB的文档和一千个1MB的文档大不相同。一个好的批次最好保持在5-15MB大小间。\n</code></pre>\n<h3 id=\"3-2-9-字段映射\"><a href=\"#3-2-9-字段映射\" class=\"headerlink\" title=\"3.2.9 字段映射\"></a>3.2.9 字段映射</h3><p>前面我们创建的索引以及插入数据，都是由Elasticsearch进行自动判断类型，有些时候我们是需要进行明确字段类型的，否则，自动判断的类型和实际需求是不相符的。</p>\n<p>自动判断的规则如下：</p>\n<table>\n<thead>\n<tr>\n<th>SON type</th>\n<th>Field type</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Boolean:</td>\n<td>true or false “boolean”</td>\n</tr>\n<tr>\n<td>Whole number:</td>\n<td>123 “long”</td>\n</tr>\n<tr>\n<td>Floating point:</td>\n<td>123.45 “double”</td>\n</tr>\n<tr>\n<td>String, valid date:</td>\n<td>“2014-09-15” “date”</td>\n</tr>\n<tr>\n<td>String:</td>\n<td>“foo bar” “string”</td>\n</tr>\n</tbody></table>\n<p>Elasticsearch中支持的类型如下：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>表示的数据类型</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>String</td>\n<td>string , text , keyword</td>\n</tr>\n<tr>\n<td>Whole number:</td>\n<td>byte , short , integer , long</td>\n</tr>\n<tr>\n<td>Floating point:</td>\n<td>float , double</td>\n</tr>\n<tr>\n<td>Boolean</td>\n<td>boolean</td>\n</tr>\n<tr>\n<td>Date</td>\n<td>date</td>\n</tr>\n</tbody></table>\n<pre><code>string类型在ElasticSearch 旧版本中使用较多，从ElasticSearch 5.x开始不再支持string，由text和keyword类型替代。\n\ntext 类型，当一个字段是要被全文搜索的，比如Email内容、产品描述，应该使用text类型。设置text类型以后，字段内容会被分析，\n在生成倒排索引以前，字符串会被分析器分成一个一个词项。text类型的字段不用于排序，很少用于聚合。\n\nkeyword类型适用于索引结构化的字段，比如email地址、主机名、状态码和标签。如果字段需要进行过滤(比如查找已发布博客中status属性为published的文章)、排序、聚合。\nkeyword类型的字段只能通过精确值搜索到。\n</code></pre>\n<p><img src=\"https://image.eelve.com/eblog/2020030140-8a169a5294044d41bcfbc531ffa262fb.png\" alt=\"2020030140\"></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attr\">&quot;settings&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;index&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;number_of_shards&quot;</span>: <span class=\"string\">&quot;2&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;number_of_replicas&quot;</span>: <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;mappings&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;properties&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;name&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;age&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;integer&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;mail&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;hobby&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://image.eelve.com/eblog/2020030141-6749ff764e8f46c6a4a2a1e356c129de.png\" alt=\"2020030141\"></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;iio&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">&quot;aliases&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">        <span class=\"attr\">&quot;mappings&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">&quot;properties&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">&quot;age&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;integer&quot;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"attr\">&quot;hobby&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"attr\">&quot;mail&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"attr\">&quot;name&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"attr\">&quot;settings&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">&quot;index&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">&quot;creation_date&quot;</span>: <span class=\"string\">&quot;1583052049836&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;number_of_shards&quot;</span>: <span class=\"string\">&quot;2&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;number_of_replicas&quot;</span>: <span class=\"string\">&quot;0&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;uuid&quot;</span>: <span class=\"string\">&quot;CFfnz0C0SnSkgceUONQNEA&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;version&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;created&quot;</span>: <span class=\"string\">&quot;7060099&quot;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"attr\">&quot;provided_name&quot;</span>: <span class=\"string\">&quot;iio&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注意的是7.x的版本我6.x的版本创建索引不一样，6.x还需要在properties外面用类型包裹，下面给一个示例</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attr\">&quot;settings&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;index&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;number_of_shards&quot;</span>: <span class=\"string\">&quot;2&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;number_of_replicas&quot;</span>: <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">&quot;mappings&quot;</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">&quot;person&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">&quot;properties&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;name&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;age&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;integer&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;mail&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;keyword&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">&quot;hobby&quot;</span>: &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">&quot;type&quot;</span>: <span class=\"string\">&quot;text&quot;</span></span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"肆、注意事项\"><a href=\"#肆、注意事项\" class=\"headerlink\" title=\"肆、注意事项\"></a>肆、注意事项</h1><p>注意版本差异，具体关注官方。我这边所演示的整个Elastic stack家族的版本都为7.6.0。另外批量操作的时候，如果有其中某一条执行失败的话，并不会影响其他执行正确的结果。</p>\n<hr>\n<p>【<strong>后面的话</strong>】记住Elasticsearch是整个<strong>Elastic Stack</strong>的核心。具有查询分析、高速度、可扩展性、相关度和弹性，后面我们还会具体实践。另外关于Elasticsearch的还有组合搜索，权重，分词等等还没有实践，等后面实践之后文章会继续更新，可能会写一篇关于Elasticsearch深度使用的文章。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Elasticsearch","path":"api/tags/Elasticsearch.json"}]},{"title":"Elastic Stack实战之Metricbeat初体验","slug":"Elastic-Stack实战之Metricbeat初体验","date":"2020-03-07T13:36:20.000Z","updated":"2023-09-30T08:39:39.667Z","comments":true,"path":"api/articles/Elastic-Stack实战之Metricbeat初体验.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/screenshot-infrastructure-ui-d2c3e13f47f74d82a6f0f6c2799d94f8.png","content":"<p>【<strong>前面的话</strong>】<a href=\"https://eelve.com/posts/d1a5ff40.html\">前面介绍了Elastic Stack的Beats家族</a>，并且<a href=\"https://eelve.com/posts/1d8b943d.html\">体验了Filebeat</a>，接下来我们就继续来体验一下</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Logstash:</span> <span class=\"string\">logstash-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Kibana:</span> <span class=\"string\">kibana-7.6.0</span></span><br><span class=\"line\"><span class=\"string\">MetricBeat：filebeat-7.6.0</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、MetricBeat介绍\"><a href=\"#贰、MetricBeat介绍\" class=\"headerlink\" title=\"贰、MetricBeat介绍\"></a>贰、MetricBeat介绍</h1><p>MetricBeat是一种轻量型指标采集器，用于从系统和服务收集指标。Metricbeat 能够以一种轻量型的方式，输送各种系统和服务统计数据，从 CPU 到内存，从 Redis 到 Nginx，不一而足。</p>\n<ul>\n<li>系统级监控，更简洁</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-infrastructure-ui-d2c3e13f47f74d82a6f0f6c2799d94f8.png\" alt=\"screenshot-infrastructure-ui\"></p>\n<ul>\n<li><p>单个二进制文件提供多种模块</p>\n<p>Metricbeat 提供多种内部模块，这些模块可从多项服务（诸如 Apache、Jolokia、NGINX、MongoDB、MySQL、PostgreSQL、Prometheus 等等）中收集指标。安装简单，完全零依赖性。只需在配置文件中启用您所需的模块即可。</p>\n<p>而且，如果您没有看到要找的模块，还可以自己构建。以 Go 语言编写 Metricbeat 模块，过程十分简单。 </p>\n<ul>\n<li>系统</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/metricbeat-modules-system-7f76e2200cfb40089bb112f50aae710e.jpg\" alt=\"metricbeat-modules-system\"></p>\n<ul>\n<li>Docker</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/container-monitoring-screenshot-carousel-docker-908943a547964d11996a9775855235f0.jpg\" alt=\"container-monitoring-screenshot-carousel-docker\"></p>\n<ul>\n<li>MongoDB</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/metricbeat-modules-mongo-d5d719649a7a4e2a9bf9f1a984528efc.jpg\" alt=\"metricbeat-modules-mongo\"></p>\n<ul>\n<li>Kubernetes</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/container-monitoring-screenshot-carousel-kubernetes-0ee5a1fdacf74c3b82d12c81c5c14af1.jpg\" alt=\"container-monitoring-screenshot-carousel-kubernetes\"></p>\n</li>\n<li><p>容器就绪 </p>\n<p>近来是不是所有工作都转移到了 Docker 中？通过 Elastic Stack，您能够轻松地监测容器。将 Metricbeat 部署到同一台主机上的一个单独容器后，它将收集与主机上运行的其他每一个容器相关的统计数据。在收集统计数据时，它直接从 proc 文件系统读取 cgroup 信息，这就意味着它无需特权即可访问 Docker API，并且同样适用于其他 Runtime。针对 Docker 的 Autodiscovery 让事情进一步简化，您只需指定一个条件即可开启 Metricbeat 模块。 </p>\n</li>\n<li><p>不错过任何检测信号</p>\n<p>将指标通过假脱机传输方式输送至磁盘，这样您的数据管道再也不会错过任何一个数据点，即使发生中断（例如网络问题），也勿需担心。Metricbeat 会保留传入的数据，并在重新上线后将这些指标输送至 Elasticsearch 或 Logstash。 </p>\n</li>\n</ul>\n<ul>\n<li><p>输送至 Elasticsearch 或 Logstash。在 Kibana 中实现可视化。</p>\n<p>Metricbeat 是 Elastic Stack 的一部分，因此能够与 Logstash、Elasticsearch 和 Kibana 无缝协作。无论您要使用 Logstash 转换或充实指标，还是在 Elasticsearch 中随意处理一些数据分析，亦或在 Kibana 中构建和分享仪表板，Metricbeat 都能轻松地将您的数据发送至最关键的地方。</p>\n</li>\n</ul>\n<h1 id=\"叁-MetricBeat安装\"><a href=\"#叁-MetricBeat安装\" class=\"headerlink\" title=\"叁 MetricBeat安装\"></a>叁 MetricBeat安装</h1><h2 id=\"3-1-下载地址\"><a href=\"#3-1-下载地址\" class=\"headerlink\" title=\"3.1 下载地址\"></a>3.1 下载地址</h2><p><a href=\"https://artifacts.elastic.co/downloads/beats/filebeat/metricBeat-7.6.0-linux-x86_64.tar.gz\">metricBeat-7.6.0-linux-x86_64</a></p>\n<h2 id=\"3-2-解压metricBeat-7-6-0-linux-x86-64\"><a href=\"#3-2-解压metricBeat-7-6-0-linux-x86-64\" class=\"headerlink\" title=\"3.2 解压metricBeat-7.6.0-linux-x86_64\"></a>3.2 解压metricBeat-7.6.0-linux-x86_64</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zvxf metricBeat-7.6.0-linux-x86_64.tar.gz -C /usr/elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-3-使用Kibana展示Metricbeat系统指标\"><a href=\"#3-3-使用Kibana展示Metricbeat系统指标\" class=\"headerlink\" title=\"3.3 使用Kibana展示Metricbeat系统指标\"></a>3.3 使用Kibana展示Metricbeat系统指标</h2><ul>\n<li>修改Metricbeat配置</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\"> Array of hosts to connect to.</span></span><br><span class=\"line\">  hosts: [&quot;http://192.168.237.11:9200&quot;]</span><br></pre></td></tr></table></figure>\n<ul>\n<li>启动</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 metricbeat]$ ./metricbeat -e</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在Elasticsearch中查看采集的数据</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/2020030707-906f151d4ab34f7c8bbcfea65d83f8e9.png\" alt=\"2020030707\"></p>\n<ul>\n<li>修改Metricbeat配置</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setup.kibana:</span><br><span class=\"line\">  host: &quot;192.168.237.11:5601&quot;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>安装仪表盘</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./metricbeat setup --dashboards</span><br></pre></td></tr></table></figure>\n<ul>\n<li>重启服务查看效果</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/2020030708-ba77ee4e36c6478c8b816a314d730f80.png\" alt=\"2020030708\"><br><img src=\"https://image.eelve.com/eblog/2020030709-a40f0d5711fc4707a416e2c39bbbcb79.png\" alt=\"2020030709\"></p>\n<p>到这里我们就监控了我们系统的指标，并且利用Kibana提供的仪表板做了图形化展示。</p>\n<h2 id=\"3-4-使用Kibana展示Metricbeat采集nginx指标\"><a href=\"#3-4-使用Kibana展示Metricbeat采集nginx指标\" class=\"headerlink\" title=\"3.4 使用Kibana展示Metricbeat采集nginx指标\"></a>3.4 使用Kibana展示Metricbeat采集nginx指标</h2><ul>\n<li><p>开启nginx的状态查询</p>\n<p>在nginx中，需要开启状态查询，才能查询到指标数据。</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">重新编译nginx</span></span><br><span class=\"line\">./configure --prefix=/usr/local/nginx --with-http_stub_status_module</span><br><span class=\"line\">make</span><br><span class=\"line\">make install</span><br><span class=\"line\"></span><br><span class=\"line\">./nginx -V #查询版本信息</span><br><span class=\"line\">nginx version: nginx/1.12.0</span><br><span class=\"line\">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC) </span><br><span class=\"line\">configure arguments: --prefix=/usr/local/nginx/ --with-http_stub_status_module</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">配置nginx</span></span><br><span class=\"line\">vi nginx.conf</span><br><span class=\"line\">location /nginx-status &#123;</span><br><span class=\"line\">    stub_status on;</span><br><span class=\"line\">    access_log off;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://image.eelve.com/eblog/2020030710-267475b4b77648ccb8d57c0fece62055.png\" alt=\"2020030710\"></p>\n<p>结果说明：</p>\n<ul>\n<li>Active connections：正在处理的活动连接数</li>\n<li>server accepts handled requests<ul>\n<li>第一个 server 表示Nginx启动到现在共处理了22个连接</li>\n<li>第二个 accepts 表示Nginx启动到现在共成功创建 22 次握手</li>\n<li>第三个 handled requests 表示总共处理了 193 次请求</li>\n<li>请求丢失数 = 握手数 - 连接数 ，可以看出目前为止没有丢失请求</li>\n</ul>\n</li>\n<li>Reading: 0 Writing: 1 Waiting: 2<ul>\n<li>Reading：Nginx 读取到客户端的 Header 信息数</li>\n<li>Writing：Nginx 返回给客户端 Header 信息数</li>\n<li>Waiting：Nginx 已经处理完正在等候下一次请求指令的驻留链接（开启keep-alive的情况下，这个值等于 Active - (Reading+Writing)）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<ul>\n<li><p>配置Nginx Module</p>\n<p>默认Metricbeat之开启了system modules，所以我们这里要手动启用nginx modules</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./metricbeat modules enable nginx</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 metricbeat]$ ./metricbeat modules list</span><br><span class=\"line\">Enabled:</span><br><span class=\"line\">nginx</span><br><span class=\"line\">system</span><br><span class=\"line\"></span><br><span class=\"line\">Disabled:</span><br><span class=\"line\">activemq</span><br><span class=\"line\">aerospike</span><br><span class=\"line\">apache</span><br><span class=\"line\">appsearch</span><br><span class=\"line\">aws</span><br><span class=\"line\">azure</span><br><span class=\"line\">beat</span><br><span class=\"line\">beat-xpack</span><br><span class=\"line\">ceph</span><br><span class=\"line\">cockroachdb</span><br><span class=\"line\">consul</span><br><span class=\"line\">coredns</span><br><span class=\"line\">couchbase</span><br><span class=\"line\">couchdb</span><br><span class=\"line\">docker</span><br><span class=\"line\">dropwizard</span><br><span class=\"line\">elasticsearch</span><br><span class=\"line\">elasticsearch-xpack</span><br><span class=\"line\">envoyproxy</span><br><span class=\"line\">etcd</span><br><span class=\"line\">golang</span><br><span class=\"line\">googlecloud</span><br><span class=\"line\">graphite</span><br><span class=\"line\">haproxy</span><br><span class=\"line\">http</span><br><span class=\"line\">jolokia</span><br><span class=\"line\">kafka</span><br><span class=\"line\">kibana</span><br><span class=\"line\">kibana-xpack</span><br><span class=\"line\">kubernetes</span><br><span class=\"line\">kvm</span><br><span class=\"line\">logstash</span><br><span class=\"line\">logstash-xpack</span><br><span class=\"line\">memcached</span><br><span class=\"line\">mongodb</span><br><span class=\"line\">mssql</span><br><span class=\"line\">munin</span><br><span class=\"line\">mysql</span><br><span class=\"line\">nats</span><br><span class=\"line\">oracle</span><br><span class=\"line\">php_fpm</span><br><span class=\"line\">postgresql</span><br><span class=\"line\">prometheus</span><br><span class=\"line\">rabbitmq</span><br><span class=\"line\">redis</span><br><span class=\"line\">sql</span><br><span class=\"line\">stan</span><br><span class=\"line\">statsd</span><br><span class=\"line\">tomcat</span><br><span class=\"line\">traefik</span><br><span class=\"line\">uwsgi</span><br><span class=\"line\">vsphere</span><br><span class=\"line\">windows</span><br><span class=\"line\">zookeeper</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>修改nginx modules的配置</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 modules.d]$ vi nginx.yml </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Module: nginx</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Docs: https://www.elastic.co/guide/en/beats/metricbeat/7.6/metricbeat-module-nginx.html</span></span><br><span class=\"line\"></span><br><span class=\"line\">- module: nginx</span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\">metricsets:</span></span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\">  - stubstatus</span></span><br><span class=\"line\">  period: 10s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\"> Nginx hosts</span></span><br><span class=\"line\">  hosts: [&quot;http://192.168.237.11&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\"> Path to server status. Default server-status</span></span><br><span class=\"line\">  server_status_path: &quot;nginx-status&quot; #配置的nginx状态访问地址</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\">username: <span class=\"string\">&quot;user&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\">password: <span class=\"string\">&quot;secret&quot;</span></span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n<li><p>启动测试</p>\n</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/2020030711-c1217270b05241ca96fa42f063ba8d9f.png\" alt=\"2020030711\"><br><img src=\"https://image.eelve.com/eblog/2020030712-8ae5730e5301448b974d67545ff98e7a.png\" alt=\"2020030712\"></p>\n<p>到这里我们采集的nginx的指标数据，并且利用Kibana安装的Metricbeatd的nginx仪表盘做了图形化展示。</p>\n<h1 id=\"肆、Metricbeat组成\"><a href=\"#肆、Metricbeat组成\" class=\"headerlink\" title=\"肆、Metricbeat组成\"></a>肆、Metricbeat组成</h1><p>Metricbeat有2部分组成，一部分是Module，另一部分为Metricset。</p>\n<ul>\n<li><p>Module</p>\n<p>收集的对象，如：mysql、redis、nginx、操作系统等；</p>\n</li>\n<li><p>Metricset</p>\n<p>收集指标的集合，如：cpu、memory、network等；  </p>\n</li>\n</ul>\n<hr>\n<p>【<strong>后面的话</strong>】在本文中我们利用Metricbeat监控了系统和nginx的系统指标，并且做了图标化的展示。其他module的使用也类似，他们都是利用Metricbeat给被监控的机器放松状态指令，然后采集数据，再做图形化的展示。同时我们也看到Merticbeat也内置了很多的module，足够了我们日工作需要了。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Beats","path":"api/tags/Beats.json"},{"name":"MetricBeat","path":"api/tags/MetricBeat.json"}]},{"title":"Elastic Stack实战之Logstash初体验","slug":"Elastic-Stack实战之Logstash初体验","date":"2020-03-02T13:49:22.000Z","updated":"2021-04-19T06:52:48.634Z","comments":true,"path":"api/articles/Elastic-Stack实战之Logstash初体验.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/illustration-logstash-header-55d54f588c3b4ba89da489277ca709dc.png","content":"<p>【<strong>前面的话</strong>】在前面已经安装好了Elasticsearch，今天就来对 Logstash](<a href=\"https://www.elastic.co/cn/logstash)%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%B8%8B%E5%88%9D%E6%AD%A5%E4%BD%93%E9%AA%8C%E3%80%82\">https://www.elastic.co/cn/logstash)进行一下初步体验。</a></p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Logstash:</span> <span class=\"string\">logstash-7.6.0</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、Logstash介绍\"><a href=\"#贰、Logstash介绍\" class=\"headerlink\" title=\"贰、Logstash介绍\"></a>贰、Logstash介绍</h1><p><img src=\"https://image.eelve.com/eblog/illustration-logstash-header-55d54f588c3b4ba89da489277ca709dc.png\" alt=\"illustration-logstash-header\"></p>\n<pre><code>Logstash 的主要作用是集中、转换和存储数据。是开源的服务器端数据处理管道，能够同时从多个来源采集数据，转换数据，然后将数据发送到您最喜欢的“存储库”中。\n\nLogstash 能够动态地采集、转换和传输数据，不受格式或复杂度的影响。利用 Grok 从非结构化数据中派生出结构，从 IP 地址解码出地理坐标，匿名化或排除敏感字段，并简化整体处理过程。\n\nLogstash 采集，还有更多输入、过滤器和输出\n</code></pre>\n<p><strong>输入：</strong> 采集各种样式、大小和来源的数据</p>\n<p><img src=\"https://image.eelve.com/eblog/diagram-logstash-inputs-2825f9dced964c4abae8dcd1f3012261.svg\" alt=\"diagram-logstash-inputs\"></p>\n<pre><code>数据往往以各种各样的形式，或分散或集中地存在于很多系统中。 Logstash 支持 各种输入选择 ，可以在同一时间从众多常用来源捕捉事件。能够以连续的流式传输方式，轻松地从您的日志、指标、Web 应用、数据存储以及各种 AWS 服务采集数据。 \n</code></pre>\n<p><strong>过滤器：</strong> 实时解析和转换数据</p>\n<p><img src=\"https://image.eelve.com/eblog/diagram-logstash-filters-62adaf05398e48f688e1357503b43f81.svg\" alt=\"diagram-logstash-filters\"></p>\n<pre><code>数据从源传输到存储库的过程中，Logstash 过滤器能够解析各个事件，识别已命名的字段以构建结构，并将它们转换成通用格式，以便更轻松、更快速地分析和实现商业价值。\n\n    利用 Grok 从非结构化数据中派生出结构\n    从 IP 地址破译出地理坐标\n    将 PII 数据匿名化，完全排除敏感字段\n    简化整体处理，不受数据源、格式或架构的影响 \n\n我们的过滤器库丰富多样，拥有无限可能。     \n</code></pre>\n<p><strong>输出：</strong> 选择您的存储库，导出您的数据</p>\n<p><img src=\"https://image.eelve.com/eblog/diagram-logstash-outputs-fe56db1595444ddfafe48d62d5623627.svg\" alt=\"diagram-logstash-outputs\"></p>\n<pre><code> 尽管 Elasticsearch 是我们的首选输出方向，能够为我们的搜索和分析带来无限可能，但它并非唯一选择。\n\nLogstash 提供众多输出选择，您可以将数据发送到您要指定的地方，并且能够灵活地解锁众多下游用例。 \n</code></pre>\n<p><strong>可扩展：</strong> 以自己的方式创建和配置管道</p>\n<pre><code>Logstash 采用可插拔框架，拥有 200 多个插件。您可以将不同的输入选择、过滤器和输出选择混合搭配、精心安排，让它们在管道中和谐地运行。\n\n从自定义应用程序采集数据？没有看到所需的插件？Logstash 插件很容易构建。我们有一个极好的插件开发 API 和插件生成器，可帮助您开始创作并分享成果。\n</code></pre>\n<h1 id=\"叁、Logstash安装\"><a href=\"#叁、Logstash安装\" class=\"headerlink\" title=\"叁、Logstash安装\"></a>叁、Logstash安装</h1><h2 id=\"3-1-下载地址\"><a href=\"#3-1-下载地址\" class=\"headerlink\" title=\"3.1 下载地址\"></a>3.1 下载地址</h2><p><a href=\"https://artifacts.elastic.co/downloads/logstash/logstash-7.6.0.tar.gz\">logstash-7.6.0.tar.gz</a></p>\n<hr>\n<h2 id=\"3-2-解压logstash-7-6-0-tar-gz\"><a href=\"#3-2-解压logstash-7-6-0-tar-gz\" class=\"headerlink\" title=\"3.2 解压logstash-7.6.0.tar.gz\"></a>3.2 解压logstash-7.6.0.tar.gz</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zvxf logstash-7.6.0.tar.gz -C /usr/elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-3-elasticsearch配置说明\"><a href=\"#3-3-elasticsearch配置说明\" class=\"headerlink\" title=\"3.3 elasticsearch配置说明\"></a>3.3 elasticsearch配置说明</h2><p>Logstash的配置有三部分，如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123; #输入</span><br><span class=\"line\">    stdin &#123; ... &#125; #标准输入</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    filter &#123; #过滤，对数据进行分割、截取等处理</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123; #输出</span><br><span class=\"line\">    stdout &#123; ... &#125; #标准输出</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"肆、Logstash简单使用\"><a href=\"#肆、Logstash简单使用\" class=\"headerlink\" title=\"肆、Logstash简单使用\"></a>肆、Logstash简单使用</h1><h2 id=\"4-1-采集控制台日志\"><a href=\"#4-1-采集控制台日志\" class=\"headerlink\" title=\"4.1 采集控制台日志\"></a>4.1 采集控制台日志</h2><p>启动命令：./logstash -e ‘input { stdin { } } output { stdout {} }’</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./logstash -e &#x27;input &#123; stdin &#123; &#125; &#125; output &#123; stdout &#123;&#125; &#125;&#x27;</span><br><span class=\"line\">Sending Logstash logs to /usr/elastic/logstash/logs which is now configured via log4j2.properties</span><br><span class=\"line\">[2020-03-01T18:00:48,316][WARN ][logstash.config.source.multilocal] Ignoring the &#x27;pipelines.yml&#x27; file because modules or command line options are specified</span><br><span class=\"line\">[2020-03-01T18:00:48,495][INFO ][logstash.runner          ] Starting Logstash &#123;&quot;logstash.version&quot;=&gt;&quot;7.6.0&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:00:50,395][INFO ][org.reflections.Reflections] Reflections took 48 ms to scan 1 urls, producing 20 keys and 40 values </span><br><span class=\"line\">[2020-03-01T18:00:51,788][WARN ][org.logstash.instrument.metrics.gauge.LazyDelegatingGauge][main] A gauge metric of an unknown type (org.jruby.RubyArray) has been create for key: cluster_uuids. This may result in invalid serialization.  It is recommended to log an issue to the responsible developer/development team.</span><br><span class=\"line\">[2020-03-01T18:00:51,810][INFO ][logstash.javapipeline    ][main] Starting pipeline &#123;:pipeline_id=&gt;&quot;main&quot;, &quot;pipeline.workers&quot;=&gt;4, &quot;pipeline.batch.size&quot;=&gt;125, &quot;pipeline.batch.delay&quot;=&gt;50, &quot;pipeline.max_inflight&quot;=&gt;500, &quot;pipeline.sources&quot;=&gt;[&quot;config string&quot;], :thread=&gt;&quot;#&lt;Thread:0x3fa519f0 run&gt;&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:00:52,795][INFO ][logstash.javapipeline    ][main] Pipeline started &#123;&quot;pipeline.id&quot;=&gt;&quot;main&quot;&#125;</span><br><span class=\"line\">The stdin plugin is now waiting for input:</span><br><span class=\"line\">[2020-03-01T18:00:52,892][INFO ][logstash.agent           ] Pipelines running &#123;:count=&gt;1, :running_pipelines=&gt;[:main], :non_running_pipelines=&gt;[]&#125;</span><br><span class=\"line\">[2020-03-01T18:00:53,277][INFO ][logstash.agent           ] Successfully started Logstash API endpoint &#123;:port=&gt;9600&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">/usr/elastic/logstash/vendor/bundle/jruby/2.5.0/gems/awesome_print-1.7.0/lib/awesome_print/formatters/base_formatter.rb:31: warning: constant ::Fixnum is deprecated</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">          &quot;host&quot; =&gt; &quot;192.168.237.11&quot;,</span><br><span class=\"line\">       &quot;message&quot; =&gt; &quot;&quot;,</span><br><span class=\"line\">    &quot;@timestamp&quot; =&gt; 2020-03-01T10:01:05.128Z,</span><br><span class=\"line\">      &quot;@version&quot; =&gt; &quot;1&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">          &quot;host&quot; =&gt; &quot;192.168.237.11&quot;,</span><br><span class=\"line\">       &quot;message&quot; =&gt; &quot;&quot;,</span><br><span class=\"line\">    &quot;@timestamp&quot; =&gt; 2020-03-01T10:01:05.334Z,</span><br><span class=\"line\">      &quot;@version&quot; =&gt; &quot;1&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">          &quot;host&quot; =&gt; &quot;192.168.237.11&quot;,</span><br><span class=\"line\">       &quot;message&quot; =&gt; &quot;&quot;,</span><br><span class=\"line\">    &quot;@timestamp&quot; =&gt; 2020-03-01T10:01:05.523Z,</span><br><span class=\"line\">      &quot;@version&quot; =&gt; &quot;1&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">hello world</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">          &quot;host&quot; =&gt; &quot;192.168.237.11&quot;,</span><br><span class=\"line\">       &quot;message&quot; =&gt; &quot;hello world&quot;,</span><br><span class=\"line\">    &quot;@timestamp&quot; =&gt; 2020-03-01T10:01:20.320Z,</span><br><span class=\"line\">      &quot;@version&quot; =&gt; &quot;1&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"4-2-采集自定义日志\"><a href=\"#4-2-采集自定义日志\" class=\"headerlink\" title=\"4.2 采集自定义日志\"></a>4.2 采集自定义日志</h2><h3 id=\"4-2-1-日志结构\"><a href=\"#4-2-1-日志结构\" class=\"headerlink\" title=\"4.2.1 日志结构\"></a>4.2.1 日志结构</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-03-02 20:08:20|ERROR|数据库连接出错|参数：id&#x3D;1002</span><br></pre></td></tr></table></figure>\n<p>可以看到，日志中的内容是使用“|”进行分割的，使用，我们在处理的时候，也需要对数据做分割处理。</p>\n<h3 id=\"4-2-2-编写配置\"><a href=\"#4-2-2-编写配置\" class=\"headerlink\" title=\"4.2.2 编写配置\"></a>4.2.2 编写配置</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ vi ../config/logstash-diy.yml </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">    file &#123;</span><br><span class=\"line\">        path =&gt; &quot;/usr/elastic/logs/diy.log&quot;</span><br><span class=\"line\">        start_position =&gt; &quot;beginning&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">filter &#123;</span><br><span class=\"line\">    mutate &#123;</span><br><span class=\"line\">        split =&gt; &#123;&quot;message&quot;=&gt;&quot;|&quot;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">    stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-2-3-启动测试\"><a href=\"#4-2-3-启动测试\" class=\"headerlink\" title=\"4.2.3 启动测试\"></a>4.2.3 启动测试</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./logstash -f ../config/logstash-diy.yml </span><br><span class=\"line\">Sending Logstash logs to /usr/elastic/logstash/logs which is now configured via log4j2.properties</span><br><span class=\"line\">[2020-03-01T18:15:06,549][WARN ][logstash.config.source.multilocal] Ignoring the &#x27;pipelines.yml&#x27; file because modules or command line options are specified</span><br><span class=\"line\">[2020-03-01T18:15:06,682][INFO ][logstash.runner          ] Starting Logstash &#123;&quot;logstash.version&quot;=&gt;&quot;7.6.0&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:15:08,737][INFO ][org.reflections.Reflections] Reflections took 38 ms to scan 1 urls, producing 20 keys and 40 values </span><br><span class=\"line\">[2020-03-01T18:15:10,140][WARN ][org.logstash.instrument.metrics.gauge.LazyDelegatingGauge][main] A gauge metric of an unknown type (org.jruby.RubyArray) has been create for key: cluster_uuids. This may result in invalid serialization.  It is recommended to log an issue to the responsible developer/development team.</span><br><span class=\"line\">[2020-03-01T18:15:10,167][INFO ][logstash.javapipeline    ][main] Starting pipeline &#123;:pipeline_id=&gt;&quot;main&quot;, &quot;pipeline.workers&quot;=&gt;4, &quot;pipeline.batch.size&quot;=&gt;125, &quot;pipeline.batch.delay&quot;=&gt;50, &quot;pipeline.max_inflight&quot;=&gt;500, &quot;pipeline.sources&quot;=&gt;[&quot;/usr/elastic/logstash/config/logstash-diy.yml&quot;], :thread=&gt;&quot;#&lt;Thread:0x26d10ea9 run&gt;&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:15:11,223][INFO ][logstash.inputs.file     ][main] No sincedb_path set, generating one based on the &quot;path&quot; setting &#123;:sincedb_path=&gt;&quot;/usr/elastic/logstash/data/plugins/inputs/file/.sincedb_b626b2bdb9f76816ac98ff32e97c96bf&quot;, :path=&gt;[&quot;/usr/elastic/logs/diy.log&quot;]&#125;</span><br><span class=\"line\">[2020-03-01T18:15:11,266][INFO ][logstash.javapipeline    ][main] Pipeline started &#123;&quot;pipeline.id&quot;=&gt;&quot;main&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:15:11,367][INFO ][filewatch.observingtail  ][main] START, creating Discoverer, Watch with file and sincedb collections</span><br><span class=\"line\">[2020-03-01T18:15:11,367][INFO ][logstash.agent           ] Pipelines running &#123;:count=&gt;1, :running_pipelines=&gt;[:main], :non_running_pipelines=&gt;[]&#125;</span><br><span class=\"line\">[2020-03-01T18:15:11,703][INFO ][logstash.agent           ] Successfully started Logstash API endpoint &#123;:port=&gt;9600&#125;</span><br><span class=\"line\">/usr/elastic/logstash/vendor/bundle/jruby/2.5.0/gems/awesome_print-1.7.0/lib/awesome_print/formatters/base_formatter.rb:31: warning: constant ::Fixnum is deprecated</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">          &quot;path&quot; =&gt; &quot;/usr/elastic/logs/diy.log&quot;,</span><br><span class=\"line\">          &quot;host&quot; =&gt; &quot;192.168.237.11&quot;,</span><br><span class=\"line\">    &quot;@timestamp&quot; =&gt; 2020-03-01T10:16:57.260Z,</span><br><span class=\"line\">       &quot;message&quot; =&gt; [</span><br><span class=\"line\">        [0] &quot;2020-03-02 20:08:20&quot;,</span><br><span class=\"line\">        [1] &quot;ERROR&quot;,</span><br><span class=\"line\">        [2] &quot;数据库连接出错&quot;,</span><br><span class=\"line\">        [3] &quot;参数：id=1002&quot;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">      &quot;@version&quot; =&gt; &quot;1&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后输出日志到diy.log文件中</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo &quot;20120-03-02 20:21:21|ERROR|读取数据出错|参数：id=1003&quot; &gt;&gt; diy.log</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">          &quot;path&quot; =&gt; &quot;/usr/elastic/logs/diy.log&quot;,</span><br><span class=\"line\">          &quot;host&quot; =&gt; &quot;192.168.237.11&quot;,</span><br><span class=\"line\">    &quot;@timestamp&quot; =&gt; 2020-03-01T10:17:11.442Z,</span><br><span class=\"line\">       &quot;message&quot; =&gt; [</span><br><span class=\"line\">        [0] &quot;20120-03-02 20:21:21&quot;,</span><br><span class=\"line\">        [1] &quot;ERROR&quot;,</span><br><span class=\"line\">        [2] &quot;读取数据出错&quot;,</span><br><span class=\"line\">        [3] &quot;参数：id=1003&quot;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">      &quot;@version&quot; =&gt; &quot;1&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们可以看到日志已经通过”|”被分割出来了。</p>\n<h2 id=\"4-3-输出到Elasticsearch\"><a href=\"#4-3-输出到Elasticsearch\" class=\"headerlink\" title=\"4.3 输出到Elasticsearch\"></a>4.3 输出到Elasticsearch</h2><h3 id=\"4-3-1-编写配置\"><a href=\"#4-3-1-编写配置\" class=\"headerlink\" title=\"4.3.1 编写配置\"></a>4.3.1 编写配置</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ vi ../config/logstash-elastic.yml </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123;</span><br><span class=\"line\">    file &#123;</span><br><span class=\"line\">        path =&gt; &quot;/usr/elastic/logs/diy.log&quot;</span><br><span class=\"line\">        start_position =&gt; &quot;beginning&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">filter &#123;</span><br><span class=\"line\">    mutate &#123;</span><br><span class=\"line\">        split =&gt; &#123;&quot;message&quot;=&gt;&quot;|&quot;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">    stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;192.168.237.11:9200&quot;]</span><br><span class=\"line\">        index =&gt; &quot;elastic-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"4-3-2-启动测试\"><a href=\"#4-3-2-启动测试\" class=\"headerlink\" title=\"4.3.2 启动测试\"></a>4.3.2 启动测试</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./logstash -f ../config/logstash-elastic.yml </span><br><span class=\"line\">Sending Logstash logs to /usr/elastic/logstash/logs which is now configured via log4j2.properties</span><br><span class=\"line\">[2020-03-01T18:26:42,445][WARN ][logstash.config.source.multilocal] Ignoring the &#x27;pipelines.yml&#x27; file because modules or command line options are specified</span><br><span class=\"line\">[2020-03-01T18:26:42,638][INFO ][logstash.runner          ] Starting Logstash &#123;&quot;logstash.version&quot;=&gt;&quot;7.6.0&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:26:45,170][INFO ][org.reflections.Reflections] Reflections took 46 ms to scan 1 urls, producing 20 keys and 40 values </span><br><span class=\"line\">[2020-03-01T18:26:47,179][INFO ][logstash.outputs.elasticsearch][main] Elasticsearch pool URLs updated &#123;:changes=&gt;&#123;:removed=&gt;[], :added=&gt;[http://192.168.237.11:9200/]&#125;&#125;</span><br><span class=\"line\">[2020-03-01T18:26:47,487][WARN ][logstash.outputs.elasticsearch][main] Restored connection to ES instance &#123;:url=&gt;&quot;http://192.168.237.11:9200/&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:26:47,553][INFO ][logstash.outputs.elasticsearch][main] ES Output version determined &#123;:es_version=&gt;7&#125;</span><br><span class=\"line\">[2020-03-01T18:26:47,561][WARN ][logstash.outputs.elasticsearch][main] Detected a 6.x and above cluster: the `type` event field won&#x27;t be used to determine the document _type &#123;:es_version=&gt;7&#125;</span><br><span class=\"line\">[2020-03-01T18:26:47,760][INFO ][logstash.outputs.elasticsearch][main] New Elasticsearch output &#123;:class=&gt;&quot;LogStash::Outputs::ElasticSearch&quot;, :hosts=&gt;[&quot;//192.168.237.11:9200&quot;]&#125;</span><br><span class=\"line\">[2020-03-01T18:26:47,855][INFO ][logstash.outputs.elasticsearch][main] Using default mapping template</span><br><span class=\"line\">[2020-03-01T18:26:47,900][WARN ][org.logstash.instrument.metrics.gauge.LazyDelegatingGauge][main] A gauge metric of an unknown type (org.jruby.specialized.RubyArrayOneObject) has been create for key: cluster_uuids. This may result in invalid serialization.  It is recommended to log an issue to the responsible developer/development team.</span><br><span class=\"line\">[2020-03-01T18:26:47,914][INFO ][logstash.javapipeline    ][main] Starting pipeline &#123;:pipeline_id=&gt;&quot;main&quot;, &quot;pipeline.workers&quot;=&gt;4, &quot;pipeline.batch.size&quot;=&gt;125, &quot;pipeline.batch.delay&quot;=&gt;50, &quot;pipeline.max_inflight&quot;=&gt;500, &quot;pipeline.sources&quot;=&gt;[&quot;/usr/elastic/logstash/config/logstash-elastic.yml&quot;], :thread=&gt;&quot;#&lt;Thread:0x77e7dd14 run&gt;&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:26:48,011][INFO ][logstash.outputs.elasticsearch][main] Attempting to install template &#123;:manage_template=&gt;&#123;&quot;index_patterns&quot;=&gt;&quot;logstash-*&quot;, &quot;version&quot;=&gt;60001, &quot;settings&quot;=&gt;&#123;&quot;index.refresh_interval&quot;=&gt;&quot;5s&quot;, &quot;number_of_shards&quot;=&gt;1&#125;, &quot;mappings&quot;=&gt;&#123;&quot;dynamic_templates&quot;=&gt;[&#123;&quot;message_field&quot;=&gt;&#123;&quot;path_match&quot;=&gt;&quot;message&quot;, &quot;match_mapping_type&quot;=&gt;&quot;string&quot;, &quot;mapping&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;text&quot;, &quot;norms&quot;=&gt;false&#125;&#125;&#125;, &#123;&quot;string_fields&quot;=&gt;&#123;&quot;match&quot;=&gt;&quot;*&quot;, &quot;match_mapping_type&quot;=&gt;&quot;string&quot;, &quot;mapping&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;text&quot;, &quot;norms&quot;=&gt;false, &quot;fields&quot;=&gt;&#123;&quot;keyword&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;keyword&quot;, &quot;ignore_above&quot;=&gt;256&#125;&#125;&#125;&#125;&#125;], &quot;properties&quot;=&gt;&#123;&quot;@timestamp&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;date&quot;&#125;, &quot;@version&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;keyword&quot;&#125;, &quot;geoip&quot;=&gt;&#123;&quot;dynamic&quot;=&gt;true, &quot;properties&quot;=&gt;&#123;&quot;ip&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;ip&quot;&#125;, &quot;location&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;geo_point&quot;&#125;, &quot;latitude&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;half_float&quot;&#125;, &quot;longitude&quot;=&gt;&#123;&quot;type&quot;=&gt;&quot;half_float&quot;&#125;&#125;&#125;&#125;&#125;&#125;&#125;</span><br><span class=\"line\">[2020-03-01T18:26:49,458][INFO ][logstash.inputs.file     ][main] No sincedb_path set, generating one based on the &quot;path&quot; setting &#123;:sincedb_path=&gt;&quot;/usr/elastic/logstash/data/plugins/inputs/file/.sincedb_b626b2bdb9f76816ac98ff32e97c96bf&quot;, :path=&gt;[&quot;/usr/elastic/logs/diy.log&quot;]&#125;</span><br><span class=\"line\">[2020-03-01T18:26:49,506][INFO ][logstash.javapipeline    ][main] Pipeline started &#123;&quot;pipeline.id&quot;=&gt;&quot;main&quot;&#125;</span><br><span class=\"line\">[2020-03-01T18:26:49,600][INFO ][logstash.agent           ] Pipelines running &#123;:count=&gt;1, :running_pipelines=&gt;[:main], :non_running_pipelines=&gt;[]&#125;</span><br><span class=\"line\">[2020-03-01T18:26:49,622][INFO ][filewatch.observingtail  ][main] START, creating Discoverer, Watch with file and sincedb collections</span><br><span class=\"line\">[2020-03-01T18:26:50,082][INFO ][logstash.agent           ] Successfully started Logstash API endpoint &#123;:port=&gt;9600&#125;</span><br><span class=\"line\">/usr/elastic/logstash/vendor/bundle/jruby/2.5.0/gems/awesome_print-1.7.0/lib/awesome_print/formatters/base_formatter.rb:31: warning: constant ::Fixnum is deprecated</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;@timestamp&quot; =&gt; 2020-03-01T10:27:13.467Z,</span><br><span class=\"line\">          &quot;path&quot; =&gt; &quot;/usr/elastic/logs/diy.log&quot;,</span><br><span class=\"line\">      &quot;@version&quot; =&gt; &quot;1&quot;,</span><br><span class=\"line\">       &quot;message&quot; =&gt; [</span><br><span class=\"line\">        [0] &quot;20120-03-02 20:21:21&quot;,</span><br><span class=\"line\">        [1] &quot;ERROR&quot;,</span><br><span class=\"line\">        [2] &quot;读取数据出错&quot;,</span><br><span class=\"line\">        [3] &quot;参数：id=1003&quot;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">          &quot;host&quot; =&gt; &quot;192.168.237.11&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://image.eelve.com/eblog/2020030201-c786b611e3664d718a8bc7a24d556d09.png\" alt=\"2020030201\"></p>\n<h2 id=\"4-3-停止服务\"><a href=\"#4-3-停止服务\" class=\"headerlink\" title=\"4.3 停止服务\"></a>4.3 停止服务</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 logs]$ jps</span><br><span class=\"line\">7110 Logstash</span><br><span class=\"line\">6794 Elasticsearch</span><br><span class=\"line\">7183 Jps</span><br><span class=\"line\">[iio@192 logs]$ kill -9 7110</span><br><span class=\"line\">[iio@192 logs]$ kill -9 6794</span><br><span class=\"line\">[iio@192 logs]$ </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<hr>\n<p>【<strong>后面的话</strong>】Logstash作为三大剑客，主要是采集和过滤，但是在现在采集公文部分被Beats家族取代，所以目前最重要的作用是过滤，但是也不是说不能采集了，只是相比于Beat来说效率更低而已。另外还有一点一个输入可以有多份输出,在4.3中也有应用,下面是主要的配置：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">input &#123; #输入</span><br><span class=\"line\">    stdin &#123; ... &#125; #标准输入</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">filter &#123; #过滤，对数据进行分割、截取等处理</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">output &#123; #输出1</span><br><span class=\"line\">    stdout &#123; ... &#125; #标准输出</span><br><span class=\"line\"></span><br><span class=\"line\">    elasticsearch &#123; #输出2</span><br><span class=\"line\">        hosts &#x3D;&gt; [ &quot;192.168.40.133:9200&quot;,&quot;192.168.40.134:9200&quot;,&quot;192.168.40.135:9200&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Logstash","path":"api/tags/Logstash.json"}]},{"title":"Elastic Stack实战之应用日志监控","slug":"Elastic-Stack实战之应用日志监控","date":"2020-03-14T13:49:22.000Z","updated":"2023-09-30T08:39:39.667Z","comments":true,"path":"api/articles/Elastic-Stack实战之应用日志监控.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/2020031400-c4c762ac3d134548bea4fb19e64088a6.png","content":"<p>【<strong>前面的话</strong>】在前面我们已经介绍了<a href=\"https://eelve.com/posts/975621af.html\">Elasticsearch</a>、<a href=\"https://eelve.com/posts/e05eadb0.html\">Logstash</a>、<a href=\"https://eelve.com/posts/b84d7094.html\">Kibana</a>和<a href=\"https://eelve.com/posts/d1a5ff40.html\">Beats</a>，并且都对各个组件进行了初步体验。今天我们就来模拟一把日常使用，来收集一个我们自己的应用的日志，并使用Kibana展示。</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Logstash:</span> <span class=\"string\">logstash-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Kibana:</span> <span class=\"string\">kibana-7.6.0</span></span><br><span class=\"line\"><span class=\"string\">Filebeat：filebeat-7.6.0</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、自定义采集应用\"><a href=\"#贰、自定义采集应用\" class=\"headerlink\" title=\"贰、自定义采集应用\"></a>贰、自定义采集应用</h1><p>我们这里来模拟一个现在购物网站的使用，主要代码如下</p>\n<ul>\n<li>核心代码</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.eelve.elk.dashboardgenerate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.RandomUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.joda.time.DateTime;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DashboardGenerateApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Logger LOGGER = LoggerFactory.getLogger(DashboardGenerateApplication.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String[] VISIT = <span class=\"keyword\">new</span> String[]&#123;<span class=\"string\">&quot;浏览页面&quot;</span>, <span class=\"string\">&quot;评论商品&quot;</span>, <span class=\"string\">&quot;加入收藏&quot;</span>, <span class=\"string\">&quot;加入购物车&quot;</span>, <span class=\"string\">&quot;提交订单&quot;</span>, <span class=\"string\">&quot;使用优惠券&quot;</span>, <span class=\"string\">&quot;领取优惠券&quot;</span>, <span class=\"string\">&quot;搜索&quot;</span>, <span class=\"string\">&quot;查看订单&quot;</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"keyword\">true</span>)&#123;</span><br><span class=\"line\">            Long sleep = RandomUtils.nextLong(<span class=\"number\">200</span>, <span class=\"number\">1000</span> * <span class=\"number\">5</span>);</span><br><span class=\"line\">            Thread.sleep(sleep);</span><br><span class=\"line\">            Long maxUserId = <span class=\"number\">9999L</span>;</span><br><span class=\"line\">            Long userId = RandomUtils.nextLong(<span class=\"number\">1</span>, maxUserId);</span><br><span class=\"line\">            String visit = VISIT[RandomUtils.nextInt(<span class=\"number\">0</span>, VISIT.length)];</span><br><span class=\"line\">            DateTime now = <span class=\"keyword\">new</span> DateTime();</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maxHour = now.getHourOfDay();</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maxMillis = now.getMinuteOfHour();</span><br><span class=\"line\">            <span class=\"keyword\">int</span> maxSeconds = now.getSecondOfMinute();</span><br><span class=\"line\">            String date = now.plusHours(-(RandomUtils.nextInt(<span class=\"number\">0</span>, maxHour)))</span><br><span class=\"line\">                    .plusMinutes(-(RandomUtils.nextInt(<span class=\"number\">0</span>, maxMillis)))</span><br><span class=\"line\">                    .plusSeconds(-(RandomUtils.nextInt(<span class=\"number\">0</span>, maxSeconds)))</span><br><span class=\"line\">                    .toString(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            String result = <span class=\"string\">&quot;IIO|&quot;</span> + userId + <span class=\"string\">&quot;|&quot;</span> + visit + <span class=\"string\">&quot;|&quot;</span> + date;</span><br><span class=\"line\">            LOGGER.info(result);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>日志配置文件</li>\n</ul>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">log4j.rootLogger</span>=<span class=\"string\">DEBUG,A1,A2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A1</span>=<span class=\"string\">org.apache.log4j.ConsoleAppender</span></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A1.layout</span>=<span class=\"string\">org.apache.log4j.PatternLayout</span></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A1.layout.ConversionPattern</span>=<span class=\"string\">[%p] %-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%c] - %m%n</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A2</span> = <span class=\"string\">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A2.File</span> = <span class=\"string\">/iio/logs/app.log</span></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A2.Append</span> = <span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A2.Threshold</span> = <span class=\"string\">INFO</span></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A2.layout</span> = <span class=\"string\">org.apache.log4j.PatternLayout</span></span><br><span class=\"line\"><span class=\"meta\">log4j.appender.A2.layout.ConversionPattern</span> =<span class=\"string\">[%p] %-d&#123;yyyy-MM-dd HH:mm:ss&#125; [%c] - %m%n</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>运行结果</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;C:\\Program Files\\Java\\jdk1.8.0_221\\bin\\java.exe&quot; -XX:TieredStopAtLevel=1 -noverify -Dspring.output.ansi.enabled=always -Dcom.sun.management.jmxremote -Dspring.jmx.enabled=true -Dspring.liveBeansView.mbeanDomain -Dspring.application.admin.enabled=true &quot;-javaagent:C:\\Program Files\\JetBrains\\IntelliJ IDEA 2019.1\\lib\\idea_rt.jar=6396:C:\\Program Files\\JetBrains\\IntelliJ IDEA 2019.1\\bin&quot; -Dfile.encoding=UTF-8 -classpath &quot;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\charsets.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\deploy.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\access-bridge-64.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\cldrdata.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\dnsns.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\jaccess.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\jfxrt.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\localedata.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\nashorn.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\sunec.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\sunjce_provider.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\sunmscapi.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\sunpkcs11.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\ext\\zipfs.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\javaws.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\jce.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\jfr.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\jfxswt.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\jsse.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\management-agent.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\plugin.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\resources.jar;C:\\Program Files\\Java\\jdk1.8.0_221\\jre\\lib\\rt.jar;D:\\iio\\dashboard-generate\\target\\classes;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\boot\\spring-boot-starter\\2.2.5.RELEASE\\spring-boot-starter-2.2.5.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\boot\\spring-boot\\2.2.5.RELEASE\\spring-boot-2.2.5.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\spring-context\\5.2.4.RELEASE\\spring-context-5.2.4.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\spring-aop\\5.2.4.RELEASE\\spring-aop-5.2.4.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\spring-beans\\5.2.4.RELEASE\\spring-beans-5.2.4.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\spring-expression\\5.2.4.RELEASE\\spring-expression-5.2.4.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\boot\\spring-boot-autoconfigure\\2.2.5.RELEASE\\spring-boot-autoconfigure-2.2.5.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\boot\\spring-boot-starter-logging\\2.2.5.RELEASE\\spring-boot-starter-logging-2.2.5.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\apache\\logging\\log4j\\log4j-to-slf4j\\2.12.1\\log4j-to-slf4j-2.12.1.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\apache\\logging\\log4j\\log4j-api\\2.12.1\\log4j-api-2.12.1.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\slf4j\\jul-to-slf4j\\1.7.30\\jul-to-slf4j-1.7.30.jar;C:\\Users\\Chirius\\.m2\\repository\\jakarta\\annotation\\jakarta.annotation-api\\1.3.5\\jakarta.annotation-api-1.3.5.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\spring-core\\5.2.4.RELEASE\\spring-core-5.2.4.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\springframework\\spring-jcl\\5.2.4.RELEASE\\spring-jcl-5.2.4.RELEASE.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\yaml\\snakeyaml\\1.25\\snakeyaml-1.25.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\apache\\commons\\commons-lang3\\3.3.2\\commons-lang3-3.3.2.jar;C:\\Users\\Chirius\\.m2\\repository\\joda-time\\joda-time\\2.9.9\\joda-time-2.9.9.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\slf4j\\slf4j-log4j12\\1.7.26\\slf4j-log4j12-1.7.26.jar;C:\\Users\\Chirius\\.m2\\repository\\org\\slf4j\\slf4j-api\\1.7.30\\slf4j-api-1.7.30.jar;C:\\Users\\Chirius\\.m2\\repository\\log4j\\log4j\\1.2.17\\log4j-1.2.17.jar&quot; com.eelve.elk.dashboardgenerate.DashboardGenerateApplication</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:09 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|4234|加入收藏|2020-03-14 04:04:03</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:11 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|6502|领取优惠券|2020-03-14 14:05:07</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:12 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|3694|加入购物车|2020-03-14 20:03:09</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:14 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|8112|使用优惠券|2020-03-14 12:06:02</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:14 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|3391|加入收藏|2020-03-14 02:01:05</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:17 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|3696|搜索|2020-03-14 04:06:05</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:18 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|6670|使用优惠券|2020-03-14 17:04:17</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:21 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|6646|搜索|2020-03-14 11:06:05</span><br><span class=\"line\">[INFO] 2020-03-14 21:06:24 [com.eelve.elk.dashboardgenerate.DashboardGenerateApplication] - IIO|8227|使用优惠券|2020-03-14 12:06:24</span><br><span class=\"line\"></span><br><span class=\"line\">Process finished with exit code -1</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>我们这里模拟了用户的操作，并记录到/iio/logs/app.log文件中。主要的业务流程为：APP-&gt;filebeat-&gt;logstash-&gt;elasticsearch-&gt;kibanan-&gt;User</p>\n<p><img src=\"https://image.eelve.com/eblog/2020031400-c4c762ac3d134548bea4fb19e64088a6.png\" alt=\"2020031400\"></p>\n<h1 id=\"叁、准备过程\"><a href=\"#叁、准备过程\" class=\"headerlink\" title=\"叁、准备过程\"></a>叁、准备过程</h1><h2 id=\"3-1-编写filebeat配置\"><a href=\"#3-1-编写filebeat配置\" class=\"headerlink\" title=\"3.1 编写filebeat配置\"></a>3.1 编写filebeat配置</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ vi dashboard.yml </span><br><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - /iio/logs/*.log</span><br><span class=\"line\">output.logstash:</span><br><span class=\"line\">  hosts: [&quot;192.168.237.11:5044&quot;]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"3-2-编写logstash配置\"><a href=\"#3-2-编写logstash配置\" class=\"headerlink\" title=\"3.2 编写logstash配置\"></a>3.2 编写logstash配置</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 config]$ vi logstash-dashboard.yml </span><br><span class=\"line\">input &#123;</span><br><span class=\"line\">  beats &#123;</span><br><span class=\"line\">    port =&gt; &quot;5044&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">filter &#123;</span><br><span class=\"line\">  mutate &#123;</span><br><span class=\"line\">    split =&gt; &#123;&quot;message&quot;=&gt;&quot;|&quot;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  mutate &#123;</span><br><span class=\"line\">    add_field =&gt; &#123;</span><br><span class=\"line\">       &quot;userId&quot; =&gt; &quot;%&#123;[message][1]&#125;&quot;</span><br><span class=\"line\">       &quot;visit&quot; =&gt; &quot;%&#123;[message][2]&#125;&quot;</span><br><span class=\"line\">       &quot;date&quot; =&gt; &quot;%&#123;[message][3]&#125;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  mutate &#123;</span><br><span class=\"line\">    convert =&gt; &#123;</span><br><span class=\"line\">        &quot;userId&quot; =&gt; &quot;integer&quot;</span><br><span class=\"line\">        &quot;visit&quot; =&gt; &quot;string&quot;</span><br><span class=\"line\">        &quot;date&quot; =&gt; &quot;string&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">output &#123;</span><br><span class=\"line\">    elasticsearch &#123;</span><br><span class=\"line\">        hosts =&gt; [&quot;192.168.237.11:9200&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-3-启动应用\"><a href=\"#3-3-启动应用\" class=\"headerlink\" title=\"3.3 启动应用\"></a>3.3 启动应用</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 home]# java -jar dashboard-generate-0.0.1-SNAPSHOT.jar &amp;</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-4-启动elasticsearch\"><a href=\"#3-4-启动elasticsearch\" class=\"headerlink\" title=\"3.4 启动elasticsearch\"></a>3.4 启动elasticsearch</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./elasticsearch</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-5-启动kibana\"><a href=\"#3-5-启动kibana\" class=\"headerlink\" title=\"3.5 启动kibana\"></a>3.5 启动kibana</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./kibana</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-6-启动logstash\"><a href=\"#3-6-启动logstash\" class=\"headerlink\" title=\"3.6 启动logstash\"></a>3.6 启动logstash</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./logstash -f /usr/elastic/logstash/config/logstash-dashboard.yml</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-7-启动filebeat\"><a href=\"#3-7-启动filebeat\" class=\"headerlink\" title=\"3.7 启动filebeat\"></a>3.7 启动filebeat</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ ./filebeat  -e -c dashboard.yml</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-8-查看采集的数据\"><a href=\"#3-8-查看采集的数据\" class=\"headerlink\" title=\"3.8 查看采集的数据\"></a>3.8 查看采集的数据</h2><p><img src=\"https://image.eelve.com/eblog/2020031401-66d588f9d78f4bf4b34b3d9d0f82001d.png\" alt=\"2020031401\"></p>\n<h2 id=\"3-9-开始制作大屏\"><a href=\"#3-9-开始制作大屏\" class=\"headerlink\" title=\"3.9 开始制作大屏\"></a>3.9 开始制作大屏</h2><p><img src=\"https://image.eelve.com/eblog/2020031402-28114b868ca3470497782f558737d25e.png\" alt=\"2020031402\"><br><img src=\"https://image.eelve.com/eblog/2020031403-7b2ffa7f424b478781543ffb2b1b4207.png\" alt=\"2020031403\"><br><img src=\"https://image.eelve.com/eblog/2020031404-41d668eff3e247e7aa942d850e7775fa.png\" alt=\"2020031404\"><br><img src=\"https://image.eelve.com/eblog/2020031405-2aba46902b5f4495bfae81991385b60d.png\" alt=\"2020031405\"><br><img src=\"https://image.eelve.com/eblog/2020031406-8dbfc5fc883e46298da14ceb8e14348c.png\" alt=\"2020031406\"><br><img src=\"https://image.eelve.com/eblog/2020031407-cd57f9cb79b64ca6acaa2ba604e78511.png\" alt=\"2020031407\"></p>\n<p>到这里我们可以看到就已经完成了对我们自定义数据的监控，然后还利用了Kibana做了图表化展示。</p>\n<hr>\n<p>【<strong>后面的话</strong>】在我们日常应用中，我们的日志需要按照某种规则产生，方便我们使用logstash进行过滤，然后做一些处理。也就是说我们在开发之前就应该想好日志生成的格式，然后设计好日志的处理方式。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"}]},{"title":"Elastic Stack实战之环境准备","slug":"Elastic-Stack实战之环境准备","date":"2020-02-29T08:29:26.000Z","updated":"2021-04-19T06:44:39.012Z","comments":true,"path":"api/articles/Elastic-Stack实战之环境准备.json","excerpt":null,"keywords":"南国薏米","cover":"https://eelve.com/upload/2020/3/2020030104-b3bb574e37fd4c9a959c5b8ba383033c.png","content":"<p>【<strong>前面的话</strong>】首先还是是简单说一下<a href=\"https://www.elastic.co/\">Elastic Stack</a>技术栈吧。ELK = Elasticsearch, Logstash, Kibana 是一套实时数据收集，存储，索引，检索，统计分析及可视化的解决方案。最新版本已经改名为Elastic Stack，并新增了Beats项目。</p>\n<p><img src=\"https://eelve.com/upload/2020/3/2020030104-b3bb574e37fd4c9a959c5b8ba383033c.png\" alt=\"2020030104\"><br><img src=\"https://eelve.com/upload/2020/3/2020030105-8644c0540b6041d9a726b0fdf31845a0.png\" alt=\"2020030105\"></p>\n<p><strong>Elasticsearch</strong></p>\n<pre><code>Elasticsearch 基于java，是个开源分布式搜索引擎，它的特点有：分布式，零配置，自动发现，索引自动分片，索引\n副本机制，restful风格接口，多数据源，自动搜索负载等。\n</code></pre>\n<p><strong>Logstash</strong></p>\n<pre><code>Logstash 基于java，是一个开源的用于收集,分析和存储日志的工具。\n</code></pre>\n<p><strong>Kibana</strong></p>\n<pre><code>Kibana 基于nodejs，也是一个开源和免费的工具，Kibana可以为 Logstash 和 ElasticSearch 提供的日志分析友好的\nWeb 界面，可以汇总、分析和搜索重要数据日志。\n</code></pre>\n<p><strong>Beats</strong></p>\n<pre><code>Beats是elastic公司开源的一款采集系统监控数据的代理agent，是在被监控服务器上以客户端形式运行的数据收集\n器的统称，可以直接把数据发送给Elasticsearch或者通过Logstash发送给Elasticsearch，然后进行后续的数据分析活\n动。\nBeats由如下组成:\nPacketbeat：是一个网络数据包分析器，用于监控、收集网络流量信息，Packetbeat嗅探服务器之间的流量，\n解析应用层协议，并关联到消息的处理，其支 持ICMP (v4 and v6)、DNS、HTTP、Mysql、PostgreSQL、\nRedis、MongoDB、Memcache等协议；\nFilebeat：用于监控、收集服务器日志文件，其已取代 logstash forwarder；\nMetricbeat：可定期获取外部系统的监控指标信息，其可以监控、收集 Apache、HAProxy、MongoDB\nMySQL、Nginx、PostgreSQL、Redis、System、Zookeeper等服务；\nWinlogbeat：用于监控、收集Windows系统的日志信息；\n</code></pre>\n<p>但是很多用户还是用ELK来代替Elastic Stack，并且目前的最新版本已经来到了7.6.0，在后面的实践过程中如果没有特指的话，都会是基于最新版本的实践。下面来说一下我的环境，我本人的云服务器，性能不是很够，这边我的解决方案是用虚拟机来解决。所以在这篇文章中是主要介绍在VM中搭建linux服务器的，并且为了资源不浪费，我这边会做最小化安装。</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、主要步骤\"><a href=\"#贰、主要步骤\" class=\"headerlink\" title=\"贰、主要步骤\"></a>贰、主要步骤</h1><pre><code>在网络中有很多安装的具体步骤，我子啊这里只是说一下容易出错的点。\n</code></pre>\n<h2 id=\"2-1-VM创建虚拟机\"><a href=\"#2-1-VM创建虚拟机\" class=\"headerlink\" title=\"2.1 VM创建虚拟机\"></a>2.1 VM创建虚拟机</h2><p><img src=\"https://eelve.com/upload/2020/2/2020022903-e627be2203d040a8aae53c43c767e582.png\" alt=\"2020022903\"><br><img src=\"https://eelve.com/upload/2020/2/2020022903-e627be2203d040a8aae53c43c767e582.png\" alt=\"2020022903\"><br><img src=\"https://eelve.com/upload/2020/2/2020022905-baf50368479142869e6d506e899f6623.png\" alt=\"2020022905\"><br><img src=\"https://eelve.com/upload/2020/2/2020022906-79511d7494064df9a76dbbb00a529757.png\" alt=\"2020022906\"><br><img src=\"https://eelve.com/upload/2020/2/2020022907-d16b584e859c43c794badd92ed116ccc.png\" alt=\"2020022907\"><br><img src=\"https://eelve.com/upload/2020/2/2020022911-e111cb9fe7d94935b0cd7b8613d6e278.png\" alt=\"2020022911\"></p>\n<h2 id=\"2-2-安装Centos7\"><a href=\"#2-2-安装Centos7\" class=\"headerlink\" title=\"2.2 安装Centos7\"></a>2.2 安装Centos7</h2><p><img src=\"https://eelve.com/upload/2020/2/2020022913-34b2a693fd0e4cfa9c6484063bc3a00c.png\" alt=\"2020022913\"><br><img src=\"https://eelve.com/upload/2020/2/2020022914-8fb414bf521544518671a2da4fb142f1.png\" alt=\"2020022914\"><br><img src=\"https://eelve.com/upload/2020/2/2020022915-d2e5d18a228448709a81391ce595bcff.png\" alt=\"2020022915\"><br><img src=\"https://eelve.com/upload/2020/2/2020022916-1ca2096fd9c945a4bdc1da5ea0c6c898.png\" alt=\"2020022916\"><br><img src=\"https://eelve.com/upload/2020/2/2020022917-10884dc7ec5348eebb35f8682e627281.png\" alt=\"2020022917\"></p>\n<h1 id=\"叁、注意事项\"><a href=\"#叁、注意事项\" class=\"headerlink\" title=\"叁、注意事项\"></a>叁、注意事项</h1><pre><code>以下几点是特别需要主要：静态网络映射，时钟同步，系统资源配置\n</code></pre>\n<h2 id=\"3-1-静态网络映射\"><a href=\"#3-1-静态网络映射\" class=\"headerlink\" title=\"3.1 静态网络映射\"></a>3.1 静态网络映射</h2><p>首先获取子网IP，子网掩码，和网关地址</p>\n<p><img src=\"https://eelve.com/upload/2020/2/2020022918-006bef024d834c50bef94d415e3b3e05.png\" alt=\"2020022918\"><br><img src=\"https://eelve.com/upload/2020/2/2020022919-208c5c4049a847ff94be761f512e9dde.png\" alt=\"2020022919\"></p>\n<p>在最小化安装的CentOS7中，ifconfig是不能使用的，查看网卡信息的命令是：</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ip addr</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://eelve.com/upload/2020/2/2020022920-57cff54e5cde4ddd96079ae6172070ae.png\" alt=\"2020022920\"></p>\n<p>其中“ens33”为网卡名称，根据得到网关和子网ip等修改IP地址等信息</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br><span class=\"line\"></span><br><span class=\"line\">TYPE=Ethernet</span><br><span class=\"line\">PROXY_METHOD=none</span><br><span class=\"line\">BROWSER_ONLY=no</span><br><span class=\"line\">BOOTPROTO=static</span><br><span class=\"line\">DEFROUTE=yes</span><br><span class=\"line\">PEERROUTES=yes</span><br><span class=\"line\">IPV4_FAILURE_FATAL=no</span><br><span class=\"line\">IPV6INIT=yes</span><br><span class=\"line\">IPV6_AUTOCONF=yes</span><br><span class=\"line\">IPV6_DEFROUTE=yes</span><br><span class=\"line\">IPV6_FAILURE_FATAL=no</span><br><span class=\"line\">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class=\"line\">NAME=ens33</span><br><span class=\"line\">UUID=2cce262f-99d8-485e-aa8e-f2493405715a</span><br><span class=\"line\">DEVICE=ens33</span><br><span class=\"line\">ONBOOT=yes</span><br><span class=\"line\">IPADDR=192.168.237.11</span><br><span class=\"line\">GATEWAY=192.168.237.2</span><br><span class=\"line\">NETMASK=255.255.255.0</span><br><span class=\"line\">DNS1=192.168.237.2</span><br><span class=\"line\">DNS2=8.8.8.8</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>修改好后保存退出，并重启网络，测试网络是否连接正常：</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# service network restart</span><br><span class=\"line\">Restarting network (via systemctl):                        [  OK  ]</span><br><span class=\"line\">[root@192 ~]# ping www.eelve.com</span><br><span class=\"line\">PING www.eelve.com (47.98.209.166) 56(84) bytes of data.</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=1 ttl=128 time=38.1 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=2 ttl=128 time=38.7 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=3 ttl=128 time=39.4 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=4 ttl=128 time=51.3 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=5 ttl=128 time=38.1 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=6 ttl=128 time=37.9 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=7 ttl=128 time=44.5 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=8 ttl=128 time=37.7 ms</span><br><span class=\"line\">64 bytes from 47.98.209.166 (47.98.209.166): icmp_seq=9 ttl=128 time=37.9 ms</span><br><span class=\"line\">^C</span><br><span class=\"line\">--- www.eelve.com ping statistics ---</span><br><span class=\"line\">9 packets transmitted, 9 received, 0% packet loss, time 9110ms</span><br><span class=\"line\">rtt min/avg/max/mdev = 37.753/40.435/51.388/4.365 ms</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>到了这里我们就可以使用XShell用配置的静态IP来连接服务器使用了</p>\n<p><img src=\"https://eelve.com/upload/2020/2/2020022921-0f8c6a976821406081e228e76f359236.png\" alt=\"2020022921\"></p>\n<h2 id=\"3-2-时钟同步\"><a href=\"#3-2-时钟同步\" class=\"headerlink\" title=\"3.2 时钟同步\"></a>3.2 时钟同步</h2><p>yum进行软件安装，软件安装过程中如遇到询问，一律选择y，ntp是时间同步命令</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install ntp</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ntpdate time1.aliyun.com</span><br></pre></td></tr></table></figure>\n<p>然后就可以成功同步时间，然后查看</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# date</span><br><span class=\"line\">Sat Feb 29 18:08:31 CST 2020</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"3-3-系统资源配置\"><a href=\"#3-3-系统资源配置\" class=\"headerlink\" title=\"3.3 系统资源配置\"></a>3.3 系统资源配置</h2><p>系统资源的话，主要是虚拟机安装，都可以方便修改，这边后期要安装Elastic Stack，最好是稍微调大一点，内存至少为2G，因为Elasticsearch和Kibana都是需要用到Java虚拟机的，尤其是你准备把这两个服务都安装在一台机器上的话。</p>\n<hr>\n<p>【<strong>最后的话</strong>】时钟同步，是一定要配置的，不然会造成之后Elastic Stack中的服务不可用，当然也不是真的不可用，你只是会在Kibana中看不到你的数据映射，因为默认Kibana的时间展示参数为最近15分钟，如果你的时间相差很远的话，就可能造成Elasticsearch中能采集数据，但是Kibana展示不出来，这个对于初学者来说会造成Kibana数据不能映射问题，这点在后面会做具体介绍的。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Linux","path":"api/tags/Linux.json"},{"name":"VM","path":"api/tags/VM.json"}]},{"title":"Elastic Stack实战之Filebeat初体验","slug":"Elastic-Stack实战之Filebeat初体验","date":"2020-03-07T09:49:22.000Z","updated":"2023-09-30T08:39:39.667Z","comments":true,"path":"api/articles/Elastic-Stack实战之Filebeat初体验.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/animated-gif-logs-ui-optimized-7bf3c88845c84ee3a0564f7a608726b5.gif","content":"<p>【<strong>前面的话</strong>】<a href=\"https://eelve.com/posts/d1a5ff40.html\">前文</a>介绍了Elastic Stack的Beats家族，今天我们就来体验其中的专门用于采集文件的<a href=\"https://www.elastic.co/cn/beats/filebeat\">Filebeat</a>，走起。</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Logstash:</span> <span class=\"string\">logstash-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Kibana:</span> <span class=\"string\">kibana-7.6.0</span></span><br><span class=\"line\"><span class=\"string\">Filebeat：filebeat-7.6.0</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、Filebeat介绍\"><a href=\"#贰、Filebeat介绍\" class=\"headerlink\" title=\"贰、Filebeat介绍\"></a>贰、Filebeat介绍</h1><p>Filebeat是一种轻量型日志采集器，具有以下特点</p>\n<ul>\n<li>汇总、“tail -f”和搜索：启动 Filebeat 后，打开 Logs UI，直接在 Kibana 中观看对您的文件进行 tail 操作的过程。通过搜索栏按照服务、应用程序、主机、数据中心或者其他条件进行筛选，以跟踪您的全部汇总日志中的异常行为。</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/animated-gif-logs-ui-optimized-7bf3c88845c84ee3a0564f7a608726b5.gif\" alt=\"animated-gif-logs-ui-optimized\"></p>\n<ul>\n<li><p>性能稳健，不错过任何检测信号：无论在任何环境中，随时都潜伏着应用程序中断的风险。Filebeat 能够读取并转发日志行，如果出现中断，还会在一切恢复正常后，从中断前停止的位置继续开始。</p>\n</li>\n<li><p>Filebeat 让简单的事情简单化：Filebeat 内置有多种模块（Apache、Cisco ASA、Microsoft Azure、NGINX、MySQL 等等），可针对常见格式的日志大大简化收集、解析和可视化过程，只需一条命令即可。之所以能实现这一点，是因为它将自动默认路径（因操作系统而异）与 Elasticsearch 采集节点管道的定义和 Kibana 仪表板组合在一起。不仅如此，数个 Filebeat 模块还包括预配置的 Machine Learning 任务。 </p>\n<ul>\n<li>系统</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/filebeat-modules-system-1fcfe648ed244a3eb6981805e48eb805.jpg\" alt=\"filebeat-modules-system\"></p>\n<ul>\n<li>NGINX</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/filebeat-modules-nginx-60aafcc8bf6e416e8489e30b85e84446.jpg\" alt=\"filebeat-modules-nginx\"></p>\n<ul>\n<li>MySQL</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/filebeat-modules-mysql-532077e16cc3495291fbe4c7b15e7f36.jpg\" alt=\"filebeat-modules-mysql\"></p>\n<ul>\n<li>Auditd</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/filebeat-modules-auditd-593f8272484b4aa4ac01bc3fcd596d43.jpg\" alt=\"filebeat-modules-auditd\"></p>\n</li>\n</ul>\n<ul>\n<li><p>容器就绪和云端就绪：正在对所有内容进行容器化，或者正在云端环境中运行？通过 Elastic Stack，可以轻松地监测容器和云服务。在 Kubernetes、Docker 或云端部署中部署 Filebeat，即可获得所有的日志流：信息十分完整，包括日志流的 pod、容器、节点、VM、主机以及自动关联时用到的其他元数据。此外，Beats Autodiscover 功能可检测到新容器，并使用恰当的 Filebeat 模块对这些容器进行自适应监测。 </p>\n</li>\n<li><p>它不会导致您的管道过载：当将数据发送到 Logstash 或 Elasticsearch 时，Filebeat 使用背压敏感协议，以应对更多的数据量。如果 Logstash 正在忙于处理数据，则会告诉 Filebeat 减慢读取速度。一旦拥堵得到解决，Filebeat 就会恢复到原来的步伐并继续传输数据。 </p>\n</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/filebeat-diagram-71397eba004043f3a0593620b0139364.svg\" alt=\"filebeat-diagram\"></p>\n<ul>\n<li><p>输送至 Elasticsearch 或 Logstash。在 Kibana 中实现可视化。</p>\n<p>Filebeat 是 Elastic Stack 的一部分，因此能够与 Logstash、Elasticsearch 和 Kibana 无缝协作。无论您要使用 Logstash 转换或充实日志和文件，还是在 Elasticsearch 中随意处理一些数据分析，亦或在 Kibana 中构建和分享仪表板，Filebeat 都能轻松地将您的数据发送至最关键的地方。</p>\n</li>\n</ul>\n<h1 id=\"叁-Filebeat安装\"><a href=\"#叁-Filebeat安装\" class=\"headerlink\" title=\"叁 Filebeat安装\"></a>叁 Filebeat安装</h1><h2 id=\"3-1-下载地址\"><a href=\"#3-1-下载地址\" class=\"headerlink\" title=\"3.1 下载地址\"></a>3.1 下载地址</h2><p><a href=\"https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.6.0-linux-x86_64.tar.gz\">filebeat-7.6.0-linux-x86_64</a></p>\n<h2 id=\"3-2-解压filebeat-7-6-0-linux-x86-64\"><a href=\"#3-2-解压filebeat-7-6-0-linux-x86-64\" class=\"headerlink\" title=\"3.2 解压filebeat-7.6.0-linux-x86_64\"></a>3.2 解压filebeat-7.6.0-linux-x86_64</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zvxf filebeat-7.6.0-linux-x86_64.tar.gz -C /usr/elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-3-filebeat配置\"><a href=\"#3-3-filebeat配置\" class=\"headerlink\" title=\"3.3 filebeat配置\"></a>3.3 filebeat配置</h2><p>我们可以针对不同的采集项自定义配置，同时方便测试和展示。</p>\n<h2 id=\"3-4-采集控制台日志\"><a href=\"#3-4-采集控制台日志\" class=\"headerlink\" title=\"3.4 采集控制台日志\"></a>3.4 采集控制台日志</h2><ul>\n<li>新建std.yml配置</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">- type: stdin</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\">setup.template.settings:</span><br><span class=\"line\">  index.number_of_shards: 1</span><br><span class=\"line\">output.console:</span><br><span class=\"line\">  pretty: true</span><br><span class=\"line\">  enable: true</span><br></pre></td></tr></table></figure>\n<ul>\n<li>启动</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./filebeat  -e -c std.yml</span><br></pre></td></tr></table></figure>\n<ul>\n<li>结果</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;@timestamp&quot;: &quot;2020-03-07T08:40:10.807Z&quot;,</span><br><span class=\"line\">  &quot;@metadata&quot;: &#123;</span><br><span class=\"line\">    &quot;beat&quot;: &quot;filebeat&quot;,</span><br><span class=\"line\">    &quot;type&quot;: &quot;_doc&quot;,</span><br><span class=\"line\">    &quot;version&quot;: &quot;7.6.0&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;agent&quot;: &#123;</span><br><span class=\"line\">    &quot;id&quot;: &quot;4f346e18-c77b-4a8c-ae9a-f97b2007be60&quot;,</span><br><span class=\"line\">    &quot;version&quot;: &quot;7.6.0&quot;,</span><br><span class=\"line\">    &quot;type&quot;: &quot;filebeat&quot;,</span><br><span class=\"line\">    &quot;ephemeral_id&quot;: &quot;2b5dd30b-1a9a-454a-a9f1-0a428fd6c6da&quot;,</span><br><span class=\"line\">    &quot;hostname&quot;: &quot;192.168.237.11&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;ecs&quot;: &#123;</span><br><span class=\"line\">    &quot;version&quot;: &quot;1.4.0&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;message&quot;: &quot;hello&quot;,</span><br><span class=\"line\">  &quot;log&quot;: &#123;</span><br><span class=\"line\">    &quot;offset&quot;: 0,</span><br><span class=\"line\">    &quot;file&quot;: &#123;</span><br><span class=\"line\">      &quot;path&quot;: &quot;&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;input&quot;: &#123;</span><br><span class=\"line\">    &quot;type&quot;: &quot;stdin&quot;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;host&quot;: &#123;</span><br><span class=\"line\">    &quot;name&quot;: &quot;192.168.237.11&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-5-采集nginx日志\"><a href=\"#3-5-采集nginx日志\" class=\"headerlink\" title=\"3.5 采集nginx日志\"></a>3.5 采集nginx日志</h2><ul>\n<li><p>启动nginx</p>\n<p>这里如果没有安装的话，可以自行安装配置，然后启动nginx</p>\n</li>\n<li><p>新建nginx.yml配置</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\">- type: log</span><br><span class=\"line\">  enabled: true</span><br><span class=\"line\">  paths:</span><br><span class=\"line\">    - /usr/local/nginx/logs/*.log</span><br><span class=\"line\">  tags: [&quot;nginx&quot;]</span><br><span class=\"line\">setup.template.settings:</span><br><span class=\"line\">  index.number_of_shards: 1</span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;http://192.168.237.11:9200&quot;]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>启动Elasticsearch</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./elasticsearch</span><br></pre></td></tr></table></figure>\n<ul>\n<li>启动Filebeat</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ ./filebeat  -e -c nginx.yml</span><br><span class=\"line\"></span><br><span class=\"line\">2020-03-07T17:11:05.821+0800\tINFO\tinstance/beat.go:298\tSetup Beat: filebeat; Version: 7.6.0</span><br><span class=\"line\">2020-03-07T17:11:05.821+0800\tINFO\t[index-management]\tidxmgmt/std.go:182\tSet output.elasticsearch.index to &#x27;filebeat-7.6.0&#x27; as ILM is enabled.</span><br><span class=\"line\">2020-03-07T17:11:05.821+0800\tINFO\telasticsearch/client.go:174\tElasticsearch url: http://192.168.237.11:9200</span><br><span class=\"line\">2020-03-07T17:11:05.821+0800\tINFO\t[publisher]\tpipeline/module.go:110\tBeat name: 192.168.237.11</span><br><span class=\"line\">2020-03-07T17:11:05.822+0800\tINFO\t[monitoring]\tlog/log.go:118\tStarting metrics logging every 30s</span><br><span class=\"line\">2020-03-07T17:11:05.822+0800\tINFO\tinstance/beat.go:439\tfilebeat start running.</span><br><span class=\"line\">2020-03-07T17:11:05.822+0800\tINFO\tregistrar/registrar.go:145\tLoading registrar data from /usr/elastic/filebeat/data/registry/filebeat/data.json</span><br><span class=\"line\">2020-03-07T17:11:05.822+0800\tINFO\tregistrar/registrar.go:152\tStates Loaded from registrar: 3</span><br><span class=\"line\">2020-03-07T17:11:05.822+0800\tINFO\tcrawler/crawler.go:72\tLoading Inputs: 1</span><br><span class=\"line\">2020-03-07T17:11:05.823+0800\tINFO\tlog/input.go:152\tConfigured paths: [/usr/local/nginx/logs/*.log]</span><br><span class=\"line\">2020-03-07T17:11:05.823+0800\tINFO\tinput/input.go:114\tStarting input of type: log; ID: 11194696681404026286 </span><br><span class=\"line\">2020-03-07T17:11:05.823+0800\tINFO\tcrawler/crawler.go:106\tLoading and starting Inputs completed. Enabled inputs: 1</span><br><span class=\"line\">2020-03-07T17:11:15.826+0800\tINFO\tlog/harvester.go:297\tHarvester started for file: /usr/local/nginx/logs/access.log</span><br><span class=\"line\">2020-03-07T17:11:16.828+0800\tINFO\tpipeline/output.go:95\tConnecting to backoff(elasticsearch(http://192.168.237.11:9200))</span><br><span class=\"line\">2020-03-07T17:11:16.831+0800\tINFO\telasticsearch/client.go:757\tAttempting to connect to Elasticsearch version 7.6.0</span><br><span class=\"line\">2020-03-07T17:11:16.859+0800\tINFO\t[license]\tlicenser/es_callback.go:50\tElasticsearch license: Basic</span><br><span class=\"line\">2020-03-07T17:11:16.891+0800\tINFO\t[index-management]\tidxmgmt/std.go:258\tAuto ILM enable success.</span><br><span class=\"line\">2020-03-07T17:11:16.892+0800\tINFO\t[index-management.ilm]\tilm/std.go:139\tdo not generate ilm policy: exists=true, overwrite=false</span><br><span class=\"line\">2020-03-07T17:11:16.893+0800\tINFO\t[index-management]\tidxmgmt/std.go:271\tILM policy successfully loaded.</span><br><span class=\"line\">2020-03-07T17:11:16.893+0800\tINFO\t[index-management]\tidxmgmt/std.go:410\tSet setup.template.name to &#x27;&#123;filebeat-7.6.0 &#123;now/d&#125;-000001&#125;&#x27; as ILM is enabled.</span><br><span class=\"line\">2020-03-07T17:11:16.893+0800\tINFO\t[index-management]\tidxmgmt/std.go:415\tSet setup.template.pattern to &#x27;filebeat-7.6.0-*&#x27; as ILM is enabled.</span><br><span class=\"line\">2020-03-07T17:11:16.893+0800\tINFO\t[index-management]\tidxmgmt/std.go:449\tSet settings.index.lifecycle.rollover_alias in template to &#123;filebeat-7.6.0 &#123;now/d&#125;-000001&#125; as ILM is enabled.</span><br><span class=\"line\">2020-03-07T17:11:16.893+0800\tINFO\t[index-management]\tidxmgmt/std.go:453\tSet settings.index.lifecycle.name in template to &#123;filebeat &#123;&quot;policy&quot;:&#123;&quot;phases&quot;:&#123;&quot;hot&quot;:&#123;&quot;actions&quot;:&#123;&quot;rollover&quot;:&#123;&quot;max_age&quot;:&quot;30d&quot;,&quot;max_size&quot;:&quot;50gb&quot;&#125;&#125;&#125;&#125;&#125;&#125;&#125; as ILM is enabled.</span><br><span class=\"line\">2020-03-07T17:11:16.895+0800\tINFO\ttemplate/load.go:89\tTemplate filebeat-7.6.0 already exists and will not be overwritten.</span><br><span class=\"line\">2020-03-07T17:11:16.895+0800\tINFO\t[index-management]\tidxmgmt/std.go:295\tLoaded index template.</span><br><span class=\"line\">2020-03-07T17:11:17.097+0800\tINFO\t[index-management]\tidxmgmt/std.go:306\tWrite alias successfully generated.</span><br><span class=\"line\">2020-03-07T17:11:17.097+0800\tINFO\tpipeline/output.go:105\tConnection to backoff(elasticsearch(http://192.168.237.11:9200)) established</span><br></pre></td></tr></table></figure>\n<ul>\n<li>刷新页面观察结果</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/2020030701-f6f0c410456c47e7872c7719e1fe4205.png\" alt=\"2020030701\"><br><img src=\"https://image.eelve.com/eblog/2020030702-c17fe51d42ca47a3b4c452fa14131e92.png\" alt=\"2020030702\"></p>\n<p>我们可以看到采集已经成功，并且我们配置的tags也已经成功了</p>\n<h2 id=\"3-6-使用nginx-module采集nginx日志\"><a href=\"#3-6-使用nginx-module采集nginx日志\" class=\"headerlink\" title=\"3.6 使用nginx module采集nginx日志\"></a>3.6 使用nginx module采集nginx日志</h2><ul>\n<li>开启filebeat的nginx module</li>\n</ul>\n<p>前面要想实现日志数据的读取以及处理都是自己手动配置的，其实，在Filebeat中，有大量的Module，可以简化我们的配置，直接就可以使用，如下：</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ ./filebeat modules list</span><br><span class=\"line\">Enabled:</span><br><span class=\"line\">nginx</span><br><span class=\"line\"></span><br><span class=\"line\">Disabled:</span><br><span class=\"line\">activemq</span><br><span class=\"line\">apache</span><br><span class=\"line\">auditd</span><br><span class=\"line\">aws</span><br><span class=\"line\">azure</span><br><span class=\"line\">cef</span><br><span class=\"line\">cisco</span><br><span class=\"line\">coredns</span><br><span class=\"line\">elasticsearch</span><br><span class=\"line\">envoyproxy</span><br><span class=\"line\">googlecloud</span><br><span class=\"line\">haproxy</span><br><span class=\"line\">ibmmq</span><br><span class=\"line\">icinga</span><br><span class=\"line\">iis</span><br><span class=\"line\">iptables</span><br><span class=\"line\">kafka</span><br><span class=\"line\">kibana</span><br><span class=\"line\">logstash</span><br><span class=\"line\">misp</span><br><span class=\"line\">mongodb</span><br><span class=\"line\">mssql</span><br><span class=\"line\">mysql</span><br><span class=\"line\">nats</span><br><span class=\"line\">netflow</span><br><span class=\"line\">osquery</span><br><span class=\"line\">panw</span><br><span class=\"line\">postgresql</span><br><span class=\"line\">rabbitmq</span><br><span class=\"line\">redis</span><br><span class=\"line\">santa</span><br><span class=\"line\">suricata</span><br><span class=\"line\">system</span><br><span class=\"line\">traefik</span><br><span class=\"line\">zeek</span><br></pre></td></tr></table></figure>\n<p>可以看到我这里的nginx modules已经开启了，但是默认是没有开启的，如果需要启用需要进行enable操作：</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/filebeat modules enable nginx #启动</span><br><span class=\"line\">./filebeat modules disable nginx #禁用</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>nginx module 配置</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ cd modules.d</span><br><span class=\"line\">[iio@192 modules.d]$ vi nginx.yml </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Module: nginx</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\"> Docs: https://www.elastic.co/guide/en/beats/filebeat/7.6/filebeat-module-nginx.html</span></span><br><span class=\"line\"></span><br><span class=\"line\">- module: nginx</span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\"> Access logs</span></span><br><span class=\"line\">  access:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    var.paths: [&quot;/usr/local/nginx/logs/access.log*&quot;]</span><br><span class=\"line\">    # Set custom paths for the log files. If left empty,</span><br><span class=\"line\">    # Filebeat will choose the paths depending on your OS.</span><br><span class=\"line\">    #var.paths:</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">  #</span><span class=\"bash\"> Error logs</span></span><br><span class=\"line\">  error:</span><br><span class=\"line\">    enabled: true</span><br><span class=\"line\">    var.paths: [&quot;/usr/local/nginx/logs/error.log*&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\">    # Set custom paths for the log files. If left empty,</span><br><span class=\"line\">    # Filebeat will choose the paths depending on your OS.</span><br><span class=\"line\">    #var.paths:</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>配置filebeat</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ vi nginxmodule.yml</span><br><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">- <span class=\"built_in\">type</span>: <span class=\"built_in\">log</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  enabled: <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  paths:</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">    - /usr/<span class=\"built_in\">local</span>/nginx/logs/*.<span class=\"built_in\">log</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  tags: [<span class=\"string\">&quot;nginx&quot;</span>]</span></span><br><span class=\"line\">setup.template.settings:</span><br><span class=\"line\">  index.number_of_shards: 1</span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;http://192.168.237.11:9200&quot;]</span><br><span class=\"line\">filebeat.config.modules:</span><br><span class=\"line\">  path: $&#123;path.config&#125;/modules.d/*.yml</span><br><span class=\"line\">  reload.enabled: false</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>启动</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ ./filebeat  -e -c nginxmodule.yml</span><br></pre></td></tr></table></figure>\n<ul>\n<li>查看结果</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/2020030703-14356801335d4ea8a4256bce80a9bf5f.png\" alt=\"2020030703\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;msg&quot;: &quot;2020-02-29 02:30:26,634 [myid:] - WARN  [NIOServerCxn.Factory:0.0.0.0\\&#x2F;0.0.0.0:2181:NIOServerCnxn@376] - Unable to read additional data from client sessionid 0x0, likely client has closed socket&quot;,</span><br><span class=\"line\">\t&quot;rawmsg&quot;: &quot;2020-02-29 02:30:26,634 [myid:] - WARN  [NIOServerCxn.Factory:0.0.0.0\\&#x2F;0.0.0.0:2181:NIOServerCnxn@376] - Unable to read additional data from client sessionid 0x0, likely client has closed socket&quot;,</span><br><span class=\"line\">\t&quot;timereported&quot;: &quot;2020-02-29T10:30:26.635186+08:00&quot;,</span><br><span class=\"line\">\t&quot;hostname&quot;: &quot;izbp1a4b02uc2nj550yzs1z&quot;,</span><br><span class=\"line\">\t&quot;syslogtag&quot;: &quot;journal:&quot;,</span><br><span class=\"line\">\t&quot;inputname&quot;: &quot;imjournal&quot;,</span><br><span class=\"line\">\t&quot;fromhost&quot;: &quot;izbp1a4b02uc2nj550yzs1z&quot;,</span><br><span class=\"line\">\t&quot;fromhost-ip&quot;: &quot;127.0.0.1&quot;,</span><br><span class=\"line\">\t&quot;pri&quot;: &quot;14&quot;,</span><br><span class=\"line\">\t&quot;syslogfacility&quot;: &quot;1&quot;,</span><br><span class=\"line\">\t&quot;syslogseverity&quot;: &quot;6&quot;,</span><br><span class=\"line\">\t&quot;timegenerated&quot;: &quot;2020-02-29T10:30:26.635186+08:00&quot;,</span><br><span class=\"line\">\t&quot;programname&quot;: &quot;journal&quot;,</span><br><span class=\"line\">\t&quot;protocol-version&quot;: &quot;0&quot;,</span><br><span class=\"line\">\t&quot;structured-data&quot;: &quot;-&quot;,</span><br><span class=\"line\">\t&quot;app-name&quot;: &quot;journal&quot;,</span><br><span class=\"line\">\t&quot;procid&quot;: &quot;-&quot;,</span><br><span class=\"line\">\t&quot;msgid&quot;: &quot;-&quot;,</span><br><span class=\"line\">\t&quot;uuid&quot;: null,</span><br><span class=\"line\">\t&quot;$!&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;_UID&quot;: &quot;0&quot;,</span><br><span class=\"line\">\t\t&quot;_GID&quot;: &quot;0&quot;,</span><br><span class=\"line\">\t\t&quot;_CAP_EFFECTIVE&quot;: &quot;1fffffffff&quot;,</span><br><span class=\"line\">\t\t&quot;_BOOT_ID&quot;: &quot;1c6d86e336cc4dc7b733ea3c53351d65&quot;,</span><br><span class=\"line\">\t\t&quot;_MACHINE_ID&quot;: &quot;f0f31005fb5a436d88e3c6cbf54e25aa&quot;,</span><br><span class=\"line\">\t\t&quot;_HOSTNAME&quot;: &quot;izbp1a4b02uc2nj550yzs1z&quot;,</span><br><span class=\"line\">\t\t&quot;_SYSTEMD_SLICE&quot;: &quot;system.slice&quot;,</span><br><span class=\"line\">\t\t&quot;PRIORITY&quot;: &quot;6&quot;,</span><br><span class=\"line\">\t\t&quot;_TRANSPORT&quot;: &quot;journal&quot;,</span><br><span class=\"line\">\t\t&quot;CONTAINER_ID_FULL&quot;: &quot;bdc76f9b56dbeb3f5005ca110d72945c6b949178b6948345febf5bc657433703&quot;,</span><br><span class=\"line\">\t\t&quot;CONTAINER_NAME&quot;: &quot;zookeeper&quot;,</span><br><span class=\"line\">\t\t&quot;CONTAINER_TAG&quot;: &quot;bdc76f9b56db&quot;,</span><br><span class=\"line\">\t\t&quot;CONTAINER_ID&quot;: &quot;bdc76f9b56db&quot;,</span><br><span class=\"line\">\t\t&quot;_PID&quot;: &quot;16046&quot;,</span><br><span class=\"line\">\t\t&quot;_COMM&quot;: &quot;dockerd-current&quot;,</span><br><span class=\"line\">\t\t&quot;_EXE&quot;: &quot;\\&#x2F;usr\\&#x2F;bin\\&#x2F;dockerd-current&quot;,</span><br><span class=\"line\">\t\t&quot;_CMDLINE&quot;: &quot;\\&#x2F;usr\\&#x2F;bin\\&#x2F;dockerd-current --add-runtime docker-runc&#x3D;\\&#x2F;usr\\&#x2F;libexec\\&#x2F;docker\\&#x2F;docker-runc-current --default-runtime&#x3D;docker-runc --exec-opt native.cgroupdriver&#x3D;systemd --userland-proxy-path&#x3D;\\&#x2F;usr\\&#x2F;libexec\\&#x2F;docker\\&#x2F;docker-proxy-current --init-path&#x3D;\\&#x2F;usr\\&#x2F;libexec\\&#x2F;docker\\&#x2F;docker-init-current --seccomp-profile&#x3D;\\&#x2F;etc\\&#x2F;docker\\&#x2F;seccomp.json --selinux-enabled --log-driver&#x3D;journald --signature-verification&#x3D;false --storage-driver overlay2&quot;,</span><br><span class=\"line\">\t\t&quot;_SYSTEMD_CGROUP&quot;: &quot;\\&#x2F;system.slice\\&#x2F;docker.service&quot;,</span><br><span class=\"line\">\t\t&quot;_SYSTEMD_UNIT&quot;: &quot;docker.service&quot;,</span><br><span class=\"line\">\t\t&quot;MESSAGE&quot;: &quot;2020-02-29 02:30:26,634 [myid:] - WARN  [NIOServerCxn.Factory:0.0.0.0\\&#x2F;0.0.0.0:2181:NIOServerCnxn@376] - Unable to read additional data from client sessionid 0x0, likely client has closed socket&quot;,</span><br><span class=\"line\">\t\t&quot;_SOURCE_REALTIME_TIMESTAMP&quot;: &quot;1582943426634852&quot;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125; &#123;</span><br><span class=\"line\">\t&quot;_index&quot;: &quot;filebeat-7.6.0-2020.03.07-000001&quot;,</span><br><span class=\"line\">\t&quot;_type&quot;: &quot;_doc&quot;,</span><br><span class=\"line\">\t&quot;_id&quot;: &quot;hBtStHAB2wqxgggKYbTw&quot;,</span><br><span class=\"line\">\t&quot;_version&quot;: 1,</span><br><span class=\"line\">\t&quot;_score&quot;: 1,</span><br><span class=\"line\">\t&quot;_source&quot;: &#123;</span><br><span class=\"line\">\t\t&quot;agent&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;hostname&quot;: &quot;192.168.237.11&quot;,</span><br><span class=\"line\">\t\t\t&quot;id&quot;: &quot;4f346e18-c77b-4a8c-ae9a-f97b2007be60&quot;,</span><br><span class=\"line\">\t\t\t&quot;ephemeral_id&quot;: &quot;b9759c98-cfbe-4240-8c7d-1e64c1caeec3&quot;,</span><br><span class=\"line\">\t\t\t&quot;type&quot;: &quot;filebeat&quot;,</span><br><span class=\"line\">\t\t\t&quot;version&quot;: &quot;7.6.0&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;nginx&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;access&quot;: &#123;</span><br><span class=\"line\">\t\t\t\t&quot;remote_ip_list&quot;: [</span><br><span class=\"line\">\t\t\t\t\t&quot;192.168.237.1&quot;</span><br><span class=\"line\">\t\t\t\t]</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;log&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;file&quot;: &#123;</span><br><span class=\"line\">\t\t\t\t&quot;path&quot;: &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;access.log&quot;</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&quot;offset&quot;: 83567</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;source&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;address&quot;: &quot;192.168.237.1&quot;,</span><br><span class=\"line\">\t\t\t&quot;ip&quot;: &quot;192.168.237.1&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;fileset&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;name&quot;: &quot;access&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;url&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;original&quot;: &quot;&#x2F;&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;input&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;type&quot;: &quot;log&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;@timestamp&quot;: &quot;2020-03-07T09:27:40.000Z&quot;,</span><br><span class=\"line\">\t\t&quot;ecs&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;version&quot;: &quot;1.4.0&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;service&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;type&quot;: &quot;nginx&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;host&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;name&quot;: &quot;192.168.237.11&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;http&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;request&quot;: &#123;</span><br><span class=\"line\">\t\t\t\t&quot;referrer&quot;: &quot;-&quot;,</span><br><span class=\"line\">\t\t\t\t&quot;method&quot;: &quot;GET&quot;</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&quot;response&quot;: &#123;</span><br><span class=\"line\">\t\t\t\t&quot;status_code&quot;: 304,</span><br><span class=\"line\">\t\t\t\t&quot;body&quot;: &#123;</span><br><span class=\"line\">\t\t\t\t\t&quot;bytes&quot;: 0</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&quot;version&quot;: &quot;1.1&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;event&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;timezone&quot;: &quot;+08:00&quot;,</span><br><span class=\"line\">\t\t\t&quot;created&quot;: &quot;2020-03-07T09:27:41.512Z&quot;,</span><br><span class=\"line\">\t\t\t&quot;module&quot;: &quot;nginx&quot;,</span><br><span class=\"line\">\t\t\t&quot;dataset&quot;: &quot;nginx.access&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;user&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;name&quot;: &quot;-&quot;</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t&quot;user_agent&quot;: &#123;</span><br><span class=\"line\">\t\t\t&quot;original&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;80.0.3987.132 Safari&#x2F;537.36&quot;,</span><br><span class=\"line\">\t\t\t&quot;os&quot;: &#123;</span><br><span class=\"line\">\t\t\t\t&quot;name&quot;: &quot;Windows&quot;,</span><br><span class=\"line\">\t\t\t\t&quot;version&quot;: &quot;10&quot;,</span><br><span class=\"line\">\t\t\t\t&quot;full&quot;: &quot;Windows 10&quot;</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&quot;name&quot;: &quot;Chrome&quot;,</span><br><span class=\"line\">\t\t\t&quot;device&quot;: &#123;</span><br><span class=\"line\">\t\t\t\t&quot;name&quot;: &quot;Other&quot;</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t&quot;version&quot;: &quot;80.0.3987.132&quot;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们开用使用filebeat提供的modules采集nginx日志也成功,而且可以看到展示的信息也更加完善了。可以看到filebeat提供的各种modules就是帮我们做了一些解析工作，其他modules的用法类似。</p>\n<h2 id=\"3-7-使用Kibana展示\"><a href=\"#3-7-使用Kibana展示\" class=\"headerlink\" title=\"3.7 使用Kibana展示\"></a>3.7 使用Kibana展示</h2><ul>\n<li>修改filebeat配置</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 filebeat]$ vi iio.yml </span><br><span class=\"line\"></span><br><span class=\"line\">filebeat.inputs:</span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">- <span class=\"built_in\">type</span>: <span class=\"built_in\">log</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  enabled: <span class=\"literal\">true</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  paths:</span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">    - /usr/<span class=\"built_in\">local</span>/nginx/logs/*.<span class=\"built_in\">log</span></span></span><br><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">  tags: [<span class=\"string\">&quot;nginx&quot;</span>]</span></span><br><span class=\"line\">setup.template.settings:</span><br><span class=\"line\">  index.number_of_shards: 1</span><br><span class=\"line\">output.elasticsearch:</span><br><span class=\"line\">  hosts: [&quot;http://192.168.237.11:9200&quot;]</span><br><span class=\"line\">filebeat.config.modules:</span><br><span class=\"line\">  path: $&#123;path.config&#125;/modules.d/*.yml</span><br><span class=\"line\">  reload.enabled: false</span><br><span class=\"line\">setup.kibana:</span><br><span class=\"line\">  host: &quot;192.168.237.11:5601&quot;</span><br><span class=\"line\">~   </span><br></pre></td></tr></table></figure>\n<ul>\n<li>启动Kibana</li>\n</ul>\n<p>下面的安装仪表板依赖Kibana，也就是Kibana必须启动才能安装仪表盘</p>\n<ul>\n<li>安装仪表盘</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#安装仪表盘到Kibana</span><br><span class=\"line\">.&#x2F;metricbeat setup --dashboards</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://image.eelve.com/eblog/2020030704-84aabcd7f21a4af0ab1ccb694e2f5f47.png\" alt=\"2020030704\"></p>\n<ul>\n<li>启动Filebeat</li>\n</ul>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./filebeat  -e -c iio.yml</span><br></pre></td></tr></table></figure>\n<ul>\n<li>观察结果</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/2020030705-77c1f59279aa40d4b8319560da4a6ae5.png\" alt=\"2020030705\"><br><img src=\"https://image.eelve.com/eblog/2020030706-9f858efbcaba4dd898b07e54c2f42a0d.png\" alt=\"2020030706\"></p>\n<p>可以看到Kibana内置的nginx的仪表盘的展示情况，展示相当仿佛，并且还可以随着时间变化而刷新</p>\n<h1 id=\"肆、Filebeat工作原理\"><a href=\"#肆、Filebeat工作原理\" class=\"headerlink\" title=\"肆、Filebeat工作原理\"></a>肆、Filebeat工作原理</h1><p>Filebeat由两个主要组件组成：prospector 和 harvester。</p>\n<ul>\n<li><p>harvester：</p>\n<ul>\n<li>负责读取单个文件的内容。</li>\n<li>如果文件在读取时被删除或重命名，Filebeat将继续读取文件。</li>\n</ul>\n</li>\n<li><p>prospector：</p>\n<ul>\n<li>prospector 负责管理harvester并找到所有要读取的文件来源。</li>\n<li>如果输入类型为日志，则查找器将查找路径匹配的所有文件，并为每个文件启动一个harvester。</li>\n<li>Filebeat目前支持两种prospector类型：log和stdin。</li>\n</ul>\n</li>\n<li><p>Filebeat如何保持文件的状态</p>\n<ul>\n<li>Filebeat 保存每个文件的状态并经常将状态刷新到磁盘上的注册文件中。</li>\n<li>该状态用于记住harvester正在读取的最后偏移量，并确保发送所有日志行。</li>\n<li>如果输出（例如Elasticsearch或Logstash）无法访问，Filebeat会跟踪最后发送的行，并在输出再次可用时继续读取文件。</li>\n<li>在Filebeat运行时，每个prospector内存中也会保存的文件状态信息，当重新启动Filebeat时，将使用注册</li>\n<li>文件的数据来重建文件状态，Filebeat将每个harvester在从保存的最后偏移量继续读取。</li>\n<li>文件状态记录在data/registry文件中。</li>\n</ul>\n<p>```shell script<br>启动命令<br>./filebeat -e -c itcast.yml<br>./filebeat -e -c itcast.yml -d “publish”<br>#参数说明</p>\n</li>\n<li><p>e: 输出到标准输出,默认输出到syslog和logs下</p>\n</li>\n<li><p>c: 指定配置文件</p>\n</li>\n<li><p>d: 输出debug信息</p>\n</li>\n</ul>\n<p>#测试： ./filebeat -e -c iio.yml -d “publish”</p>\n<pre><code>\n---\n\n【**后面的话**】在本文中我们全面的体验了一下filebeat，还和Kibana结合应用了，我们可以看到filebeat和elk三大剑客整合的非常好，特别是Kibana提供了丰富的仪表盘，大大的方便了我们展示。后面还有再结合一下Logstash，使用以下过滤功能。\n\n---\n\n![薏米笔记](https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png)\n</code></pre>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Beats","path":"api/tags/Beats.json"},{"name":"FileBeat","path":"api/tags/FileBeat.json"}]},{"title":"Elastic Stack实战之Kibana初体验","slug":"Elastic-Stack实战之Kibana初体验","date":"2020-03-03T11:49:22.000Z","updated":"2021-04-19T06:52:48.652Z","comments":true,"path":"api/articles/Elastic-Stack实战之Kibana初体验.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/illustrated-screenshot-hero-kibana-ab9ac4d9e6e748fda40fbdff14591bc6.png","content":"<p>【<strong>前面的话</strong>】在前面已经安装好了Elasticsearch和Logstash，今天就来<a href=\"https://www.elastic.co/cn/kibana\">Kibana</a>进行一下初步体验。</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Logstash:</span> <span class=\"string\">logstash-7.6.0</span></span><br><span class=\"line\"><span class=\"attr\">Kibana:</span> <span class=\"string\">kibana-7.6.0</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、Kibana介绍\"><a href=\"#贰、Kibana介绍\" class=\"headerlink\" title=\"贰、Kibana介绍\"></a>贰、Kibana介绍</h1><p><img src=\"https://image.eelve.com/eblog/illustrated-screenshot-hero-kibana-ab9ac4d9e6e748fda40fbdff14591bc6.png\" alt=\"illustrated-screenshot-hero-kibana\"></p>\n<pre><code>Kibana是了解 Elastic Stack 的窗口。\n\n通过 Kibana，您可以对自己的 Elasticsearch 进行可视化，还可以在 Elastic Stack 中进行导航，这样您便可以进行各种操作了，从跟踪查询负载，到理解请求如何流经您的整个应用，都能轻松完成。 \n</code></pre>\n<p><strong>可视化和分析：</strong> Kibana 让您能够自由地选择如何呈现自己的数据，一张图片胜过千万行日志，可以用下面几个特点来阐述：</p>\n<p><img src=\"https://image.eelve.com/eblog/animated-gif-lens-drag-and-drop-150ecdc9e8314ff798ae5958edac5963.gif\" alt=\"animated-gif-lens-drag-and-drop\"></p>\n<ul>\n<li><p><strong>基本内容：</strong> Kibana 核心产品搭载了一批经典功能：柱状图、线状图、饼图、旭日图，等等。当然啦，您还可以搜索自己的所有文档。            </p>\n<p><img src=\"https://image.eelve.com/eblog/kibana-basics-with-vega-87818e2dc2df4800bd116de2eb8ecf39.jpg\" alt=\"kibana-basics-with-vega\"></p>\n</li>\n<li><p><strong>位置分析：</strong> 借助 Elastic Maps，探索位置数据，还可以获得创意并对定制图层和矢量形状进行可视化。            </p>\n</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/geo-101256c64dc24b04abede3b0088ef4b8.jpg\" alt=\"geo\"></p>\n<ul>\n<li><strong>时间序列：</strong> 借助精选的时序数据 UI，对您 Elasticsearch 中的数据执行高级时间序列分析。您可以利用功能强大、简单易学的表达式来描述查询、转换和可视化。</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/kibana-timeseries-9cdce1ca946f44da9279e8c7577709e0.jpg\" alt=\"kibana-timeseries\"></p>\n<ul>\n<li><strong>Machine Learning：</strong> 借助非监督型 Machine Learning 功能来检测隐藏在您 Elasticsearch 数据中的异常情况并探索那些对它们有显著影响的属性。 </li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/kibana-machine-learning-5148691b6084492fb47558ebbee177e1.jpg\" alt=\"kibana-machine-learning\"></p>\n<ul>\n<li><strong>图表和网络：</strong> 凭借搜索引擎的相关性功能，结合 Graph 关联分析，揭示您 Elasticsearch 数据中极其常见的关系。 </li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/kibana-graph-e0e161ba7f3a4d6bb3c0640701e49a30.jpg\" alt=\"kibana-graph\"></p>\n<h1 id=\"叁、Kibana安装\"><a href=\"#叁、Kibana安装\" class=\"headerlink\" title=\"叁、Kibana安装\"></a>叁、Kibana安装</h1><h2 id=\"3-1-下载地址\"><a href=\"#3-1-下载地址\" class=\"headerlink\" title=\"3.1 下载地址\"></a>3.1 下载地址</h2><p><a href=\"https://artifacts.elastic.co/downloads/kibana/kibana-7.6.0-linux-x86_64.tar.gz\">kibana-7.6.0-linux-x86_64.tar.gz</a></p>\n<hr>\n<h2 id=\"3-2-解压kibana-7-6-0-linux-x86-64-tar-gz\"><a href=\"#3-2-解压kibana-7-6-0-linux-x86-64-tar-gz\" class=\"headerlink\" title=\"3.2 解压kibana-7.6.0-linux-x86_64.tar.gz\"></a>3.2 解压kibana-7.6.0-linux-x86_64.tar.gz</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zvxf kibana-7.6.0-linux-x86_64.tar.gz -C /usr/elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-3-kibana配置说明\"><a href=\"#3-3-kibana配置说明\" class=\"headerlink\" title=\"3.3 kibana配置说明\"></a>3.3 kibana配置说明</h2><p>默认配置配置不需要改，下面给出一个最小的配置</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.port: 5601 #浏览器访问端口</span><br><span class=\"line\">server.host: &quot;192.168.237.11&quot;  #对外的服务地址</span><br><span class=\"line\">elasticsearch.hosts: [&quot;http://192.168.237.11:9200&quot;] #这里为你的elasticsearch集群的地址</span><br></pre></td></tr></table></figure>\n<h1 id=\"肆、Kibana简单使用\"><a href=\"#肆、Kibana简单使用\" class=\"headerlink\" title=\"肆、Kibana简单使用\"></a>肆、Kibana简单使用</h1><h2 id=\"4-1-启动Elasticsearch\"><a href=\"#4-1-启动Elasticsearch\" class=\"headerlink\" title=\"4.1 启动Elasticsearch\"></a>4.1 启动Elasticsearch</h2><p>首先我门要启动Elasticsearch，不然Kibana没有数据来源。同时检查是否启动成功，如下图</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030301-00f0ff22c74c4275be3690daa471cfa2.jpg\" alt=\"2020030301\"></p>\n<h2 id=\"4-2-启动Kibana\"><a href=\"#4-2-启动Kibana\" class=\"headerlink\" title=\"4.2 启动Kibana\"></a>4.2 启动Kibana</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./kibana</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>然后观察日志</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">log   [13:27:27.338] [info][plugins-service] Plugin &quot;case&quot; is disabled.</span><br><span class=\"line\">log   [13:27:33.648] [info][plugins-system] Setting up [37] plugins: [licensing,taskManager,siem,code,infra,encryptedSavedObjects,usageCollection,metrics,canvas,timelion,features,security,apm_oss,translations,reporting,uiActions,data,navigation,newsfeed,share,status_page,home,spaces,cloud,apm,graph,bfetch,kibana_legacy,management,dev_tools,eui_utils,inspector,expressions,visualizations,embeddable,advancedUiActions,dashboard_embeddable_container]</span><br><span class=\"line\">log   [13:27:33.650] [info][licensing][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.652] [info][plugins][taskManager] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.667] [info][plugins][siem] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.667] [info][code][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.668] [info][infra][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.670] [info][encryptedSavedObjects][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.671] [warning][config][encryptedSavedObjects][plugins] Generating a random key for xpack.encryptedSavedObjects.encryptionKey. To be able to decrypt encrypted saved objects attributes after restart, please set xpack.encryptedSavedObjects.encryptionKey in kibana.yml</span><br><span class=\"line\">log   [13:27:33.677] [info][plugins][usageCollection] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.679] [info][metrics][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.680] [info][canvas][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.687] [info][plugins][timelion] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.689] [info][features][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.690] [info][plugins][security] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.691] [warning][config][plugins][security] Generating a random key for xpack.security.encryptionKey. To prevent sessions from being invalidated on restart, please set xpack.security.encryptionKey in kibana.yml</span><br><span class=\"line\">log   [13:27:33.691] [warning][config][plugins][security] Session cookies will be transmitted over insecure connections. This is not recommended.</span><br><span class=\"line\">log   [13:27:33.714] [info][apm_oss][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.715] [info][plugins][translations] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.715] [info][data][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.722] [info][plugins][share] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.724] [info][home][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.730] [info][plugins][spaces] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.736] [info][cloud][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.738] [info][apm][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.915] [info][graph][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.921] [info][bfetch][plugins] Setting up plugin</span><br><span class=\"line\">log   [13:27:33.933] [info][savedobjects-service] Waiting until all Elasticsearch nodes are compatible with Kibana before starting saved objects migrations...</span><br><span class=\"line\">log   [13:27:33.933] [info][savedobjects-service] Starting saved objects migrations</span><br><span class=\"line\">log   [13:27:34.115] [info][plugins-system] Starting [22] plugins: [licensing,taskManager,siem,code,infra,encryptedSavedObjects,usageCollection,metrics,canvas,timelion,features,security,apm_oss,translations,data,share,home,spaces,cloud,apm,graph,bfetch]</span><br><span class=\"line\">log   [13:27:40.328] [info][status][plugin:kibana@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.346] [info][status][plugin:elasticsearch@7.6.0] Status changed from uninitialized to yellow - Waiting for Elasticsearch</span><br><span class=\"line\">log   [13:27:40.348] [info][status][plugin:elasticsearch@7.6.0] Status changed from yellow to green - Ready</span><br><span class=\"line\">log   [13:27:40.358] [info][status][plugin:xpack_main@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.392] [info][status][plugin:graph@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.426] [info][kibana-monitoring][monitoring] Starting monitoring stats collection</span><br><span class=\"line\">log   [13:27:40.430] [info][status][plugin:monitoring@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.471] [info][status][plugin:spaces@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.507] [info][status][plugin:security@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.543] [info][status][plugin:searchprofiler@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.557] [info][status][plugin:ml@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.807] [info][status][plugin:tilemap@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.812] [info][status][plugin:watcher@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.836] [info][status][plugin:grokdebugger@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.856] [info][status][plugin:dashboard_mode@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.863] [info][status][plugin:logstash@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.891] [info][status][plugin:beats_management@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:40.958] [info][status][plugin:apm_oss@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.000] [info][status][plugin:apm@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.071] [info][status][plugin:maps@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.083] [info][status][plugin:interpreter@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.122] [info][status][plugin:canvas@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.130] [info][status][plugin:license_management@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.141] [info][status][plugin:index_management@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.228] [info][status][plugin:console@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.238] [info][status][plugin:console_extensions@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.245] [info][status][plugin:index_lifecycle_management@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.286] [info][status][plugin:kuery_autocomplete@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.304] [info][status][plugin:metrics@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.425] [info][status][plugin:infra@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.437] [info][plugins][taskManager][taskManager] TaskManager is identified by the Kibana UUID: ce42b997-a913-4d58-be46-bb1937feedd6</span><br><span class=\"line\">log   [13:27:41.441] [info][status][plugin:task_manager@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.448] [info][status][plugin:rollup@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.547] [info][status][plugin:transform@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.555] [info][status][plugin:encryptedSavedObjects@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.605] [info][status][plugin:actions@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.677] [info][status][plugin:alerting@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.853] [info][status][plugin:siem@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.868] [info][status][plugin:remote_clusters@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.876] [info][status][plugin:cross_cluster_replication@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.937] [info][status][plugin:upgrade_assistant@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:41.994] [info][status][plugin:uptime@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.006] [info][status][plugin:oss_telemetry@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.022] [info][status][plugin:file_upload@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.032] [info][status][plugin:data@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.067] [info][status][plugin:lens@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.136] [info][status][plugin:snapshot_restore@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.151] [info][status][plugin:input_control_vis@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.164] [info][status][plugin:navigation@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.169] [info][status][plugin:management@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.174] [info][status][plugin:kibana_react@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.178] [info][status][plugin:region_map@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.217] [info][status][plugin:telemetry@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.226] [info][status][plugin:metric_vis@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.230] [info][status][plugin:markdown_vis@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.399] [info][status][plugin:timelion@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.403] [info][status][plugin:ui_metric@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.406] [info][status][plugin:tagcloud@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.410] [info][status][plugin:table_vis@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.414] [info][status][plugin:vega@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:42.421] [warning][browser-driver][reporting] Enabling the Chromium sandbox provides an additional layer of protection.</span><br><span class=\"line\">log   [13:27:44.878] [warning][reporting] Generating a random key for xpack.reporting.encryptionKey. To prevent pending reports from failing on restart, please set xpack.reporting.encryptionKey in kibana.yml</span><br><span class=\"line\">log   [13:27:44.888] [info][status][plugin:reporting@7.6.0] Status changed from uninitialized to green - Ready</span><br><span class=\"line\">log   [13:27:44.970] [info][listening] Server running at http://192.168.237.11:5601</span><br><span class=\"line\">log   [13:27:45.502] [info][server][Kibana][http] http server running at http://192.168.237.11:5601</span><br><span class=\"line\">log   [13:27:45.549] [error][reporting] The Reporting plugin encountered issues launching Chromium in a self-test. You may have trouble generating reports.</span><br><span class=\"line\">log   [13:27:45.549] [error][reporting] ErrorEvent &#123;</span><br><span class=\"line\">target:</span><br><span class=\"line\"> WebSocket &#123;</span><br><span class=\"line\">   _events:</span><br><span class=\"line\">    [Object: null prototype] &#123; open: [Function], error: [Function] &#125;,</span><br><span class=\"line\">   _eventsCount: 2,</span><br><span class=\"line\">   _maxListeners: undefined,</span><br><span class=\"line\">   readyState: 3,</span><br><span class=\"line\">   protocol: &#x27;&#x27;,</span><br><span class=\"line\">   _binaryType: &#x27;nodebuffer&#x27;,</span><br><span class=\"line\">   _closeFrameReceived: false,</span><br><span class=\"line\">   _closeFrameSent: false,</span><br><span class=\"line\">   _closeMessage: &#x27;&#x27;,</span><br><span class=\"line\">   _closeTimer: null,</span><br><span class=\"line\">   _closeCode: 1006,</span><br><span class=\"line\">   _extensions: &#123;&#125;,</span><br><span class=\"line\">   _receiver: null,</span><br><span class=\"line\">   _sender: null,</span><br><span class=\"line\">   _socket: null,</span><br><span class=\"line\">   _isServer: false,</span><br><span class=\"line\">   _redirects: 0,</span><br><span class=\"line\">   url:</span><br><span class=\"line\">    &#x27;ws://127.0.0.1:44598/devtools/browser/cde91cb8-faad-4730-9d12-57c1e8ffd49a&#x27;,</span><br><span class=\"line\">   _req: null &#125;,</span><br><span class=\"line\">type: &#x27;error&#x27;,</span><br><span class=\"line\">message: &#x27;connect ECONNREFUSED 127.0.0.1:44598&#x27;,</span><br><span class=\"line\">error:</span><br><span class=\"line\"> &#123; Error: connect ECONNREFUSED 127.0.0.1:44598</span><br><span class=\"line\">     at TCPConnectWrap.afterConnect [as oncomplete] (net.js:1107:14)</span><br><span class=\"line\">   errno: &#x27;ECONNREFUSED&#x27;,</span><br><span class=\"line\">   code: &#x27;ECONNREFUSED&#x27;,</span><br><span class=\"line\">   syscall: &#x27;connect&#x27;,</span><br><span class=\"line\">   address: &#x27;127.0.0.1&#x27;,</span><br><span class=\"line\">   port: 44598 &#125; &#125;</span><br><span class=\"line\">log   [13:27:45.557] [warning][reporting] See Chromium&#x27;s log output at &quot;/usr/elastic/kibana/data/headless_shell-linux/chrome_debug.log&quot;</span><br><span class=\"line\">log   [13:27:45.559] [warning][reporting] Reporting plugin self-check generated a warning: Error: Could not close browser client handle!</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-3-浏览器访问\"><a href=\"#4-3-浏览器访问\" class=\"headerlink\" title=\"4.3 浏览器访问\"></a>4.3 浏览器访问</h2><p><img src=\"https://image.eelve.com/eblog/2020030302-e7c518603e69473a8438fb32a9454154.png\" alt=\"2020030302\"></p>\n<p>下面我们继续操作，利用搭建Elasticsearch的时候添加的数据做一个可视化图表出来</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030306-5f167cf3142041ad944de9b7b0ff0eb9.png\" alt=\"2020030306\"></p>\n<p><img src=\"https://image.eelve.com/eblog/2020030303-9787af1aceb148ef8b2f6a49015630c4.png\" alt=\"2020030303\"><br><img src=\"https://image.eelve.com/eblog/2020030304-a74acb31fabc4f4da44e96e0c7a28610.png\" alt=\"2020030304\"><br><img src=\"https://image.eelve.com/eblog/2020030305-c4f00a780a704435b28eb34f360857da.png\" alt=\"2020030305\"><br><img src=\"https://image.eelve.com/eblog/2020030308-53cd70f082074829afb4ee887948b24a.png\" alt=\"2020030308\"><br><img src=\"https://image.eelve.com/eblog/2020030311-d8de4d9839d34d38b731ba0ce0be2336.png\" alt=\"2020030311\"></p>\n<p>我们可以看到已经利用数据做出了一个柱饼图了，下面就再美化以下，得到最终结果</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030312-452f0ac1954844cab0ea2955bd43dfa2.png\" alt=\"2020030312\"></p>\n<p>另外我们还可以保存分享</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030313-425f770de5064b06b8951748d6a0d01b.png\" alt=\"2020030313\"></p>\n<p>然后我们还可以使用一下Kibana的开发工具，给<strong>eelve</strong>新加一条数据</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030314-1689d96967794fc38f042ea3807dfc1d.png\" alt=\"2020030314\"><br><img src=\"https://image.eelve.com/eblog/2020030315-68061267b1ac4b13a7844b873aa06c6b.png\" alt=\"2020030315\"></p>\n<p>然后再刷新图表，可以看到数据会产生相应的变化</p>\n<p><img src=\"https://image.eelve.com/eblog/2020030316-bb66b6f0ba19419abc0ea3b674703f1b.png\" alt=\"2020030316\"></p>\n<p>也就是说如果数据是实时变化的话，这边的图表也会跟着变化。</p>\n<h1 id=\"伍、Kibana特性\"><a href=\"#伍、Kibana特性\" class=\"headerlink\" title=\"伍、Kibana特性\"></a>伍、Kibana特性</h1><ul>\n<li><p>强大的定制功能：根据业务通过Kibana中的Canvas，发挥无限创意自由定制</p>\n<ul>\n<li><p>日志分析</p>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-canvas-log-analysis-e24abcc3311841c886dbc36c8ca8dc05.png\" alt=\"screenshot-canvas-log-analysis\"></p>\n</li>\n<li><p>基础设施监测</p>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-canvas-infrastructure-706070724cb94eabbe6c37f1c82ce66d.png\" alt=\"screenshot-canvas-infrastructure\"></p>\n</li>\n<li><p>APM</p>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-canvas-apm-d007b95db41646a8832f1b1e35734c14.png\" alt=\"screenshot-canvas-apm\"></p>\n</li>\n<li><p>安全运营</p>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-canvas-security-operations-dd4a909ca4164efa93a30fc9e4c7b7e3.png\" alt=\"screenshot-canvas-security-operations\"></p>\n</li>\n<li><p>业务分析</p>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-canvas-business-analytics-76b7f80430664be09ca4a2798ffb7faa.png\" alt=\"screenshot-canvas-business-analytics\"></p>\n</li>\n</ul>\n</li>\n<li><p>把制作好的图表分享，让每个人都感受到 Kibana 的便利：只需选择适合您的分享选项，即可轻松地把 Kibana 可视化分享给您选择的任何人：您的团队成员、您的老板、老板的老板、您的客户、合规经理或承包商。嵌入仪表板，分享链接，或者导出为 PDF、PNG 或 CSV 文件并作为附件发送给别人。</p>\n</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/reporting_no_zoom-optimized-1144e12a2f5e4e308fb9aee150ea7629.gif\" alt=\"reporting_no_zoom-optimized\"></p>\n<ul>\n<li>良好的控制访问权限：通过 Kibana Spaces 整理您的仪表板和可视化。通过基于角色的访问控制，邀请用户访问某些空间（但不允许访问其他空间），让他们能够查看特定内容并使用特定功能。</li>\n</ul>\n<p><img src=\"https://image.eelve.com/eblog/SlqFLG8AMNZiQXp.webp.gif\" alt=\"security-login.gif\"></p>\n<ul>\n<li><p>管理：用于数据采集等操作的堆栈管理，有了 Kibana，命令行不再是管理安全设置、监测堆栈、采集和汇总数据或配置其他 Elastic Stack 功能的唯一途径。与此同时，得益于我们出色的 API，用户可以通过可视化 UI 轻松地管理 Elastic Stack 并确保其安全性，这种方式更加直观，也能让更多的人上手使用。</p>\n<ul>\n<li><p>添加数据</p>\n<p><img src=\"https://image.eelve.com/eblog/kibana-homepage-ca50d6a5d73b4e5e981724528a492eca.jpg\" alt=\"kibana-homepage\"></p>\n</li>\n<li><p>确保访问的安全性</p>\n<p><img src=\"https://image.eelve.com/eblog/kibana-management-security-2be33e4e888845ea87d6537b2eeaeb7f.jpg\" alt=\"kibana-management-security\"></p>\n</li>\n<li><p>管理管道</p>\n<p><img src=\"https://image.eelve.com/eblog/kibana-management-logstash-f9dbc5faf2ed484f9643ead95ef57e02.jpg\" alt=\"kibana-management-logstash\"></p>\n</li>\n<li><p>汇总</p>\n<p><img src=\"https://image.eelve.com/eblog/screenshot-rollups-management-ui-ec0be7dea0374a21a95bd18a048c094f.jpg\" alt=\"screenshot-rollups-management-ui\"></p>\n</li>\n<li><p>开发工具</p>\n<p><img src=\"https://image.eelve.com/eblog/5.5-console-80pct-generic-rgb-360a6e4bbf484353b27151e27de93b2e.jpg\" alt=\"5.5-console-80pct-generic-rgb\"></p>\n</li>\n</ul>\n</li>\n<li><p>可直接应用于用例</p>\n</li>\n</ul>\n<p>有时您只想对某个文件进行 tail 操作。您可能希望跟踪自己网站的运行状态。或者您可能希望查看分布式痕迹。通过 Kibana 内置应用，例如 Logs、Infrastructure、APM、Uptime 以及其他应用，无需离开 Kibana，便能轻松完成这一切。    </p>\n<p><img src=\"https://image.eelve.com/eblog/image4-2-d9d1a61d020f4af7b934c3e6fa424208.png\" alt=\"image4-2\"></p>\n<hr>\n<p>【<strong>后面的话</strong>】利用Kibana我们可以做出炫酷的符合业务且满足客户可视化展示。并且Kibana本身都提供相当多数量的各种图标模板，通过各种图标的组合可以轻松的开发一个属于我们自己的大屏。另外我们需要注意的是，我们应该根据我们的数据的特点选择合适的图表进行展示，这样可以是我们的图表显得更美观。今天只是体验了Kibana的部分功能，后续的其他功能，将配合Beats进行体验。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"Elastic-Stack","path":"api/categories/Elastic-Stack.json"}],"tags":[{"name":"ELK","path":"api/tags/ELK.json"},{"name":"Kibana","path":"api/tags/Kibana.json"}]}]}