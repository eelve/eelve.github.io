{"title":"站点迁移指北","slug":"站点迁移指北","date":"2020-11-07T13:53:22.000Z","updated":"2021-04-19T06:44:39.271Z","comments":true,"path":"api/articles/站点迁移指北.json","excerpt":null,"covers":["https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png"],"content":"<p>【<strong>前面的话</strong>】由于服务器快到期了，就重新另购了一台服务器。这边就来记录一下迁移的过程和日常数据备份等等。</p>\n<h1 id=\"壹、站点概览\"><a href=\"#壹、站点概览\" class=\"headerlink\" title=\"壹、站点概览\"></a>壹、站点概览</h1><p>我的站点使用<code>halo</code>搭建的，主要涉及到的中间件有：<code>Nginx</code>、<code>Mysql</code>等；日常运行产生的数据有站点运行数据和资源数据，所以站点迁移也会从这些方面着手。</p>\n<h1 id=\"贰、中间件迁移\"><a href=\"#贰、中间件迁移\" class=\"headerlink\" title=\"贰、中间件迁移\"></a>贰、中间件迁移</h1><h2 id=\"2-1、Nginx\"><a href=\"#2-1、Nginx\" class=\"headerlink\" title=\"2.1、Nginx\"></a>2.1、Nginx</h2><p>其实<code>Nginx</code>的迁移很简单，只需要在新的服务器中安装即可，然后迁移<code>nginx.conf</code>配置文件。我的站点还用到<code>https</code>，所有在安装的时候要注意安装相应的模块以及证书的迁移。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --prefix=/usr/<span class=\"built_in\">local</span>/nginx --add-module=../ngx_cache_purge-1.3/  --with-http_stub_status_module --with-http_ssl_module --with-http_flv_module --with-http_gzip_static_module</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-2、Mysql\"><a href=\"#2-2、Mysql\" class=\"headerlink\" title=\"2.2、Mysql\"></a>2.2、Mysql</h2><p>在新的服务器安装<code>Mysql</code>服务，然后导入sql文件即可：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqldump <span class=\"operator\">-</span>u$db_user <span class=\"operator\">-</span>p$db_password $db_name <span class=\"operator\">|</span> gzip <span class=\"operator\">&gt;</span> <span class=\"operator\">/</span>home<span class=\"operator\">/</span>firbackup<span class=\"operator\">/</span>halodb.sql.gz</span><br></pre></td></tr></table></figure>\n<h1 id=\"叁、资源数据\"><a href=\"#叁、资源数据\" class=\"headerlink\" title=\"叁、资源数据\"></a>叁、资源数据</h1><p>对于资源数据，主要是<code>halo</code>产生的主题以及上传的文章的图片等等。就直接采用压缩打包，然后发送到新服务器再解压即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar czvf /home/firbackup/halo.tar.gz  /root/.halo</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#如果在同一个内网，记得使用内网ip，速度会更快哦</span></span><br><span class=\"line\">scp halo.tar.gz  root@ip.ip.ip.ip:/root/</span><br></pre></td></tr></table></figure>\n<p>然后再解压到<code>/root/.halo</code> 文件夹即可</p>\n<h1 id=\"肆、重新启动\"><a href=\"#肆、重新启动\" class=\"headerlink\" title=\"肆、重新启动\"></a>肆、重新启动</h1><p>配置域名解析和相应的安全策略以及安装<code>JDK</code>之后，你就可以重新启动<code>halo</code>服务就好，到这里站点迁移工作就完成了。</p>\n<hr>\n<h1 id=\"【后面的话】\"><a href=\"#【后面的话】\" class=\"headerlink\" title=\"【后面的话】\"></a>【<strong>后面的话</strong>】</h1><p>日常备份也就是应用的配置文件以及应用产生的必要数据的备份。我这边的方案是定时打包压缩之后发送到邮箱中。下面给出具体脚本：</p>\n<h2 id=\"安装配置mailx\"><a href=\"#安装配置mailx\" class=\"headerlink\" title=\"安装配置mailx\"></a>安装配置<code>mailx</code></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install mailx</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/mail.rc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加如下配置</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> ssl-verify=ignore</span><br><span class=\"line\"><span class=\"built_in\">set</span> nss-config-dir=/root/.certs/   <span class=\"comment\">#使用命令find / -name &quot;cert*.db&quot; 查找位置（根据自身系统而定）</span></span><br><span class=\"line\"><span class=\"comment\">#weikeyi 发送email的设置</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> from=youremail@163.com  <span class=\"comment\">#163邮箱账号</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp=smtps://smtp.163.com:465   <span class=\"comment\">###smtp服务商#端口465#smtps协议</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp-auth-user=youremail@163.com  <span class=\"comment\">#与上邮箱相同</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp-auth-password=yourpasswd   <span class=\"comment\">#自己的授权码#非邮箱密码</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp-auth=login</span><br></pre></td></tr></table></figure>\n<p>如果在测试执行脚本，发现发送报错的话，那就是证书有问题，只需要在上面提到的<code>/root/.certs/</code>文件夹中放置<code>163邮箱</code>的证书即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.11:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 236028/17228757</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.16:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 6966/507305</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.11:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 324/22426</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.14:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 48/2440</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.17:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 342/10021</span><br><span class=\"line\">. . . message not sent.</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"编写脚本\"><a href=\"#编写脚本\" class=\"headerlink\" title=\"编写脚本\"></a>编写脚本</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#firbackup 文件和 and database</span></span><br><span class=\"line\"><span class=\"comment\">###################删除halo备份#################</span></span><br><span class=\"line\">rm -fr /home/firbackup/halo_$(date -d <span class=\"string\">&#x27;7 days ago&#x27;</span> +%Y%m%d).tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################备份halo#################</span></span><br><span class=\"line\">tar czvf /home/firbackup/halo_$(date +%Y%m%d).tar.gz  /root/.halo</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;halo备份的下载地址：http://eelve.com/bp/&#x27;</span>halo_$(date +%Y%m%d).tar.gz &gt;&gt; /home/firbackup/info_$(date +%Y%m%d).txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################删除备份数据库####################</span></span><br><span class=\"line\">rm -fr /home/firbackup/halodb_$(date -d <span class=\"string\">&#x27;7 days ago&#x27;</span> +%Y%m%d).sql.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################备份halodb数据库####################</span></span><br><span class=\"line\">db_user=<span class=\"string\">&quot;root&quot;</span>       <span class=\"comment\">#输入你的数据库用户名 </span></span><br><span class=\"line\">db_password=<span class=\"string\">&quot;root&quot;</span> <span class=\"comment\">#输入你的数据库密码</span></span><br><span class=\"line\">db_name=<span class=\"string\">&quot;halodb&quot;</span>       <span class=\"comment\">#输入你要备份的数据库名   </span></span><br><span class=\"line\">mysqldump -u<span class=\"variable\">$db_user</span> -p<span class=\"variable\">$db_password</span> <span class=\"variable\">$db_name</span> | gzip &gt; /home/firbackup/halodb_$(date +%Y%m%d).sql.gz</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;halo数据库备份的下载地址：http://eelve.com/bp/&#x27;</span>halodb_$(date +%Y%m%d).sql.gz &gt;&gt; /home/firbackup/info_$(date +%Y%m%d).txt </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################准备开始发邮件###############</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/firbackup/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################邮件发halo数据库备份###############</span></span><br><span class=\"line\">mailx -v -s <span class=\"string\">&quot;请注意查收&quot;</span>$(date +%Y%m%d)<span class=\"string\">&quot;halo数据库的相关备份&quot;</span> -a halodb_$(date +%Y%m%d).sql.gz  i@eelve.com&lt;halodb_$(date +%Y%m%d).sql.gz</span><br></pre></td></tr></table></figure>\n<h2 id=\"配置定时任务\"><a href=\"#配置定时任务\" class=\"headerlink\" title=\"配置定时任务\"></a>配置定时任务</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@fir /home]<span class=\"comment\">#crontab -e</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##每天定时01:00:00 执行脚本 /home/firbackup.sh</span></span><br><span class=\"line\">0 1 * * * sh /home/firbackup.sh</span><br><span class=\"line\"><span class=\"comment\">##每天凌晨2点重启springboot应用</span></span><br><span class=\"line\">0 2 * * * sh /home/auto_restart_springboots.sh</span><br></pre></td></tr></table></figure>\n<p>到这里你只需要去邮箱中下载备份的数据就好了。另外邮箱发送附件是有大小限制的，每个邮箱的具体情况不一。另外对于文章中的图片数据可以上传到<code>又拍云</code>等云存储中即可。最后一句话<code>道路千万条，数据备份第一条</code>。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","more":"<p>【<strong>前面的话</strong>】由于服务器快到期了，就重新另购了一台服务器。这边就来记录一下迁移的过程和日常数据备份等等。</p>\n<h1 id=\"壹、站点概览\"><a href=\"#壹、站点概览\" class=\"headerlink\" title=\"壹、站点概览\"></a>壹、站点概览</h1><p>我的站点使用<code>halo</code>搭建的，主要涉及到的中间件有：<code>Nginx</code>、<code>Mysql</code>等；日常运行产生的数据有站点运行数据和资源数据，所以站点迁移也会从这些方面着手。</p>\n<h1 id=\"贰、中间件迁移\"><a href=\"#贰、中间件迁移\" class=\"headerlink\" title=\"贰、中间件迁移\"></a>贰、中间件迁移</h1><h2 id=\"2-1、Nginx\"><a href=\"#2-1、Nginx\" class=\"headerlink\" title=\"2.1、Nginx\"></a>2.1、Nginx</h2><p>其实<code>Nginx</code>的迁移很简单，只需要在新的服务器中安装即可，然后迁移<code>nginx.conf</code>配置文件。我的站点还用到<code>https</code>，所有在安装的时候要注意安装相应的模块以及证书的迁移。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --prefix=/usr/<span class=\"built_in\">local</span>/nginx --add-module=../ngx_cache_purge-1.3/  --with-http_stub_status_module --with-http_ssl_module --with-http_flv_module --with-http_gzip_static_module</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-2、Mysql\"><a href=\"#2-2、Mysql\" class=\"headerlink\" title=\"2.2、Mysql\"></a>2.2、Mysql</h2><p>在新的服务器安装<code>Mysql</code>服务，然后导入sql文件即可：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysqldump <span class=\"operator\">-</span>u$db_user <span class=\"operator\">-</span>p$db_password $db_name <span class=\"operator\">|</span> gzip <span class=\"operator\">&gt;</span> <span class=\"operator\">/</span>home<span class=\"operator\">/</span>firbackup<span class=\"operator\">/</span>halodb.sql.gz</span><br></pre></td></tr></table></figure>\n<h1 id=\"叁、资源数据\"><a href=\"#叁、资源数据\" class=\"headerlink\" title=\"叁、资源数据\"></a>叁、资源数据</h1><p>对于资源数据，主要是<code>halo</code>产生的主题以及上传的文章的图片等等。就直接采用压缩打包，然后发送到新服务器再解压即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar czvf /home/firbackup/halo.tar.gz  /root/.halo</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#如果在同一个内网，记得使用内网ip，速度会更快哦</span></span><br><span class=\"line\">scp halo.tar.gz  root@ip.ip.ip.ip:/root/</span><br></pre></td></tr></table></figure>\n<p>然后再解压到<code>/root/.halo</code> 文件夹即可</p>\n<h1 id=\"肆、重新启动\"><a href=\"#肆、重新启动\" class=\"headerlink\" title=\"肆、重新启动\"></a>肆、重新启动</h1><p>配置域名解析和相应的安全策略以及安装<code>JDK</code>之后，你就可以重新启动<code>halo</code>服务就好，到这里站点迁移工作就完成了。</p>\n<hr>\n<h1 id=\"【后面的话】\"><a href=\"#【后面的话】\" class=\"headerlink\" title=\"【后面的话】\"></a>【<strong>后面的话</strong>】</h1><p>日常备份也就是应用的配置文件以及应用产生的必要数据的备份。我这边的方案是定时打包压缩之后发送到邮箱中。下面给出具体脚本：</p>\n<h2 id=\"安装配置mailx\"><a href=\"#安装配置mailx\" class=\"headerlink\" title=\"安装配置mailx\"></a>安装配置<code>mailx</code></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install mailx</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/mail.rc</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#添加如下配置</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> ssl-verify=ignore</span><br><span class=\"line\"><span class=\"built_in\">set</span> nss-config-dir=/root/.certs/   <span class=\"comment\">#使用命令find / -name &quot;cert*.db&quot; 查找位置（根据自身系统而定）</span></span><br><span class=\"line\"><span class=\"comment\">#weikeyi 发送email的设置</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> from=youremail@163.com  <span class=\"comment\">#163邮箱账号</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp=smtps://smtp.163.com:465   <span class=\"comment\">###smtp服务商#端口465#smtps协议</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp-auth-user=youremail@163.com  <span class=\"comment\">#与上邮箱相同</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp-auth-password=yourpasswd   <span class=\"comment\">#自己的授权码#非邮箱密码</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> smtp-auth=login</span><br></pre></td></tr></table></figure>\n<p>如果在测试执行脚本，发现发送报错的话，那就是证书有问题，只需要在上面提到的<code>/root/.certs/</code>文件夹中放置<code>163邮箱</code>的证书即可。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.11:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 236028/17228757</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.16:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 6966/507305</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.11:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 324/22426</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.14:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 48/2440</span><br><span class=\"line\">. . . message not sent.</span><br><span class=\"line\">Resolving host smtp.163.com . . . <span class=\"keyword\">done</span>.</span><br><span class=\"line\">Connecting to 220.181.12.17:465 . . . connected.</span><br><span class=\"line\">Error initializing NSS: Unknown error -8015.</span><br><span class=\"line\"><span class=\"string\">&quot;/root/dead.letter&quot;</span> 342/10021</span><br><span class=\"line\">. . . message not sent.</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"编写脚本\"><a href=\"#编写脚本\" class=\"headerlink\" title=\"编写脚本\"></a>编写脚本</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#firbackup 文件和 and database</span></span><br><span class=\"line\"><span class=\"comment\">###################删除halo备份#################</span></span><br><span class=\"line\">rm -fr /home/firbackup/halo_$(date -d <span class=\"string\">&#x27;7 days ago&#x27;</span> +%Y%m%d).tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################备份halo#################</span></span><br><span class=\"line\">tar czvf /home/firbackup/halo_$(date +%Y%m%d).tar.gz  /root/.halo</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;halo备份的下载地址：http://eelve.com/bp/&#x27;</span>halo_$(date +%Y%m%d).tar.gz &gt;&gt; /home/firbackup/info_$(date +%Y%m%d).txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################删除备份数据库####################</span></span><br><span class=\"line\">rm -fr /home/firbackup/halodb_$(date -d <span class=\"string\">&#x27;7 days ago&#x27;</span> +%Y%m%d).sql.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################备份halodb数据库####################</span></span><br><span class=\"line\">db_user=<span class=\"string\">&quot;root&quot;</span>       <span class=\"comment\">#输入你的数据库用户名 </span></span><br><span class=\"line\">db_password=<span class=\"string\">&quot;root&quot;</span> <span class=\"comment\">#输入你的数据库密码</span></span><br><span class=\"line\">db_name=<span class=\"string\">&quot;halodb&quot;</span>       <span class=\"comment\">#输入你要备份的数据库名   </span></span><br><span class=\"line\">mysqldump -u<span class=\"variable\">$db_user</span> -p<span class=\"variable\">$db_password</span> <span class=\"variable\">$db_name</span> | gzip &gt; /home/firbackup/halodb_$(date +%Y%m%d).sql.gz</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;halo数据库备份的下载地址：http://eelve.com/bp/&#x27;</span>halodb_$(date +%Y%m%d).sql.gz &gt;&gt; /home/firbackup/info_$(date +%Y%m%d).txt </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################准备开始发邮件###############</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/firbackup/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">###################邮件发halo数据库备份###############</span></span><br><span class=\"line\">mailx -v -s <span class=\"string\">&quot;请注意查收&quot;</span>$(date +%Y%m%d)<span class=\"string\">&quot;halo数据库的相关备份&quot;</span> -a halodb_$(date +%Y%m%d).sql.gz  i@eelve.com&lt;halodb_$(date +%Y%m%d).sql.gz</span><br></pre></td></tr></table></figure>\n<h2 id=\"配置定时任务\"><a href=\"#配置定时任务\" class=\"headerlink\" title=\"配置定时任务\"></a>配置定时任务</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@fir /home]<span class=\"comment\">#crontab -e</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">##每天定时01:00:00 执行脚本 /home/firbackup.sh</span></span><br><span class=\"line\">0 1 * * * sh /home/firbackup.sh</span><br><span class=\"line\"><span class=\"comment\">##每天凌晨2点重启springboot应用</span></span><br><span class=\"line\">0 2 * * * sh /home/auto_restart_springboots.sh</span><br></pre></td></tr></table></figure>\n<p>到这里你只需要去邮箱中下载备份的数据就好了。另外邮箱发送附件是有大小限制的，每个邮箱的具体情况不一。另外对于文章中的图片数据可以上传到<code>又拍云</code>等云存储中即可。最后一句话<code>道路千万条，数据备份第一条</code>。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","categories":[{"name":"lifeme","path":"api/categories/lifeme.json"}],"tags":[{"name":"lifeme","path":"api/tags/lifeme.json"}]}