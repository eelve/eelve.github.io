{"title":"Elastic Stack实战之Elasticsearch初体验(一)本地版","slug":"Elastic-Stack实战之Elasticsearch初体验(一)本地版","date":"2020-03-01T04:34:22.000Z","updated":"2021-04-19T07:47:19.511Z","comments":true,"path":"api/articles/Elastic-Stack实战之Elasticsearch初体验(一)本地版.json","excerpt":null,"covers":["https://eelve.com/upload/2020/3/2020010301-5b565f99650d4acbb3ba464408dca641.png","https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png"],"content":"<p>【<strong>前面的话</strong>】前面已经准备好了服务器环境，今天就来开始安装<a href=\"https://www.elastic.co/cn/elasticsearch\">Elasticsearch</a>然后体验。</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br></pre></td></tr></table></figure>\n<p>这里说一下，Elasticsearch是依赖Java环境的，elasticsearch-7.6.0要求至少为1.8，官方建议为11.如果你的机器上还没有Java环境的话，记得要先准备环境。当然安装也是非常简单：</p>\n<p>1.下载linux版本的jdk</p>\n<p>2.解压然后配置环境变量</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">java environment</span></span><br><span class=\"line\">export JAVA_HOME=/usr/jdk</span><br><span class=\"line\">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/jre/lib/rt.jar:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar</span><br><span class=\"line\">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin</span><br></pre></td></tr></table></figure>\n<p>3.刷新环境变量，检查结果</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# source /etc/profile</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# java -version</span><br><span class=\"line\">java version &quot;1.8.0_211&quot;</span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、Elasticsearch安装\"><a href=\"#贰、Elasticsearch安装\" class=\"headerlink\" title=\"贰、Elasticsearch安装\"></a>贰、Elasticsearch安装</h1><h2 id=\"2-1-下载地址\"><a href=\"#2-1-下载地址\" class=\"headerlink\" title=\"2.1 下载地址\"></a>2.1 下载地址</h2><h2 id=\"elasticsearch-7-6-0-linux-x86-64-tar-gz\"><a href=\"#elasticsearch-7-6-0-linux-x86-64-tar-gz\" class=\"headerlink\" title=\"elasticsearch-7.6.0-linux-x86_64.tar.gz\"></a><a href=\"https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.6.0-linux-x86_64.tar.gz\">elasticsearch-7.6.0-linux-x86_64.tar.gz</a></h2><h2 id=\"2-2-解压elasticsearch-7-6-0-linux-x86-64-tar-gz\"><a href=\"#2-2-解压elasticsearch-7-6-0-linux-x86-64-tar-gz\" class=\"headerlink\" title=\"2.2 解压elasticsearch-7.6.0-linux-x86_64.tar.gz\"></a>2.2 解压elasticsearch-7.6.0-linux-x86_64.tar.gz</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zvxf elasticsearch-7.6.0-linux-x86_64.tar.gz -C /usr/elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-修改elasticsearch配置\"><a href=\"#2-3-修改elasticsearch配置\" class=\"headerlink\" title=\"2.3 修改elasticsearch配置\"></a>2.3 修改elasticsearch配置</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 elastic]# cd /usr/elastic/elasticsearch/config/</span><br><span class=\"line\">[root@192 config]# vi elasticsearch.yml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下面给出单机版安装最小配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">node.name:</span> <span class=\"string\">node-1</span> <span class=\"comment\">#节点名字</span></span><br><span class=\"line\"><span class=\"attr\">network.host:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span> <span class=\"comment\">#生产配置为127.0.0.1，测试可以为其他地址</span></span><br><span class=\"line\"><span class=\"attr\">http.port:</span> <span class=\"number\">9200</span> <span class=\"comment\">#端口</span></span><br><span class=\"line\"><span class=\"attr\">cluster.initial_master_nodes:</span> [<span class=\"string\">&quot;node-1&quot;</span>] <span class=\"comment\">#初始化master节点</span></span><br><span class=\"line\"><span class=\"attr\">http.cors.enabled:</span> <span class=\"literal\">true</span>  <span class=\"comment\">#开启跨域</span></span><br><span class=\"line\"><span class=\"attr\">http.cors.allow-origin:</span> <span class=\"string\">&quot;*&quot;</span> <span class=\"comment\">#开启跨域</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"2-4-后台启动\"><a href=\"#2-4-后台启动\" class=\"headerlink\" title=\"2.4 后台启动\"></a>2.4 后台启动</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# ./elasticsearch</span><br><span class=\"line\">[1] 1620</span><br><span class=\"line\">[root@192 bin]# future versions of Elasticsearch will require Java 11; your Java version from [/usr/jdk/jre] does not meet this requirement</span><br><span class=\"line\">[2020-03-01T11:55:38,871][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-1] uncaught exception in thread [main]</span><br><span class=\"line\">org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:174) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:161) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125) ~[elasticsearch-cli-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:126) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">Caused by: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:105) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:172) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:349) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:170) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\t... 6 more</span><br><span class=\"line\">uncaught exception in thread [main]</span><br><span class=\"line\">java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:105)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:172)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:349)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:170)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:161)</span><br><span class=\"line\">\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.main(Command.java:90)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:126)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92)</span><br><span class=\"line\">For complete error details, refer to the log at /usr/elastic/elasticsearch/logs/eelve.log</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这里说的是elasticsearch不能用root用户启动，这里就需要添加一个用户，然后重新启动</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# adduser iio</span><br><span class=\"line\">[root@192 bin]# passwd iio</span><br><span class=\"line\">Changing password for user iio.</span><br><span class=\"line\">New password: </span><br><span class=\"line\">Retype new password: </span><br><span class=\"line\">passwd: all authentication tokens updated successfully.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>然后更改elasticsearch用户组</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# chown -R iio:iio /usr/elastic/elasticsearch/</span><br></pre></td></tr></table></figure>\n<p>然后就可以启动成功了</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# su iio</span><br><span class=\"line\">[iio@192 bin]$ ./elasticsearch</span><br><span class=\"line\">future versions of Elasticsearch will require Java 11; your Java version from [/usr/jdk/jre] does not meet this requirement</span><br><span class=\"line\">[2020-03-01T12:03:32,970][INFO ][o.e.e.NodeEnvironment    ] [node-1] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [20.9gb], net total_space [25.9gb], types [rootfs]</span><br><span class=\"line\">[2020-03-01T12:03:32,972][INFO ][o.e.e.NodeEnvironment    ] [node-1] heap size [990.7mb], compressed ordinary object pointers [true]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] node name [node-1], node ID [2IBvVjP0QbeA-FDLFoLFFg], cluster name [eelve]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] version[7.6.0], pid[1952], build[default/tar/7f634e9f44834fbc12724506cc1da681b0c3b1e3/2020-02-06T00:09:00.449973Z], OS[Linux/3.10.0-1062.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_211/25.211-b12]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] JVM home [/usr/jdk/jre]</span><br><span class=\"line\">[2020-03-01T12:03:33,104][INFO ][o.e.n.Node               ] [node-1] JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dio.netty.allocator.numDirectArenas=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.locale.providers=COMPAT, -Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Djava.io.tmpdir=/tmp/elasticsearch-5828849950285366888, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -XX:MaxDirectMemorySize=536870912, -Des.path.home=/usr/elastic/elasticsearch, -Des.path.conf=/usr/elastic/elasticsearch/config, -Des.distribution.flavor=default, -Des.distribution.type=tar, -Des.bundled_jdk=true]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [aggs-matrix-stats]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [analysis-common]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [flattened]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [frozen-indices]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-common]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-geoip]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-user-agent]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-expression]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-mustache]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-painless]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [mapper-extras]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [parent-join]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [percolator]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [rank-eval]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [reindex]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [repository-url]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [search-business-rules]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [spatial]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [transform]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [transport-netty4]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [vectors]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-analytics]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ccr]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-core]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-deprecation]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-enrich]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-graph]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ilm]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-logstash]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ml]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-monitoring]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-rollup]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-security]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-sql]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-voting-only-node]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-watcher]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] no plugins loaded</span><br><span class=\"line\">[2020-03-01T12:03:37,968][INFO ][o.e.x.s.a.s.FileRolesStore] [node-1] parsed [0] roles from file [/usr/elastic/elasticsearch/config/roles.yml]</span><br><span class=\"line\">[2020-03-01T12:03:38,382][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [node-1] [controller/2044] [Main.cc@110] controller (64 bit): Version 7.6.0 (Build 1c8cca13fa9631) Copyright (c) 2020 Elasticsearch BV</span><br><span class=\"line\">[2020-03-01T12:03:38,870][DEBUG][o.e.a.ActionModule       ] [node-1] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security</span><br><span class=\"line\">[2020-03-01T12:03:38,999][INFO ][o.e.d.DiscoveryModule    ] [node-1] using discovery type [zen] and seed hosts providers [settings]</span><br><span class=\"line\">[2020-03-01T12:03:39,805][INFO ][o.e.n.Node               ] [node-1] initialized</span><br><span class=\"line\">[2020-03-01T12:03:39,805][INFO ][o.e.n.Node               ] [node-1] starting ...</span><br><span class=\"line\">[2020-03-01T12:03:39,954][INFO ][o.e.t.TransportService   ] [node-1] publish_address &#123;192.168.237.11:9300&#125;, bound_addresses &#123;[::]:9300&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,352][INFO ][o.e.b.BootstrapChecks    ] [node-1] bound or publishing to a non-loopback address, enforcing bootstrap checks</span><br><span class=\"line\">[2020-03-01T12:03:40,380][INFO ][o.e.c.c.Coordinator      ] [node-1] cluster UUID [PKv57dWOS5OAazrBgqoLcQ]</span><br><span class=\"line\">[2020-03-01T12:03:40,565][INFO ][o.e.c.s.MasterService    ] [node-1] elected-as-master ([1] nodes joined)[&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125; elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 9, version: 279, delta: master node changed &#123;previous [], current [&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125;]&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,674][INFO ][o.e.c.s.ClusterApplierService] [node-1] master node changed &#123;previous [], current [&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125;]&#125;, term: 9, version: 279, reason: Publication&#123;term=9, version=279&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,741][INFO ][o.e.h.AbstractHttpServerTransport] [node-1] publish_address &#123;192.168.237.11:9200&#125;, bound_addresses &#123;[::]:9200&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,741][INFO ][o.e.n.Node               ] [node-1] started</span><br><span class=\"line\">[2020-03-01T12:03:41,213][INFO ][o.e.l.LicenseService     ] [node-1] license [b7ab8f1c-3e13-45f0-a4d2-6f5f31a554a1] mode [basic] - valid</span><br><span class=\"line\">[2020-03-01T12:03:41,214][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [node-1] Active license is now [BASIC]; Security is disabled</span><br><span class=\"line\">[2020-03-01T12:03:41,220][INFO ][o.e.g.GatewayService     ] [node-1] recovered [9] indices into cluster_state</span><br><span class=\"line\">[2020-03-01T12:03:42,116][INFO ][o.e.c.r.a.AllocationService] [node-1] Cluster health status changed from [RED] to [YELLOW] (reason: [shards started [[metricbeat-7.6.0][0]]]).</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这里说明一下，有可能会碰到内存不足，因为elasticsearch的<strong>jvm.options</strong>中配置的内存参数为1g，如果你的虚拟机给的内存不够就会出问题<br>修改<strong>jvm.options</strong>中的虚拟机参数为合适的参数，然后就可以启动成功了</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">-Xms1g</span></span><br><span class=\"line\"><span class=\"string\">-Xmx1g</span></span><br></pre></td></tr></table></figure>\n<p>这里还需要修改liunx的环境配置参数，避免重新启动的时候报错：<br>vi 编辑 /etc/security/limits.conf，在末尾加上：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">nofile</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">nofile</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">nproc</span> <span class=\"number\">32000</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">nproc</span> <span class=\"number\">32000</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">memlock</span> <span class=\"string\">unlimited</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">memlock</span> <span class=\"string\">unlimited</span></span><br></pre></td></tr></table></figure>\n<p>vi 编辑 /etc/sysctl.conf，在末尾加上：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">vm.max_map_count=655360</span></span><br></pre></td></tr></table></figure>\n<p>然后刷新配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">bin</span>]<span class=\"comment\"># sysctl -p</span></span><br><span class=\"line\"><span class=\"string\">kernel.printk</span> <span class=\"string\">=</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"string\">vm.max_map_count</span> <span class=\"string\">=</span> <span class=\"number\">655360</span></span><br><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">bin</span>]<span class=\"comment\">#</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>再次启动，然后检查</p>\n<p><img src=\"https://eelve.com/upload/2020/3/2020010301-5b565f99650d4acbb3ba464408dca641.png\" alt=\"2020010301\"><br><img src=\"https://eelve.com/upload/2020/3/2020030102-ff4ef388edeb4bb1b88ddf45df96543f.png\" alt=\"2020030102\"></p>\n<hr>\n<p>【<strong>后面的话</strong>】<br>后台启动</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./elasticsearch -d</span><br></pre></td></tr></table></figure>\n<p>查看进程,这里的常用的命令可能不好使，我们可以使用下面的命令查找进程</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ jps</span><br><span class=\"line\">2294 Jps</span><br><span class=\"line\">2135 Elasticsearch</span><br><span class=\"line\">[iio@192 bin]$ kill -9 2135</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","more":"<p>【<strong>前面的话</strong>】前面已经准备好了服务器环境，今天就来开始安装<a href=\"https://www.elastic.co/cn/elasticsearch\">Elasticsearch</a>然后体验。</p>\n<hr>\n<h1 id=\"壹、软件版本\"><a href=\"#壹、软件版本\" class=\"headerlink\" title=\"壹、软件版本\"></a>壹、软件版本</h1><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">Centos：CentOS-7-x86_64-Minimal-1908</span></span><br><span class=\"line\"><span class=\"attr\">VM:</span> <span class=\"number\">15.5</span><span class=\"number\">.0</span> <span class=\"string\">build-14665864</span></span><br><span class=\"line\"><span class=\"attr\">Java:</span> <span class=\"number\">1.8</span><span class=\"string\">.0_211</span></span><br><span class=\"line\"><span class=\"attr\">Elasticsearch:</span> <span class=\"string\">elasticsearch-7.6.0</span></span><br></pre></td></tr></table></figure>\n<p>这里说一下，Elasticsearch是依赖Java环境的，elasticsearch-7.6.0要求至少为1.8，官方建议为11.如果你的机器上还没有Java环境的话，记得要先准备环境。当然安装也是非常简单：</p>\n<p>1.下载linux版本的jdk</p>\n<p>2.解压然后配置环境变量</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#</span><span class=\"bash\">java environment</span></span><br><span class=\"line\">export JAVA_HOME=/usr/jdk</span><br><span class=\"line\">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/jre/lib/rt.jar:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar</span><br><span class=\"line\">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin</span><br></pre></td></tr></table></figure>\n<p>3.刷新环境变量，检查结果</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# source /etc/profile</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 ~]# java -version</span><br><span class=\"line\">java version &quot;1.8.0_211&quot;</span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_211-b12)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、Elasticsearch安装\"><a href=\"#贰、Elasticsearch安装\" class=\"headerlink\" title=\"贰、Elasticsearch安装\"></a>贰、Elasticsearch安装</h1><h2 id=\"2-1-下载地址\"><a href=\"#2-1-下载地址\" class=\"headerlink\" title=\"2.1 下载地址\"></a>2.1 下载地址</h2><h2 id=\"elasticsearch-7-6-0-linux-x86-64-tar-gz\"><a href=\"#elasticsearch-7-6-0-linux-x86-64-tar-gz\" class=\"headerlink\" title=\"elasticsearch-7.6.0-linux-x86_64.tar.gz\"></a><a href=\"https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.6.0-linux-x86_64.tar.gz\">elasticsearch-7.6.0-linux-x86_64.tar.gz</a></h2><h2 id=\"2-2-解压elasticsearch-7-6-0-linux-x86-64-tar-gz\"><a href=\"#2-2-解压elasticsearch-7-6-0-linux-x86-64-tar-gz\" class=\"headerlink\" title=\"2.2 解压elasticsearch-7.6.0-linux-x86_64.tar.gz\"></a>2.2 解压elasticsearch-7.6.0-linux-x86_64.tar.gz</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zvxf elasticsearch-7.6.0-linux-x86_64.tar.gz -C /usr/elastic</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-修改elasticsearch配置\"><a href=\"#2-3-修改elasticsearch配置\" class=\"headerlink\" title=\"2.3 修改elasticsearch配置\"></a>2.3 修改elasticsearch配置</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 elastic]# cd /usr/elastic/elasticsearch/config/</span><br><span class=\"line\">[root@192 config]# vi elasticsearch.yml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>下面给出单机版安装最小配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">node.name:</span> <span class=\"string\">node-1</span> <span class=\"comment\">#节点名字</span></span><br><span class=\"line\"><span class=\"attr\">network.host:</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span> <span class=\"comment\">#生产配置为127.0.0.1，测试可以为其他地址</span></span><br><span class=\"line\"><span class=\"attr\">http.port:</span> <span class=\"number\">9200</span> <span class=\"comment\">#端口</span></span><br><span class=\"line\"><span class=\"attr\">cluster.initial_master_nodes:</span> [<span class=\"string\">&quot;node-1&quot;</span>] <span class=\"comment\">#初始化master节点</span></span><br><span class=\"line\"><span class=\"attr\">http.cors.enabled:</span> <span class=\"literal\">true</span>  <span class=\"comment\">#开启跨域</span></span><br><span class=\"line\"><span class=\"attr\">http.cors.allow-origin:</span> <span class=\"string\">&quot;*&quot;</span> <span class=\"comment\">#开启跨域</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"2-4-后台启动\"><a href=\"#2-4-后台启动\" class=\"headerlink\" title=\"2.4 后台启动\"></a>2.4 后台启动</h2><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# ./elasticsearch</span><br><span class=\"line\">[1] 1620</span><br><span class=\"line\">[root@192 bin]# future versions of Elasticsearch will require Java 11; your Java version from [/usr/jdk/jre] does not meet this requirement</span><br><span class=\"line\">[2020-03-01T11:55:38,871][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-1] uncaught exception in thread [main]</span><br><span class=\"line\">org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:174) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:161) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125) ~[elasticsearch-cli-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:126) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">Caused by: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:105) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:172) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:349) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:170) ~[elasticsearch-7.6.0.jar:7.6.0]</span><br><span class=\"line\">\t... 6 more</span><br><span class=\"line\">uncaught exception in thread [main]</span><br><span class=\"line\">java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:105)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:172)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:349)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:170)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:161)</span><br><span class=\"line\">\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86)</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125)</span><br><span class=\"line\">\tat org.elasticsearch.cli.Command.main(Command.java:90)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:126)</span><br><span class=\"line\">\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92)</span><br><span class=\"line\">For complete error details, refer to the log at /usr/elastic/elasticsearch/logs/eelve.log</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这里说的是elasticsearch不能用root用户启动，这里就需要添加一个用户，然后重新启动</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# adduser iio</span><br><span class=\"line\">[root@192 bin]# passwd iio</span><br><span class=\"line\">Changing password for user iio.</span><br><span class=\"line\">New password: </span><br><span class=\"line\">Retype new password: </span><br><span class=\"line\">passwd: all authentication tokens updated successfully.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>然后更改elasticsearch用户组</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# chown -R iio:iio /usr/elastic/elasticsearch/</span><br></pre></td></tr></table></figure>\n<p>然后就可以启动成功了</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@192 bin]# su iio</span><br><span class=\"line\">[iio@192 bin]$ ./elasticsearch</span><br><span class=\"line\">future versions of Elasticsearch will require Java 11; your Java version from [/usr/jdk/jre] does not meet this requirement</span><br><span class=\"line\">[2020-03-01T12:03:32,970][INFO ][o.e.e.NodeEnvironment    ] [node-1] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [20.9gb], net total_space [25.9gb], types [rootfs]</span><br><span class=\"line\">[2020-03-01T12:03:32,972][INFO ][o.e.e.NodeEnvironment    ] [node-1] heap size [990.7mb], compressed ordinary object pointers [true]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] node name [node-1], node ID [2IBvVjP0QbeA-FDLFoLFFg], cluster name [eelve]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] version[7.6.0], pid[1952], build[default/tar/7f634e9f44834fbc12724506cc1da681b0c3b1e3/2020-02-06T00:09:00.449973Z], OS[Linux/3.10.0-1062.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_211/25.211-b12]</span><br><span class=\"line\">[2020-03-01T12:03:33,103][INFO ][o.e.n.Node               ] [node-1] JVM home [/usr/jdk/jre]</span><br><span class=\"line\">[2020-03-01T12:03:33,104][INFO ][o.e.n.Node               ] [node-1] JVM arguments [-Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dio.netty.allocator.numDirectArenas=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.locale.providers=COMPAT, -Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Djava.io.tmpdir=/tmp/elasticsearch-5828849950285366888, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -XX:MaxDirectMemorySize=536870912, -Des.path.home=/usr/elastic/elasticsearch, -Des.path.conf=/usr/elastic/elasticsearch/config, -Des.distribution.flavor=default, -Des.distribution.type=tar, -Des.bundled_jdk=true]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [aggs-matrix-stats]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [analysis-common]</span><br><span class=\"line\">[2020-03-01T12:03:34,656][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [flattened]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [frozen-indices]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-common]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-geoip]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [ingest-user-agent]</span><br><span class=\"line\">[2020-03-01T12:03:34,657][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-expression]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-mustache]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [lang-painless]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [mapper-extras]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [parent-join]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [percolator]</span><br><span class=\"line\">[2020-03-01T12:03:34,658][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [rank-eval]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [reindex]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [repository-url]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [search-business-rules]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [spatial]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [transform]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [transport-netty4]</span><br><span class=\"line\">[2020-03-01T12:03:34,659][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [vectors]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-analytics]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ccr]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-core]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-deprecation]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-enrich]</span><br><span class=\"line\">[2020-03-01T12:03:34,660][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-graph]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ilm]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-logstash]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-ml]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-monitoring]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-rollup]</span><br><span class=\"line\">[2020-03-01T12:03:34,661][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-security]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-sql]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-voting-only-node]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] loaded module [x-pack-watcher]</span><br><span class=\"line\">[2020-03-01T12:03:34,662][INFO ][o.e.p.PluginsService     ] [node-1] no plugins loaded</span><br><span class=\"line\">[2020-03-01T12:03:37,968][INFO ][o.e.x.s.a.s.FileRolesStore] [node-1] parsed [0] roles from file [/usr/elastic/elasticsearch/config/roles.yml]</span><br><span class=\"line\">[2020-03-01T12:03:38,382][INFO ][o.e.x.m.p.l.CppLogMessageHandler] [node-1] [controller/2044] [Main.cc@110] controller (64 bit): Version 7.6.0 (Build 1c8cca13fa9631) Copyright (c) 2020 Elasticsearch BV</span><br><span class=\"line\">[2020-03-01T12:03:38,870][DEBUG][o.e.a.ActionModule       ] [node-1] Using REST wrapper from plugin org.elasticsearch.xpack.security.Security</span><br><span class=\"line\">[2020-03-01T12:03:38,999][INFO ][o.e.d.DiscoveryModule    ] [node-1] using discovery type [zen] and seed hosts providers [settings]</span><br><span class=\"line\">[2020-03-01T12:03:39,805][INFO ][o.e.n.Node               ] [node-1] initialized</span><br><span class=\"line\">[2020-03-01T12:03:39,805][INFO ][o.e.n.Node               ] [node-1] starting ...</span><br><span class=\"line\">[2020-03-01T12:03:39,954][INFO ][o.e.t.TransportService   ] [node-1] publish_address &#123;192.168.237.11:9300&#125;, bound_addresses &#123;[::]:9300&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,352][INFO ][o.e.b.BootstrapChecks    ] [node-1] bound or publishing to a non-loopback address, enforcing bootstrap checks</span><br><span class=\"line\">[2020-03-01T12:03:40,380][INFO ][o.e.c.c.Coordinator      ] [node-1] cluster UUID [PKv57dWOS5OAazrBgqoLcQ]</span><br><span class=\"line\">[2020-03-01T12:03:40,565][INFO ][o.e.c.s.MasterService    ] [node-1] elected-as-master ([1] nodes joined)[&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125; elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 9, version: 279, delta: master node changed &#123;previous [], current [&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125;]&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,674][INFO ][o.e.c.s.ClusterApplierService] [node-1] master node changed &#123;previous [], current [&#123;node-1&#125;&#123;2IBvVjP0QbeA-FDLFoLFFg&#125;&#123;kGzTwK3ZRLGujF_9zhpR9A&#125;&#123;192.168.237.11&#125;&#123;192.168.237.11:9300&#125;&#123;dilm&#125;&#123;ml.machine_memory=3954036736, xpack.installed=true, ml.max_open_jobs=20&#125;]&#125;, term: 9, version: 279, reason: Publication&#123;term=9, version=279&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,741][INFO ][o.e.h.AbstractHttpServerTransport] [node-1] publish_address &#123;192.168.237.11:9200&#125;, bound_addresses &#123;[::]:9200&#125;</span><br><span class=\"line\">[2020-03-01T12:03:40,741][INFO ][o.e.n.Node               ] [node-1] started</span><br><span class=\"line\">[2020-03-01T12:03:41,213][INFO ][o.e.l.LicenseService     ] [node-1] license [b7ab8f1c-3e13-45f0-a4d2-6f5f31a554a1] mode [basic] - valid</span><br><span class=\"line\">[2020-03-01T12:03:41,214][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [node-1] Active license is now [BASIC]; Security is disabled</span><br><span class=\"line\">[2020-03-01T12:03:41,220][INFO ][o.e.g.GatewayService     ] [node-1] recovered [9] indices into cluster_state</span><br><span class=\"line\">[2020-03-01T12:03:42,116][INFO ][o.e.c.r.a.AllocationService] [node-1] Cluster health status changed from [RED] to [YELLOW] (reason: [shards started [[metricbeat-7.6.0][0]]]).</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这里说明一下，有可能会碰到内存不足，因为elasticsearch的<strong>jvm.options</strong>中配置的内存参数为1g，如果你的虚拟机给的内存不够就会出问题<br>修改<strong>jvm.options</strong>中的虚拟机参数为合适的参数，然后就可以启动成功了</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">-Xms1g</span></span><br><span class=\"line\"><span class=\"string\">-Xmx1g</span></span><br></pre></td></tr></table></figure>\n<p>这里还需要修改liunx的环境配置参数，避免重新启动的时候报错：<br>vi 编辑 /etc/security/limits.conf，在末尾加上：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">nofile</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">nofile</span> <span class=\"number\">65536</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">nproc</span> <span class=\"number\">32000</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">nproc</span> <span class=\"number\">32000</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">hard</span> <span class=\"string\">memlock</span> <span class=\"string\">unlimited</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">soft</span> <span class=\"string\">memlock</span> <span class=\"string\">unlimited</span></span><br></pre></td></tr></table></figure>\n<p>vi 编辑 /etc/sysctl.conf，在末尾加上：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">vm.max_map_count=655360</span></span><br></pre></td></tr></table></figure>\n<p>然后刷新配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">bin</span>]<span class=\"comment\"># sysctl -p</span></span><br><span class=\"line\"><span class=\"string\">kernel.printk</span> <span class=\"string\">=</span> <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"string\">vm.max_map_count</span> <span class=\"string\">=</span> <span class=\"number\">655360</span></span><br><span class=\"line\">[<span class=\"string\">root@192</span> <span class=\"string\">bin</span>]<span class=\"comment\">#</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>再次启动，然后检查</p>\n<p><img src=\"https://eelve.com/upload/2020/3/2020010301-5b565f99650d4acbb3ba464408dca641.png\" alt=\"2020010301\"><br><img src=\"https://eelve.com/upload/2020/3/2020030102-ff4ef388edeb4bb1b88ddf45df96543f.png\" alt=\"2020030102\"></p>\n<hr>\n<p>【<strong>后面的话</strong>】<br>后台启动</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ ./elasticsearch -d</span><br></pre></td></tr></table></figure>\n<p>查看进程,这里的常用的命令可能不好使，我们可以使用下面的命令查找进程</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[iio@192 bin]$ jps</span><br><span class=\"line\">2294 Jps</span><br><span class=\"line\">2135 Elasticsearch</span><br><span class=\"line\">[iio@192 bin]$ kill -9 2135</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","categories":[{"name":"hide","path":"api/categories/hide.json"}],"tags":[{"name":"hide","path":"api/tags/hide.json"}]}