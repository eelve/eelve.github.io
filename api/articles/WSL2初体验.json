{"title":"WSL2初体验","slug":"WSL2初体验","date":"2020-07-19T12:33:01.000Z","updated":"2023-09-30T08:39:39.682Z","comments":true,"path":"api/articles/WSL2初体验.json","excerpt":null,"covers":["https://image.eelve.com/eblog/2020071901-6f2b76d2c58f4213950f820ef05f85d8.png","https://image.eelve.com/eblog/2020071903-b7632286a2c648bdac1d0a92585612a3.png","https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png"],"content":"<p>【<strong>前面的话</strong>】前面已经对<a href=\"https://eelve.com/posts/f42ecfec.html\">WSL初体验</a> ，今天就将升级为WSL2，并且前面已经对<a href=\"https://eelve.com/posts/f42ecfec.html\">WSL初体验</a> ，今天就将升级为WSL2，并且在WSL2使用xrdp实现图形桌面。</p>\n<hr>\n<h1 id=\"壹、WSL升级为WSL2\"><a href=\"#壹、WSL升级为WSL2\" class=\"headerlink\" title=\"壹、WSL升级为WSL2\"></a>壹、WSL升级为WSL2</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --set-version Ubuntu-18.04 2</span><br></pre></td></tr></table></figure>\n<p>其中<code>Ubuntu-18.04</code>为你安装的WSL的发行版本，可以通过<code> wsl -l -v</code>来查看安装的WSL的发行版本详细信息。</p>\n<p>另外我在升级的过程中遇到了<code>WSL 2 需要更新其内核组件</code>问题。解决方法也很简单，<a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-kernel\">从微软下载WSL2 Linux内核的升级包</a>, 下载完成之后直接一路安装即可，之后WSL2就可以成功升级了。</p>\n<p>最后如果想要将默认的WSL发行版设置成WSL2，可以使用下面命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --set-default-version 2</span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、安装图形化桌面\"><a href=\"#贰、安装图形化桌面\" class=\"headerlink\" title=\"贰、安装图形化桌面\"></a>贰、安装图形化桌面</h1><h2 id=\"2-1-安装\"><a href=\"#2-1-安装\" class=\"headerlink\" title=\"2.1 安装\"></a>2.1 安装</h2><p>先更新,再安装<code>xfce4</code>和<code>xrdp</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt update</span><br><span class=\"line\">$ sudo apt install -y xfce4 xrdp</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-2-修改xrdp默认端口\"><a href=\"#2-2-修改xrdp默认端口\" class=\"headerlink\" title=\"2.2 修改xrdp默认端口\"></a>2.2 修改xrdp默认端口</h2><p>由于<code>xrdp</code>安装好后默认配置使用的是和Windows远程桌面相同的<code>3389</code> 端口,为了防止和Windows系统远程桌面冲突,建议修改成其他的端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vim /etc/xrdp/xrdp.ini</span><br><span class=\"line\"><span class=\"comment\"># 修改下面这一行,将默认的3389改成其他端口即可</span></span><br><span class=\"line\">port=13389</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-为当前用户指定登录session类型\"><a href=\"#2-3-为当前用户指定登录session类型\" class=\"headerlink\" title=\"2.3 为当前用户指定登录session类型\"></a>2.3 为当前用户指定登录session类型</h2><pre><code>注意这一步很重要,如果不设置的话会导致后面远程桌面连接上闪退\n</code></pre>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim ~/.xsession</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入下面内容(就一行)</span></span><br><span class=\"line\">xfce4-session</span><br><span class=\"line\">```    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 2.4 启动xrdp</span></span><br><span class=\"line\"></span><br><span class=\"line\">由于WSL2里面不能用`systemd`,所以需要手动启动</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\">$ sudo /etc/init.d/xrdp start</span><br></pre></td></tr></table></figure>\n<h1 id=\"叁、远程访问\"><a href=\"#叁、远程访问\" class=\"headerlink\" title=\"叁、远程访问\"></a>叁、远程访问</h1><p>在Windows系统中运行mstsc命令打开远程桌面连接,地址输入localhost:13389</p>\n<pre><code>注意这里的端口号应当与上面修改配置中一致\n</code></pre>\n<p><img src=\"https://image.eelve.com/eblog/2020071901-6f2b76d2c58f4213950f820ef05f85d8.png\" alt=\"2020071901\"><br><img src=\"https://image.eelve.com/eblog/2020071902-c42b474dc5374bda9f576619a491b1ed.png\" alt=\"2020071902\"></p>\n<p>输入linux系统的用户名和密码，就可以登陆成功了</p>\n<p><img src=\"https://image.eelve.com/eblog/2020071903-b7632286a2c648bdac1d0a92585612a3.png\" alt=\"2020071903\"></p>\n<p>【<strong>后面的话</strong>】如果在日常使用中遇到WSL异常，一般为网络端口占用问题导致，一般可以通过重置网络修复，使用管理员身份运行cmd，重置端口，然后重启：<code>netsh winsock reset</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参考的对象类型不支持尝试的操作。</span><br><span class=\"line\"></span><br><span class=\"line\">[已退出进程，代码为 4294967295]</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Microsoft Windows [版本 10.0.19041.388]</span><br><span class=\"line\">(c) 2020 Microsoft Corporation. 保留所有权利。</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\WINDOWS\\system32&gt;netsh winsock reset</span><br><span class=\"line\"></span><br><span class=\"line\">成功地重置 Winsock 目录。</span><br><span class=\"line\">你必须重新启动计算机才能完成重置。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">C:\\WINDOWS\\system32&gt;</span><br></pre></td></tr></table></figure>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","more":"<p>【<strong>前面的话</strong>】前面已经对<a href=\"https://eelve.com/posts/f42ecfec.html\">WSL初体验</a> ，今天就将升级为WSL2，并且前面已经对<a href=\"https://eelve.com/posts/f42ecfec.html\">WSL初体验</a> ，今天就将升级为WSL2，并且在WSL2使用xrdp实现图形桌面。</p>\n<hr>\n<h1 id=\"壹、WSL升级为WSL2\"><a href=\"#壹、WSL升级为WSL2\" class=\"headerlink\" title=\"壹、WSL升级为WSL2\"></a>壹、WSL升级为WSL2</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --set-version Ubuntu-18.04 2</span><br></pre></td></tr></table></figure>\n<p>其中<code>Ubuntu-18.04</code>为你安装的WSL的发行版本，可以通过<code> wsl -l -v</code>来查看安装的WSL的发行版本详细信息。</p>\n<p>另外我在升级的过程中遇到了<code>WSL 2 需要更新其内核组件</code>问题。解决方法也很简单，<a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-kernel\">从微软下载WSL2 Linux内核的升级包</a>, 下载完成之后直接一路安装即可，之后WSL2就可以成功升级了。</p>\n<p>最后如果想要将默认的WSL发行版设置成WSL2，可以使用下面命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --set-default-version 2</span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、安装图形化桌面\"><a href=\"#贰、安装图形化桌面\" class=\"headerlink\" title=\"贰、安装图形化桌面\"></a>贰、安装图形化桌面</h1><h2 id=\"2-1-安装\"><a href=\"#2-1-安装\" class=\"headerlink\" title=\"2.1 安装\"></a>2.1 安装</h2><p>先更新,再安装<code>xfce4</code>和<code>xrdp</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt update</span><br><span class=\"line\">$ sudo apt install -y xfce4 xrdp</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-2-修改xrdp默认端口\"><a href=\"#2-2-修改xrdp默认端口\" class=\"headerlink\" title=\"2.2 修改xrdp默认端口\"></a>2.2 修改xrdp默认端口</h2><p>由于<code>xrdp</code>安装好后默认配置使用的是和Windows远程桌面相同的<code>3389</code> 端口,为了防止和Windows系统远程桌面冲突,建议修改成其他的端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vim /etc/xrdp/xrdp.ini</span><br><span class=\"line\"><span class=\"comment\"># 修改下面这一行,将默认的3389改成其他端口即可</span></span><br><span class=\"line\">port=13389</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-为当前用户指定登录session类型\"><a href=\"#2-3-为当前用户指定登录session类型\" class=\"headerlink\" title=\"2.3 为当前用户指定登录session类型\"></a>2.3 为当前用户指定登录session类型</h2><pre><code>注意这一步很重要,如果不设置的话会导致后面远程桌面连接上闪退\n</code></pre>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim ~/.xsession</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入下面内容(就一行)</span></span><br><span class=\"line\">xfce4-session</span><br><span class=\"line\">```    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 2.4 启动xrdp</span></span><br><span class=\"line\"></span><br><span class=\"line\">由于WSL2里面不能用`systemd`,所以需要手动启动</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\">$ sudo /etc/init.d/xrdp start</span><br></pre></td></tr></table></figure>\n<h1 id=\"叁、远程访问\"><a href=\"#叁、远程访问\" class=\"headerlink\" title=\"叁、远程访问\"></a>叁、远程访问</h1><p>在Windows系统中运行mstsc命令打开远程桌面连接,地址输入localhost:13389</p>\n<pre><code>注意这里的端口号应当与上面修改配置中一致\n</code></pre>\n<p><img src=\"https://image.eelve.com/eblog/2020071901-6f2b76d2c58f4213950f820ef05f85d8.png\" alt=\"2020071901\"><br><img src=\"https://image.eelve.com/eblog/2020071902-c42b474dc5374bda9f576619a491b1ed.png\" alt=\"2020071902\"></p>\n<p>输入linux系统的用户名和密码，就可以登陆成功了</p>\n<p><img src=\"https://image.eelve.com/eblog/2020071903-b7632286a2c648bdac1d0a92585612a3.png\" alt=\"2020071903\"></p>\n<p>【<strong>后面的话</strong>】如果在日常使用中遇到WSL异常，一般为网络端口占用问题导致，一般可以通过重置网络修复，使用管理员身份运行cmd，重置端口，然后重启：<code>netsh winsock reset</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参考的对象类型不支持尝试的操作。</span><br><span class=\"line\"></span><br><span class=\"line\">[已退出进程，代码为 4294967295]</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Microsoft Windows [版本 10.0.19041.388]</span><br><span class=\"line\">(c) 2020 Microsoft Corporation. 保留所有权利。</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\WINDOWS\\system32&gt;netsh winsock reset</span><br><span class=\"line\"></span><br><span class=\"line\">成功地重置 Winsock 目录。</span><br><span class=\"line\">你必须重新启动计算机才能完成重置。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">C:\\WINDOWS\\system32&gt;</span><br></pre></td></tr></table></figure>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","categories":[{"name":"WSL","path":"api/categories/WSL.json"}],"tags":[{"name":"WSL，Windows","path":"api/tags/WSL，Windows.json"}]}