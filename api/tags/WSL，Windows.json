{"name":"WSL，Windows","postlist":[{"title":"WSL2初体验","slug":"WSL2初体验","date":"2020-07-19T12:33:01.000Z","updated":"2021-04-19T06:44:39.155Z","comments":true,"path":"api/articles/WSL2初体验.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/2020071901-6f2b76d2c58f4213950f820ef05f85d8.png","content":"<p>【<strong>前面的话</strong>】前面已经对<a href=\"https://eelve.com/archives/hellowsl\">WSL初体验</a> ，今天就将升级为WSL2，并且前面已经对<a href=\"https://eelve.com/archives/hellowsl\">WSL初体验</a> ，今天就将升级为WSL2，并且在WSL2使用xrdp实现图形桌面。</p>\n<hr>\n<h1 id=\"壹、WSL升级为WSL2\"><a href=\"#壹、WSL升级为WSL2\" class=\"headerlink\" title=\"壹、WSL升级为WSL2\"></a>壹、WSL升级为WSL2</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --set-version Ubuntu-18.04 2</span><br></pre></td></tr></table></figure>\n<p>其中<code>Ubuntu-18.04</code>为你安装的WSL的发行版本，可以通过<code> wsl -l -v</code>来查看安装的WSL的发行版本详细信息。</p>\n<p>另外我在升级的过程中遇到了<code>WSL 2 需要更新其内核组件</code>问题。解决方法也很简单，<a href=\"https://docs.microsoft.com/zh-cn/windows/wsl/wsl2-kernel\">从微软下载WSL2 Linux内核的升级包</a>, 下载完成之后直接一路安装即可，之后WSL2就可以成功升级了。</p>\n<p>最后如果想要将默认的WSL发行版设置成WSL2，可以使用下面命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wsl --set-default-version 2</span><br></pre></td></tr></table></figure>\n<h1 id=\"贰、安装图形化桌面\"><a href=\"#贰、安装图形化桌面\" class=\"headerlink\" title=\"贰、安装图形化桌面\"></a>贰、安装图形化桌面</h1><h2 id=\"2-1-安装\"><a href=\"#2-1-安装\" class=\"headerlink\" title=\"2.1 安装\"></a>2.1 安装</h2><p>先更新,再安装<code>xfce4</code>和<code>xrdp</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt update</span><br><span class=\"line\">$ sudo apt install -y xfce4 xrdp</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-2-修改xrdp默认端口\"><a href=\"#2-2-修改xrdp默认端口\" class=\"headerlink\" title=\"2.2 修改xrdp默认端口\"></a>2.2 修改xrdp默认端口</h2><p>由于<code>xrdp</code>安装好后默认配置使用的是和Windows远程桌面相同的<code>3389</code> 端口,为了防止和Windows系统远程桌面冲突,建议修改成其他的端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo vim /etc/xrdp/xrdp.ini</span><br><span class=\"line\"><span class=\"comment\"># 修改下面这一行,将默认的3389改成其他端口即可</span></span><br><span class=\"line\">port=13389</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-3-为当前用户指定登录session类型\"><a href=\"#2-3-为当前用户指定登录session类型\" class=\"headerlink\" title=\"2.3 为当前用户指定登录session类型\"></a>2.3 为当前用户指定登录session类型</h2><pre><code>注意这一步很重要,如果不设置的话会导致后面远程桌面连接上闪退\n</code></pre>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim ~/.xsession</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 写入下面内容(就一行)</span></span><br><span class=\"line\">xfce4-session</span><br><span class=\"line\">```    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 2.4 启动xrdp</span></span><br><span class=\"line\"></span><br><span class=\"line\">由于WSL2里面不能用`systemd`,所以需要手动启动</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\">$ sudo /etc/init.d/xrdp start</span><br></pre></td></tr></table></figure>\n<h1 id=\"叁、远程访问\"><a href=\"#叁、远程访问\" class=\"headerlink\" title=\"叁、远程访问\"></a>叁、远程访问</h1><p>在Windows系统中运行mstsc命令打开远程桌面连接,地址输入localhost:13389</p>\n<pre><code>注意这里的端口号应当与上面修改配置中一致\n</code></pre>\n<p><img src=\"https://image.eelve.com/eblog/2020071901-6f2b76d2c58f4213950f820ef05f85d8.png\" alt=\"2020071901\"><br><img src=\"https://image.eelve.com/eblog/2020071902-c42b474dc5374bda9f576619a491b1ed.png\" alt=\"2020071902\"></p>\n<p>输入linux系统的用户名和密码，就可以登陆成功了</p>\n<p><img src=\"https://image.eelve.com/eblog/2020071903-b7632286a2c648bdac1d0a92585612a3.png\" alt=\"2020071903\"></p>\n<p>【<strong>后面的话</strong>】如果在日常使用中遇到WSL异常，一般为网络端口占用问题导致，一般可以通过重置网络修复，使用管理员身份运行cmd，重置端口，然后重启：<code>netsh winsock reset</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参考的对象类型不支持尝试的操作。</span><br><span class=\"line\"></span><br><span class=\"line\">[已退出进程，代码为 4294967295]</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Microsoft Windows [版本 10.0.19041.388]</span><br><span class=\"line\">(c) 2020 Microsoft Corporation. 保留所有权利。</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\WINDOWS\\system32&gt;netsh winsock reset</span><br><span class=\"line\"></span><br><span class=\"line\">成功地重置 Winsock 目录。</span><br><span class=\"line\">你必须重新启动计算机才能完成重置。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">C:\\WINDOWS\\system32&gt;</span><br></pre></td></tr></table></figure>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"WSL","path":"api/categories/WSL.json"}],"tags":[{"name":"WSL，Windows","path":"api/tags/WSL，Windows.json"}]},{"title":"WSL初体验","slug":"WSL初体验","date":"2020-04-11T05:29:55.000Z","updated":"2021-04-19T06:44:39.166Z","comments":true,"path":"api/articles/WSL初体验.json","excerpt":null,"keywords":"南国薏米","cover":"https://image.eelve.com/eblog/2020041102-b3495d5d24fa4514b2e5293ded3cd61e.png","content":"<p>【<strong>前面的话</strong>】WSL是Windows Subsystem for Linux的缩写，今天就来体验一把。</p>\n<hr>\n<h1 id=\"壹、安装WSL\"><a href=\"#壹、安装WSL\" class=\"headerlink\" title=\"壹、安装WSL\"></a>壹、安装WSL</h1><h2 id=\"1-1-启用或关闭Windows功能\"><a href=\"#1-1-启用或关闭Windows功能\" class=\"headerlink\" title=\"1.1 启用或关闭Windows功能\"></a>1.1 启用或关闭Windows功能</h2><p>在搜索栏中搜索并打开“启用或关闭Windows功能”，勾选“适用于Linux的Windows子系统”项。只有开启这项设置才能正常安装WSL。然后按照提示稍后重启。</p>\n<h2 id=\"1-2-安装子系统\"><a href=\"#1-2-安装子系统\" class=\"headerlink\" title=\"1.2 安装子系统\"></a>1.2 安装子系统</h2><p>在微软应用商店搜索 Linux，可以看到一系列 Linux 发行版，根据自己需要选择适合自己的发行版，这里我选用 Ubuntu 18.04 LTS。等待下载完成后启动 Ubuntu 18.04 LTS，等待安装完成，输入账户和密码，我们便得到了一个 Linux 环境了。</p>\n<p><img src=\"https://image.eelve.com/eblog/2020041102-b3495d5d24fa4514b2e5293ded3cd61e.png\" alt=\"2020041102\"></p>\n<h1 id=\"贰、使用技巧\"><a href=\"#贰、使用技巧\" class=\"headerlink\" title=\"贰、使用技巧\"></a>贰、使用技巧</h1><h2 id=\"2-1使用其他命令行工具\"><a href=\"#2-1使用其他命令行工具\" class=\"headerlink\" title=\"2.1使用其他命令行工具\"></a>2.1使用其他命令行工具</h2><p>为什么不推荐自带的命令行呢？因为不支撑复制，这样你就只用手敲各种命令了。这里我推荐Windows Terminal，然后在Windows Terminal中键入<code>WSL</code>,就可以进入命令行了或者直接选择<code>Ubuntu 18.04</code>。</p>\n<p><img src=\"https://image.eelve.com/eblog/2020041104-617b46212475414ba2a4fd754bb395a8.png\" alt=\"2020041104\"><br><img src=\"https://image.eelve.com/eblog/2020041103-dd423936b8d348039cac18e3dd41db08.png\" alt=\"2020041103\"></p>\n<h2 id=\"2-2-更改源\"><a href=\"#2-2-更改源\" class=\"headerlink\" title=\"2.2 更改源\"></a>2.2 更改源</h2><p>Ubuntu 默认的 apt 源是国外的源，实在是太慢了，这里换成阿里云的源。</p>\n<h3 id=\"2-2-1-首先复制源文件备份，便于以后恢复\"><a href=\"#2-2-1-首先复制源文件备份，便于以后恢复\" class=\"headerlink\" title=\"2.2.1 首先复制源文件备份，便于以后恢复\"></a>2.2.1 首先复制源文件备份，便于以后恢复</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-2-查看版本信息\"><a href=\"#2-2-2-查看版本信息\" class=\"headerlink\" title=\"2.2.2 查看版本信息\"></a>2.2.2 查看版本信息</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc@Chirius:/mnt/c/Users/Chirius$ lsb_release -c</span><br><span class=\"line\">Codename:       bionic</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-3-编辑源文件\"><a href=\"#2-2-3-编辑源文件\" class=\"headerlink\" title=\"2.2.3 编辑源文件\"></a>2.2.3 编辑源文件</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc@Chirius:/mnt/c/Users/Chirius$ sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-2-4-根据-Ubuntu-版本号，添加相应内容：\"><a href=\"#2-2-4-根据-Ubuntu-版本号，添加相应内容：\" class=\"headerlink\" title=\"2.2.4 根据 Ubuntu 版本号，添加相应内容：\"></a>2.2.4 根据 Ubuntu 版本号，添加相应内容：</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class=\"line\"></span><br><span class=\"line\">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br></pre></td></tr></table></figure>\n<p>然后保存退出</p>\n<h3 id=\"2-2-5-升级系统\"><a href=\"#2-2-5-升级系统\" class=\"headerlink\" title=\"2.2.5 升级系统\"></a>2.2.5 升级系统</h3><figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc@Chirius:/mnt/c/Users/Chirius$ sudo apt-get update</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc@Chirius:/mnt/c/Users/Chirius$ sudo apt-get upgrade</span><br></pre></td></tr></table></figure>\n<h1 id=\"叁、WSL-文件位置\"><a href=\"#叁、WSL-文件位置\" class=\"headerlink\" title=\"叁、WSL 文件位置\"></a>叁、WSL 文件位置</h1><p>如果想在 Linux 查看其他分区，WSL 将其它盘符挂载在 /mnt 下。</p>\n<figure class=\"highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cc@Chirius:/$ cd mnt</span><br><span class=\"line\">cc@Chirius:/mnt$ ls</span><br><span class=\"line\">c  d</span><br><span class=\"line\">cc@Chirius:/mnt$ pwd</span><br><span class=\"line\">/mnt</span><br></pre></td></tr></table></figure>\n<p>如果想在 Windows 下查看 WSL 文件位置，文件位置在：C:\\Users\\用户名\\AppData\\Local\\Packages\\CanonicalGroupLimited.Ubuntu18.04onWindows_79rhkp1fndgsc\\LocalState\\rootfs 下。</p>\n<p>我们还可以在资源管理器中键入<code>\\\\wsl$</code></p>\n<p><img src=\"https://image.eelve.com/eblog/2020041105-c34cdd30c9b24c6e879114f45880091b.png\" alt=\"2020041105\"></p>\n<p>然后我们还可以添加网络位置</p>\n<p><img src=\"https://image.eelve.com/eblog/2020041106-564ce889eb8843fe8687d63a2f81fece.png\" alt=\"2020041106\"></p>\n<h1 id=\"肆、添加root密码\"><a href=\"#肆、添加root密码\" class=\"headerlink\" title=\"肆、添加root密码\"></a>肆、添加root密码</h1><p>由于默认进入子系统之后是你添加的用户，当你需要root权限是可以通过<code>sudo</code>加上相应的命令解决。那还有另外一种方法：设置一个root用户的密码，然后切换到root用户去执行相应的命令。下面就说一下在子系统中设置root用户密码：</p>\n<p>首先需要Windows管理员身份运行<code>cmd</code>或者<code>PowerShell</code>，然后执行下面命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Windows PowerShell</span><br><span class=\"line\">版权所有 (C) Microsoft Corporation。保留所有权利。</span><br><span class=\"line\"></span><br><span class=\"line\">尝试新的跨平台 PowerShell https://aka.ms/pscore6</span><br><span class=\"line\"></span><br><span class=\"line\">PS C:\\Users\\Chirius&gt; wsl</span><br><span class=\"line\">cc@Chirius:/mnt/c/Users/Chirius$ sudo passwd root</span><br><span class=\"line\">[sudo] password <span class=\"keyword\">for</span> cc:</span><br><span class=\"line\">Enter new UNIX password:</span><br><span class=\"line\">Retype new UNIX password:</span><br><span class=\"line\">passwd: password updated successfully</span><br><span class=\"line\">cc@Chirius:/mnt/c/Users/Chirius$ su root</span><br><span class=\"line\">Password:</span><br><span class=\"line\">root@Chirius:/mnt/c/Users/Chirius<span class=\"comment\">#</span></span><br></pre></td></tr></table></figure>\n<p>我们可以看到就已经可以切换到root用户了。</p>\n<p>【<strong>后面的话</strong>】在Windows2004版本中会发布WSL2，后面再来继续体验。</p>\n<hr>\n<p><img src=\"https://image.eelve.com/eblog/eblog-b269767ff45b4e01a1c380e38898c1c0.png\" alt=\"薏米笔记\"></p>\n","raw":null,"categories":[{"name":"WSL","path":"api/categories/WSL.json"}],"tags":[{"name":"WSL，Windows","path":"api/tags/WSL，Windows.json"}]}]}